<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta name="baidu-site-verification" content="zhTMODK6kb" />
  <meta http-equiv="content-language" content="zh-cn">
  
  <title>CORBA简介与简单实践 | Coder Am I</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这学期《网络与分布式计算》有一个大作业是使用Java/CORBA实现分布应用编程，自己查阅了一些资料，并对CORBA进行了实践。 关于CORBA什么是CORBACORBA：Common Object Request Broker Architecture,通用对象请求代理体系。是由对象管理组(Object Management Group, OMG)制定的一种标准的面向对象分布式应用程序体系规范，">
<meta name="keywords" content="CORBA">
<meta property="og:type" content="article">
<meta property="og:title" content="CORBA简介与简单实践">
<meta property="og:url" content="http://channel960608.github.io/2017/06/01/CORBA简介与简单实践/index.html">
<meta property="og:site_name" content="Coder Am I">
<meta property="og:description" content="这学期《网络与分布式计算》有一个大作业是使用Java/CORBA实现分布应用编程，自己查阅了一些资料，并对CORBA进行了实践。 关于CORBA什么是CORBACORBA：Common Object Request Broker Architecture,通用对象请求代理体系。是由对象管理组(Object Management Group, OMG)制定的一种标准的面向对象分布式应用程序体系规范，">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://oqvbarc9z.bkt.clouddn.com/0_1308019197TIvx.png">
<meta property="og:image" content="http://oqvbarc9z.bkt.clouddn.com/17060103.png">
<meta property="og:image" content="http://oqvbarc9z.bkt.clouddn.com/17060201.png">
<meta property="og:updated_time" content="2017-12-07T13:54:03.993Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CORBA简介与简单实践">
<meta name="twitter:description" content="这学期《网络与分布式计算》有一个大作业是使用Java/CORBA实现分布应用编程，自己查阅了一些资料，并对CORBA进行了实践。 关于CORBA什么是CORBACORBA：Common Object Request Broker Architecture,通用对象请求代理体系。是由对象管理组(Object Management Group, OMG)制定的一种标准的面向对象分布式应用程序体系规范，">
<meta name="twitter:image" content="http://oqvbarc9z.bkt.clouddn.com/0_1308019197TIvx.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> -->
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <!--<link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">-->
  <!--<link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>-->
  <link href="/css/fonts/font.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  

</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/" class="logo">Coder Am I</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about/index.html">About</a>
        
          <a class="main-nav-link" href="/board">Board</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://channel960608.github.io"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/channel960608" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>
      <nav id="mobile-nav" class="off">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about/index.html" class="mobile-nav-link">About</a>
  
    <a href="/board" class="mobile-nav-link">Board</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://channel960608.github.io"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/11/通过20newsgroups案例进行Sklearn入门学习/">通过20newsgroups案例进行Sklearn入门学习</a>
          </li>
        
          <li>
            <a href="/2018/04/08/k近邻算法中kd树的实现/">k近邻算法中kd树的实现</a>
          </li>
        
          <li>
            <a href="/2018/03/19/一致性hash算法/">一致性hash算法原理简要理解</a>
          </li>
        
          <li>
            <a href="/2017/07/21/航天航空与臭虫/">航天航空与臭虫</a>
          </li>
        
          <li>
            <a href="/2017/06/18/JavaWeb会话与状态管理-Session机制学习/">JavaWeb会话与状态管理--Session机制学习</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CORBA/">CORBA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Web/">Java Web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine-Learning/">Machine Learning</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat-Linux/">Tomcat && Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/其他/">其他</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式数据库/">分布式数据库</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CORBA/" style="font-size: 10px;">CORBA</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Java-Web/" style="font-size: 10px;">Java Web</a> <a href="/tags/Machine-Learning/" style="font-size: 20px;">Machine Learning</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Tomcat-Linux/" style="font-size: 10px;">Tomcat && Linux</a> <a href="/tags/其他/" style="font-size: 10px;">其他</a> <a href="/tags/分布式数据库/" style="font-size: 10px;">分布式数据库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main"><article id="post-CORBA简介与简单实践" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/01/CORBA简介与简单实践/" class="article-date">
  <time datetime="2017-06-01T11:34:19.000Z" itemprop="datePublished">2017-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      CORBA简介与简单实践
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        

        <p>这学期《网络与分布式计算》有一个大作业是使用Java/CORBA实现分布应用编程，自己查阅了一些资料，并对CORBA进行了实践。</p>
<h2 id="关于CORBA"><a href="#关于CORBA" class="headerlink" title="关于CORBA"></a>关于CORBA</h2><h3 id="什么是CORBA"><a href="#什么是CORBA" class="headerlink" title="什么是CORBA"></a>什么是CORBA</h3><p><strong>CORBA</strong>：Common Object Request Broker Architecture,通用对象请求代理体系。是由对象管理组(Object Management Group, OMG)制定的一种标准的面向对象分布式应用程序体系规范，旨在为异构分布式环境中，硬件和软件系统的互联而提出的一种解决方案。</p>
<h3 id="解决异构分布式系统两条主要原则"><a href="#解决异构分布式系统两条主要原则" class="headerlink" title="解决异构分布式系统两条主要原则"></a>解决异构分布式系统两条主要原则</h3><ul>
<li>寻求独立于平台的模型和抽象，这样有助于解决大部分问题 </li>
<li>在不牺牲太多性能的前提下，尽可能隐藏底层的复杂细节</li>
</ul>
<p>第一点不是很理解，我只能理解为为了规避现有开发模型而建立独立的模型和抽象，为的是解决其他平台本身存在而无法解决的问题<br>第二点应该是为了实现java语言的封装性，利用接口,隐藏底层的具体实现</p>
<h3 id="对象管理组-OMG-定义的两类与平台无关的分布式对象模型"><a href="#对象管理组-OMG-定义的两类与平台无关的分布式对象模型" class="headerlink" title="对象管理组(OMG)定义的两类与平台无关的分布式对象模型"></a>对象管理组(OMG)定义的两类与平台无关的分布式对象模型</h3><ol>
<li>对象模型(Object Model)：用来定义在一个异构环境中，如何描述分布式对象接口。对象模型将对象定义为永恒不变、始终唯一的，对象模型封装实体，这些实体只能被严格定义的接口访问，客户机通过向对象发请求，才能使用对象提供的服务，对象的实现细节和它的位置对于客户机上隐藏的。</li>
<li>引用模型(Reference Model)：用来说明对象之间如何交互。引用模型提供的接口种类，通常是按对象接口编组，所有接口种类有一个对象请求代理(Object Request Broker,ORB)按概念链接在一起。通常，一个ORB可以在客户机和对象之间进行通信，当请求发送给对象时，透明地激活那些没有运行的对象。</li>
</ol>
<h3 id="对象管理组-OMG-的接口种类"><a href="#对象管理组-OMG-的接口种类" class="headerlink" title="对象管理组(OMG)的接口种类"></a>对象管理组(OMG)的接口种类</h3><ol>
<li><strong>对象服务接口</strong>：Object Services,OS.是与领域无关(水平定向)的接口，对象管理组定义的命名服务(Naming Service)和交易服务(Trading Service)都是对象服务。对象服务通常被认为是分布式计算架构的核心部分。</li>
<li><strong>领域接口</strong>：Domain Interface,DI.其作用与对象服务接口类似，但是领域接口针对领域而已，它与特定领域相关(垂直定向)。</li>
<li><strong>应用程序接口</strong>：Application Interface,AI.是专门为特定应用程序而开发的，并不是对象管理组所制定的标准。但是如果某些应用程序的接口出现在许多不同的应用程序中，那么这些应用程序接口应作为其他接口种类中的一类成为接口标准化的备选项。</li>
</ol>
<p><img src="http://oqvbarc9z.bkt.clouddn.com/0_1308019197TIvx.png" alt=""><br>图片引用自<a href="http://blog.csdn.net/chjttony/article/details/6543116" target="_blank" rel="noopener">CSDN博客</a></p>
<h2 id="关于实践"><a href="#关于实践" class="headerlink" title="关于实践"></a>关于实践</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>需求文档是英文的，这里只简单说一下。想要看更详细的英文任务书可以在这里<a href="http://oqvbarc9z.bkt.clouddn.com/CORBA%E7%BC%96%E7%A8%8B%E4%BB%BB%E5%8A%A1%E4%B9%A6.docx" target="_blank" rel="noopener">下载</a></p>
<p>使用Java/CORBA完成一个分布式的计划清单(to-do list)应用，使用Java IDL，一个完全由java编写的CORBA ORB编译器。以下所有功能必须由客户端使用CORBA naming service来调用，每一个用户的计划列表必须是有CORBA管理的独立对象。<br>需要实现以下功能：</p>
<ul>
<li>用户注册<br>新用户需要注册。新的用户必须提供用户名(user name)和密码(password)。如果提供的用户名已经存在，就在屏幕上打印错误信息。如果成功注册，客户端需要打印信息说明注册成功。当一个用户成功注册时，服务器应当为该用户初始化一个新的任务列表对象(a new to-do list object)</li>
<li>添加事项<br>已注册的用户将会添加新的事项(item)到他们的事项清单中。每一个事项包含以下三个要素：开始时间，结束时间和一个便签。无论添加成功还是失败，用户应当收到客户端发送的相关提示信息。</li>
<li>查询事项<br>已注册的用户将会浏览在一定时间范围内的所有的事项。所以每次进行查询操作时，输入的参数必须包括这个时间范围的开始时间和结束时间，并返回一系列在这个时间段内的事项对象。在这一串返回的清单中，需要包含事项开始时间，结束时间以及便签的内容。  </li>
<li>删除事项<br>已注册的用户将会从自己的清单中删除不想继续保留的事项。这一操作需要输入特定的参数来鉴别是哪一个事项。</li>
</ul>
<h3 id="CORBA应用的基础实现"><a href="#CORBA应用的基础实现" class="headerlink" title="CORBA应用的基础实现"></a>CORBA应用的基础实现</h3><p>首先需要使用使用Java IDL对需要实现的接口进行定义，这里我只是构建CORBA框架，暂时实现的接口只有测试<br>在项目中新建一个Corba.idl文件，定义测试接口：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module CorbaApp&#123;</span><br><span class="line">        interface Corba&#123;</span><br><span class="line">                string corbaTest();</span><br><span class="line">                oneway void shutdown();</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后通过java idl工具编译idl文件，生成目标类。<br>博主用的是windows下的MINGW64环境，使用windows的cmd命令行同样可以<code>$ idlj -fall Corba.idl</code><br>生成了以下文件夹  </p>
<p><img src="http://oqvbarc9z.bkt.clouddn.com/17060103.png" alt="">  </p>
<p>我们只需要用到的CorbaPOA.java这个类，新建类CorbaImpl实现这个POA接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class CorbaImpl extends CorbaPOA&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String corbaTest() &#123;</span><br><span class="line">        System.out.println(&quot;corbaTest&quot;);</span><br><span class="line">        return &quot;Test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void shutdown() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个shutdown方法应该是用来关闭服务器的，我没有实现它，并不妨碍项目。<br>这里CorbaImpl中实现的corbatTest方法，在方法中打印了corbaTest，返回了“Test”，这里CORBA的机制，Test会在Server端打印，corbaTest会在Client端打印，具体的原理会在后面讲到。</p>
<h4 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h4><p>下面实现Server类CorbaServer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">package corba.server;</span><br><span class="line"></span><br><span class="line">import CorbaApp.Corba;</span><br><span class="line">import CorbaApp.CorbaHelper;</span><br><span class="line">import org.omg.CORBA.ORB;</span><br><span class="line">import org.omg.CosNaming.NameComponent;</span><br><span class="line">import org.omg.CosNaming.NamingContextExt;</span><br><span class="line">import org.omg.CosNaming.NamingContextExtHelper;</span><br><span class="line">import org.omg.PortableServer.POA;</span><br><span class="line">import org.omg.PortableServer.POAHelper;</span><br><span class="line"></span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by channel on 2017/5/31.</span><br><span class="line"> */</span><br><span class="line">public class CorbaServer &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void run(String[] args) throws Exception &#123;</span><br><span class="line">        //生成一个对象请求代理（ORB），并初始化</span><br><span class="line">        Properties props = new Properties();</span><br><span class="line">        //初始化端口，默认的端口是900</span><br><span class="line">        props.put(&quot;org.omg.CORBA.ORBInitialPort&quot;, &quot;1050&quot;);</span><br><span class="line">        //绑定到服务器</span><br><span class="line">        props.put(&quot;org.omg.CORBA.ORBInitialHost&quot;, &quot;localhost&quot;);</span><br><span class="line">        //初始化ORB</span><br><span class="line">        ORB orb = ORB.init(args, props);</span><br><span class="line">        // get reference to rootpoa &amp; activate the POAManager</span><br><span class="line">        //获取一个根POA引用，并激活POA管理器</span><br><span class="line">        POA poa = POAHelper.narrow(orb.resolve_initial_references(&quot;RootPOA&quot;));</span><br><span class="line">        poa.the_POAManager().activate();</span><br><span class="line">        //实例化一个HelloImpl对象</span><br><span class="line">        CorbaImpl corba = new CorbaImpl();</span><br><span class="line">        // 从servant获得一个对象引用</span><br><span class="line">        org.omg.CORBA.Object ref = poa.servant_to_reference(corba);</span><br><span class="line">        Corba href = CorbaHelper.narrow(ref);</span><br><span class="line">        // 获得命名上下文</span><br><span class="line">        org.omg.CORBA.Object objref = orb.resolve_initial_references(&quot;NameService&quot;);</span><br><span class="line">        // 使用NamingContextExt 它是INS（Interoperable Naming Service，协同命名规范）的一部分</span><br><span class="line">        NamingContextExt ncRef = NamingContextExtHelper.narrow(objref);</span><br><span class="line">        //绑定一个对象引用，以便客户端可以调用</span><br><span class="line">        String name = &quot;Corba&quot;;</span><br><span class="line">        NameComponent[] nc = ncRef.to_name(name);</span><br><span class="line">        ncRef.rebind(nc, href);</span><br><span class="line">        System.out.println(&quot;CorbaServer ready and waiting......&quot;);</span><br><span class="line"></span><br><span class="line">        //运行ORB</span><br><span class="line">        orb.run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        CorbaServer server = new CorbaServer();</span><br><span class="line">        try &#123;</span><br><span class="line">            server.run(args);</span><br><span class="line">        &#125;catch(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务器主要运行方法run中<br>初始化ORB对象orb，并绑定服务器和端口，这里我绑定的是本机localhost，和1050端口<br><code>Properties props = new Properties();</code><br><code>props.put(&quot;org.omg.CORBA.ORBInitialPort&quot;, &quot;1050&quot;);</code><br><code>ORB orb = ORB.init(args, props);</code><br><strong>ORB</strong>：Object Request Broker,对象请求代理，在一个面向对象的分布式环境中，ORB可以为应用程序、服务器、网络设施之间分发消息提供关键通信设施。可以将ORB想象成一组软件总线，它提供了一个公用消息传递接口，通过这个接口，不同类型的对象可以以对等层策略进行通信。ORB是CORBA的核心组件，提供了识别和定位对象、处理连接管理、传送数据和请求通信的框架结构。<br>所以这里的orb对象是服务器的通信接口，服务器和客户端在网络介质的基础上，通过ORB进行通信。<br>下面初始化POA对象poa，获取poa的根引用并激活POA管理器。<br><code>POA poa = POAHelper.narrow(orb.resolve_initial_references(&quot;RootPOA&quot;));</code><br><code>poa.the_POAManager().activate();</code><br>POA提供了一组服务器端的接口以及操作。POA关注的重点是跟踪侍服对象的实例化以及内存空间信息，侍服对象的激活以及去激活（activation and deactivation），对象引用的创建，以及对象生命周期的管理<br>POA Manager 理论上POA Manager 负责一个或者多个POA的传输终点，负责对POA的请求流进行管理。<br>然后就可以初始化我们的CorbaImpl类对象了<br><code>CorbaImpl corba = new CorbaImpl();</code><br>初始化了这个corba对象，为了让客户端的程序能够调用到corba的方法，需要对其在POA Manager中从servant获得一个引用<br><code>org.omg.CORBA.Object ref = poa.servant_to_reference(corba);</code><br><code>Corba href = CorbaHelper.narrow(ref);</code><br>获得命名上下文<br><code>org.omg.CORBA.Object objref = orb.resolve_initial_references(&quot;NameService&quot;);</code><br>使用NamingContextExt 它是INS（Interoperable Naming Service，协同命名规范）的一部分<br><code>NamingContextExt ncRef = NamingContextExtHelper.narrow(objref);</code><br>绑定一个对象引用，以便客户端可以调用<br><code>String name = &quot;Corba&quot;;</code><br><code>NameComponent[] nc = ncRef.to_name(name);</code><br><code>ncRef.rebind(nc, href);</code><br>下面运行ORB<br><code>orb.run();</code></p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><p>下面是客户端CorbaClient.java的代码：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">package corba.client;</span><br><span class="line"></span><br><span class="line">import CorbaApp.Corba;</span><br><span class="line">import CorbaApp.CorbaHelper;</span><br><span class="line">import corba.corba.util.Database;</span><br><span class="line">import corba.corba.util.Item;</span><br><span class="line">import org.omg.CORBA.ORB;</span><br><span class="line">import org.omg.CosNaming.NamingContextExt;</span><br><span class="line">import org.omg.CosNaming.NamingContextExtHelper;</span><br><span class="line"></span><br><span class="line">import java.text.ParseException;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Properties;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by channel on 2017/5/31.</span><br><span class="line"> */</span><br><span class="line">public class CorbaClient &#123;</span><br><span class="line">    public void run(String[] args) throws Exception &#123;</span><br><span class="line">        Properties props = new Properties();</span><br><span class="line">        // 生成一个ORB，并初始化，这个和Server端一样</span><br><span class="line">        props .put(&quot;org.omg.CORBA.ORBInitialPort&quot;, &quot;1050&quot;);</span><br><span class="line">        props.put(&quot;org.omg.CORBA.ORBInitialHost&quot;, &quot;localhost&quot;);</span><br><span class="line">        ORB orb = ORB.init(args, props);</span><br><span class="line">        // 获得根命名上下文</span><br><span class="line">        org.omg.CORBA.Object objRef = orb.resolve_initial_references(&quot;NameService&quot;);</span><br><span class="line">        // 用NamingContextExt代替NamingContext.</span><br><span class="line">        NamingContextExt ncRef = NamingContextExtHelper.narrow(objRef);</span><br><span class="line"></span><br><span class="line">        // 通过名称获取服务器端的对象引用</span><br><span class="line">        String name = &quot;Corba&quot;;</span><br><span class="line">        Corba corba = CorbaHelper.narrow(ncRef.resolve_str(name));</span><br><span class="line">        System.out.println(&quot;You can input help for help&quot;);</span><br><span class="line">        //调用远程对象</span><br><span class="line">        System.out.println(corba.corbaTest());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        CorbaClient client = new CorbaClient();</span><br><span class="line">        try &#123;</span><br><span class="line">            client.run(args);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>像Server端一样，首先要建立ORB连接，并设置IP地址和端口<br><code>Properties props = new Properties();</code><br><code>props .put(&quot;org.omg.CORBA.ORBInitialPort&quot;, &quot;1050&quot;);</code><br><code>props.put(&quot;org.omg.CORBA.ORBInitialHost&quot;, &quot;localhost&quot;);</code><br><code>ORB orb = ORB.init(args, props);</code><br>获得根命名上下文<br><code>org.omg.CORBA.Object objRef = orb.resolve_initial_references(&quot;NameService&quot;);</code><br>用NamingContextExt代替NamingContext.<br><code>NamingContextExt ncRef = NamingContextExtHelper.narrow(objRef);</code><br>通过名称获取服务器端的对象引用<br><code>String name = &quot;Corba&quot;;</code><br><code>Corba corba = CorbaHelper.narrow(ncRef.resolve_str(name));</code><br>然后我们可以通过corba来调用CorbaImpl的方法了<br><code>System.out.println(corba.corbaTest());</code><br>最后运行corba<br><code>run(crrba);</code>  </p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>首先需要在服务器所在机器开启orbd服务，并开启localhost的1050端口<br><code>$ orbd -ORBInitialPort 1050 -ORBInitialHost localhost</code><br>然后运行服务器 CorbaServer<br>服务器运行成功后再运行客户端CorbaClient<br>然后客户端会在屏幕上输出Test，而不会输出corbaTest<br>我们回头看corbaTest()方法  </p>
<pre><code>@Override
        public String corbaTest() {
            System.out.println(&quot;corbaTest&quot;);
            return &quot;Test&quot;;
        }     
</code></pre><p>因为客户端只是通过引用，使服务器端调用corbaTest()方法，所以System.out.println()的输出是在服务器的控制台中，而这里我们打印了这个方法的返回，所以客户端只有“Test”。</p>
<h3 id="进入正题"><a href="#进入正题" class="headerlink" title="进入正题"></a>进入正题</h3><p>Corba分布式应用框架基本上搭好了，下面就是完成用户事项部分了。<br>项目基本框架如下，使用的编辑器是IDEA<br><img src="http://oqvbarc9z.bkt.clouddn.com/17060201.png" alt=""><br>应用的主体在corba.util包中<br>定义User类，作为用户的持久层，包括账号，密码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> corba.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by channel on 2017/5/31.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPass</span><span class="params">(String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pass = pass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pass.equals(getPass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中verify()方法用于使用用户名获得User对象后进行密码确认。 </p>
<p>定义Item类，作为事项的持久层，包括id，开始日期，结束日期，标签内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> corba.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by channel on 2017/5/31.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    Long id;</span><br><span class="line">    Date start;</span><br><span class="line">    Date end;</span><br><span class="line">    String label;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setStart(<span class="keyword">new</span> Date());</span><br><span class="line">        setEnd(<span class="keyword">new</span> Date());</span><br><span class="line">        setLabel(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">(String begin, String end, String label)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        <span class="comment">//SimpleDateFormat sdf = new SimpleDateFormat("yyyy/MM/dd HH:mm:ss.SSS");</span></span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy/MM/dd HH:mm:ss.SSS"</span>);</span><br><span class="line"></span><br><span class="line">        Date date1 = sdf.parse(begin);</span><br><span class="line">        Date date2 = sdf.parse(end);</span><br><span class="line">        setStart(date1);</span><br><span class="line">        setEnd(date2);</span><br><span class="line">        setLabel(label);</span><br><span class="line">        Calendar now = Calendar.getInstance();</span><br><span class="line">        setId(now.getTimeInMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long i)</span> </span>&#123;</span><br><span class="line">        id = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareBegin</span><span class="params">(Item another)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getStart().compareTo(another.getStart());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareEnd</span><span class="params">(Item another)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getEnd().compareTo(another.getEnd());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Date start,Date end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(getStart().compareTo(start) &gt;= <span class="number">0</span> &amp;&amp; getEnd().compareTo(end) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStart</span><span class="params">(Date start)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnd</span><span class="params">(Date end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLabel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> label;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLabel</span><span class="params">(String label)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.label = label;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"id: "</span> + getId() + <span class="string">" Start date: "</span> + getStart().toString() + <span class="string">" End date: "</span> + getEnd().toString() + <span class="string">" Label: "</span> + getLabel());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义了compare（）方法比较该item是否在某一个时段的区间中</p>
<p>下面是Database类，虽然叫数据库，但只是一个内存中的持久对象。因为项目比较简单也没有要求使用数据库，就将用户信息和事项清单的数据存在服务器内存中，每次服务器重启之后数据都会清空。</p>
<p>Database中储存数据的基本数据格式如下：<br><code>HashMap&lt;String,User&gt; userMap;</code><br><code>HashMap&lt;String,List&lt;Item&gt;&gt; itemMap;</code><br>使用链表LinkedList储存事项清单，是因为考虑到用户添加，删除事项使用链表更快，而对于查询而言，必须遍历所有的Item，LinkedList和ArrayList耗时是一样的，因此选择链表作为最优的数据结构。<br>使用HashMap，将用户名和用户名对应的User对象作为一个键值对储存，将用户名和其对应的事项清单List<item>作为又一个键值对储存。  </item></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> corba.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by channel on 2017/5/31.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Database</span> </span>&#123;</span><br><span class="line">    HashMap&lt;String,List&lt;Item&gt;&gt; itemMap;</span><br><span class="line">    HashMap&lt;String,User&gt; userMap;</span><br><span class="line">    <span class="keyword">int</span> nameMapSize;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Database</span><span class="params">()</span></span>&#123;</span><br><span class="line">        itemMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        userMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        nameMapSize = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">duplicate</span><span class="params">(String m_name)</span></span>&#123;</span><br><span class="line">        Set&lt;String&gt; nameSet = userMap.keySet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String name:nameSet)&#123;</span><br><span class="line">            <span class="keyword">if</span>(m_name.equals(name))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">getItem</span><span class="params">(String username, <span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Item&gt; list = getItemList(username);</span><br><span class="line">            <span class="keyword">for</span>(Item it:list)&#123;</span><br><span class="line">                <span class="keyword">if</span>(id == it.getId())</span><br><span class="line">                    <span class="keyword">return</span> it;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pass</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  0 正常返回</span></span><br><span class="line"><span class="comment">     *          -1 用户名已存在</span></span><br><span class="line"><span class="comment">     *          -2 未知错误</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addUser</span><span class="params">(String username,String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(duplicate(username)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            User user = <span class="keyword">new</span> User();</span><br><span class="line">            user.setUsername(username);</span><br><span class="line">            user.setPass(pass);</span><br><span class="line">            userMap.put(username, user);</span><br><span class="line">            itemMap.put(username, <span class="keyword">new</span> LinkedList&lt;&gt;());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> User if it exists.</span></span><br><span class="line"><span class="comment">     *          Otherwise, it returns null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(String username)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMap.get(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">userExist</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMap.containsKey(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pass</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0 登录成功</span></span><br><span class="line"><span class="comment">     *          -2 不存在该用户</span></span><br><span class="line"><span class="comment">     *          -1 账号密码不正确</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">login</span><span class="params">(String username, String pass)</span> </span>&#123;</span><br><span class="line">        User m_user = getUser(username);</span><br><span class="line">        <span class="keyword">if</span>(m_user.equals(<span class="keyword">null</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!m_user.verify(pass)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">getItemList</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Item&gt; list=itemMap.get(username);</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">query</span><span class="params">(String username, Date start, Date end)</span> </span>&#123;</span><br><span class="line">        List&lt;Item&gt; list=getItemList(username);</span><br><span class="line">        List&lt;Item&gt; list2 = <span class="keyword">new</span> LinkedList&lt;Item&gt;();</span><br><span class="line">        <span class="keyword">if</span>(list==<span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(Item it:list) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">1</span> == it.compare(start, end)) &#123;</span><br><span class="line">                list2.add(it);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list2;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> it</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0 正常</span></span><br><span class="line"><span class="comment">     *          -2 未知错误</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addItem</span><span class="params">(String username, Item it)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List list = getItemList(username);</span><br><span class="line">            list.add(it);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0 正常</span></span><br><span class="line"><span class="comment">     *          -1 没找到这个Item</span></span><br><span class="line"><span class="comment">     *          -2 未知错误</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteItem</span><span class="params">(String username,Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Item&gt; list = getItemList(username);</span><br><span class="line">            <span class="keyword">for</span>(Item it : list) &#123;</span><br><span class="line">                <span class="keyword">if</span> (id.equals(it.getId())) &#123;</span><br><span class="line">                    list.remove(it);</span><br><span class="line">                    itemMap.replace(username, list);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0 成功</span></span><br><span class="line"><span class="comment">     *          -1 用户不存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clear</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!userMap.containsKey(username))</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        itemMap.replace(username, <span class="keyword">new</span> LinkedList&lt;Item&gt;());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Database类完成后，就需要考虑如何将Database的方法封装到CorbaImpl接口中了。<br>修改Corba.idl接口定义文档，添加对数据库操作的接口，由于对idl中自定义类型不了解，所以方法的返回和参数都使用了基础类型。<br>Corba.idl  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module CorbaApp&#123;</span><br><span class="line">        interface Corba&#123;</span><br><span class="line">                </span><br><span class="line">                short regist(in wstring username, in wstring pass);</span><br><span class="line">                short login(in wstring username, in wstring pass);</span><br><span class="line">                short add(in wstring username, in wstring date1, in wstring date2, in wstring label);</span><br><span class="line">                wstring query(in wstring username, in wstring starttime, in wstring endtime);</span><br><span class="line">                short delete(in wstring username, in long long id);</span><br><span class="line">                short clear(in wstring username);</span><br><span class="line"></span><br><span class="line">                oneway void shutdown();</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>用之前的方法更新CorbaApp下的生成的6个类，修改CorbaImpl接口实现类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> corba.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> CorbaApp.CorbaPOA;</span><br><span class="line"><span class="keyword">import</span> corba.util.Database;</span><br><span class="line"><span class="keyword">import</span> corba.util.Item;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by channel on 2017/5/31.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorbaImpl</span> <span class="keyword">extends</span> <span class="title">CorbaPOA</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Database data = <span class="keyword">new</span> Database();</span><br><span class="line">    List&lt;Item&gt; list = <span class="keyword">new</span> LinkedList();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">regist</span><span class="params">(String username, String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">short</span>)data.addUser(username, pass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">login</span><span class="params">(String username, String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">short</span>)data.login(username, pass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">add</span><span class="params">(String username, String date1, String date2, String label)</span> </span>&#123;</span><br><span class="line">        Item it = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            it = <span class="keyword">new</span> Item(date1, date2, label);</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">short</span>) data.addItem(username, it);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">(String username, String starttime, String endtime)</span> </span>&#123;</span><br><span class="line">        list = <span class="keyword">null</span>;</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy/MM/dd HH:mm:ss.SSS"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Date date1 = sdf.parse(starttime);</span><br><span class="line">            Date date2 = sdf.parse(endtime);</span><br><span class="line">            list = data.query(username, date1, date2);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == list) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                String out=<span class="string">""</span>;</span><br><span class="line">                <span class="keyword">for</span>(Item it : list) &#123;</span><br><span class="line">                    out += <span class="string">"Id: "</span> + it.getId()+ <span class="string">" "</span>;</span><br><span class="line">                    out += <span class="string">""</span> +</span><br><span class="line">                            <span class="string">""</span>;</span><br><span class="line">                    out += <span class="string">"Start time: "</span> + it.getStart().toString() + <span class="string">" "</span>;</span><br><span class="line">                    out += <span class="string">""</span> +</span><br><span class="line">                            <span class="string">""</span>;</span><br><span class="line">                    out += <span class="string">"End time: "</span> + it.getEnd() + <span class="string">" "</span>;</span><br><span class="line">                    out += <span class="string">""</span> +</span><br><span class="line">                            <span class="string">""</span>;</span><br><span class="line">                    out += <span class="string">"Label: "</span> + it.getLabel() + <span class="string">" "</span>;</span><br><span class="line">                    out += <span class="string">""</span> +</span><br><span class="line">                            <span class="string">""</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> out;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">delete</span><span class="params">(String username, <span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">short</span>) data.deleteItem(username, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">clear</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">short</span>) data.clear(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Database <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面在客户端实现整个程序的运行流程，自定义方法run(),并将Corba对象作为参数传入  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line">public void run(Corba corba)&#123;</span><br><span class="line">        boolean stop = false;</span><br><span class="line">        Scanner scan = new Scanner(System.in);</span><br><span class="line">        String username = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">        while (!stop) &#123;</span><br><span class="line">            String input = scan.nextLine();</span><br><span class="line">            String[] split = input.split(&quot; &quot;);</span><br><span class="line">            if (split.length &lt;= 0) &#123;</span><br><span class="line">                System.out.println(&quot;Input error!&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                switch (split[0]) &#123;</span><br><span class="line">                    case &quot;register&quot;:</span><br><span class="line">                        System.out.println(&quot;username:&quot;);</span><br><span class="line">                        String m_username = scan.nextLine();</span><br><span class="line"></span><br><span class="line">                        System.out.println(&quot;password:&quot;);</span><br><span class="line">                        String m_pass = scan.nextLine();</span><br><span class="line">                        int i = corba.regist(m_username, m_pass);</span><br><span class="line">                        switch (i) &#123;</span><br><span class="line">                            case 0:</span><br><span class="line">                                System.out.println(&quot;Success!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                            case -1:</span><br><span class="line">                                System.out.println(&quot;The username has been used!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                            case -2:</span><br><span class="line">                                System.out.println(&quot;Unknown error!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;login&quot;:</span><br><span class="line">                        System.out.println(&quot;username:&quot;);</span><br><span class="line">                        String n_username = scan.nextLine();</span><br><span class="line"></span><br><span class="line">                        System.out.println(&quot;password:&quot;);</span><br><span class="line">                        String n_pass = scan.nextLine();</span><br><span class="line">                        int k = corba.login(n_username, n_pass);</span><br><span class="line">                        switch (k) &#123;</span><br><span class="line">                            case 0:</span><br><span class="line">                                System.out.println(&quot;User &quot; + n_username + &quot; has logged in&quot;);</span><br><span class="line">                                username = n_username;</span><br><span class="line">                                break;</span><br><span class="line">                            case -1:</span><br><span class="line">                                System.out.println(&quot;Wrong password!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                            case -2:</span><br><span class="line">                                System.out.println(&quot;The username &quot; + n_username + &quot; has not been registered!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;add&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            System.out.println(&quot;Input start time in this type yyyy/MM/dd HH:mm:ss.SSS&quot;);</span><br><span class="line">                            String starttime = scan.nextLine();</span><br><span class="line">                            System.out.println(&quot;Input end time in this type yyyy/MM/dd HH:mm:ss.SSS&quot;);</span><br><span class="line">                            String endtime = scan.nextLine();</span><br><span class="line">                            System.out.println(&quot;Input the label information&quot;);</span><br><span class="line">                            String label = scan.nextLine();</span><br><span class="line">                            int p = corba.add(username, starttime, endtime, label);</span><br><span class="line">                            switch (p) &#123;</span><br><span class="line">                                case 0:</span><br><span class="line">                                    System.out.println(&quot;Success!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case -2:</span><br><span class="line">                                    System.out.println(&quot;Unknow error!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case -9:</span><br><span class="line">                                    System.out.println(&quot;Unable to initilize the item!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                     &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;query&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">                            System.out.println(&quot;Input start time in this type yyyy/MM/dd HH:mm:ss.SSS&quot;);</span><br><span class="line">                            String starttime = scan.nextLine();</span><br><span class="line">                            System.out.println(&quot;Input end time in this type yyyy/MM/dd HH:mm:ss.SSS&quot;);</span><br><span class="line">                            String endtime = scan.nextLine();</span><br><span class="line">                            Date date1 = null;</span><br><span class="line">                            String p = corba.query(username, starttime, endtime);</span><br><span class="line">                            if(p == null) &#123;</span><br><span class="line">                                System.out.println(&quot;Unknown error!&quot;);</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                System.out.println(p);</span><br><span class="line">                                System.out.println(&quot;Query finished&quot;);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;delete&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            System.out.println(&quot;Input the id of the item you want to delete:&quot;);</span><br><span class="line">                            Long id = scan.nextLong();</span><br><span class="line">                            int m = corba.delete(username, id);</span><br><span class="line">                            switch (m) &#123;</span><br><span class="line">                                case 0:</span><br><span class="line">                                    System.out.println(&quot;Success!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case -1:</span><br><span class="line">                                    System.out.println(&quot;The item is not found&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case -2:</span><br><span class="line">                                    System.out.println(&quot;Unknown error!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;clear&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            System.out.println(&quot;Are you going to clear the items list? Y/N&quot;);</span><br><span class="line">                            String pandaun = scan.nextLine();</span><br><span class="line">                            switch (pandaun) &#123;</span><br><span class="line">                                case &quot;N&quot;:</span><br><span class="line">                                case &quot;n&quot;:</span><br><span class="line">                                    System.out.println(&quot;Canceled&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case &quot;Y&quot;:</span><br><span class="line">                                case &quot;y&quot;:</span><br><span class="line">                                    int l = corba.clear(username);</span><br><span class="line">                                    if(l == -1) &#123;</span><br><span class="line">                                        System.out.println(&quot;Unknown username!&quot;);</span><br><span class="line">                                        break;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    System.out.println(&quot;Success!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;logout&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            System.out.println(&quot;Are you ready to log out? Y/N&quot;);</span><br><span class="line">                            String p = scan.nextLine();</span><br><span class="line">                            switch (p) &#123;</span><br><span class="line">                                case &quot;N&quot;:</span><br><span class="line">                                case &quot;n&quot;:</span><br><span class="line">                                    System.out.println(&quot;Canceled&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case &quot;Y&quot;:</span><br><span class="line">                                case &quot;y&quot;:</span><br><span class="line">                                    username = null;</span><br><span class="line">                                    System.out.println(&quot;Logged out&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;quit&quot;:</span><br><span class="line">                        System.out.println(&quot;Are you ready to quit? Y/N&quot;);</span><br><span class="line">                        String q = scan.nextLine();</span><br><span class="line">                        switch (q) &#123;</span><br><span class="line">                            case &quot;N&quot;:</span><br><span class="line">                            case &quot;n&quot;:</span><br><span class="line">                                System.out.println(&quot;Canceled&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;Y&quot;:</span><br><span class="line">                            case &quot;y&quot;:</span><br><span class="line">                                stop = true;</span><br><span class="line">                                System.out.println(&quot;quit!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line"></span><br><span class="line">                    case &quot;help&quot;:</span><br><span class="line">                        System.out.println(&quot;Input register for User Registration&quot;);</span><br><span class="line">                        System.out.println(&quot;Input login for User Login&quot;);</span><br><span class="line">                        System.out.println(&quot;Input logout for User Logout&quot;);</span><br><span class="line">                        System.out.println(&quot;Input add for Adding Items&quot;);</span><br><span class="line">                        System.out.println(&quot;Input query for Querying Items&quot;);</span><br><span class="line">                        System.out.println(&quot;Input delete for Deleting Items&quot;);</span><br><span class="line">                        System.out.println(&quot;Input clear for Clearing Items&quot;);</span><br><span class="line">                        System.out.println(&quot;Input quit to stop&quot;);</span><br><span class="line">                        System.out.println(&quot;Input help for Help&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                    default:</span><br><span class="line">                        System.out.println(&quot;Error input&quot;);</span><br><span class="line">                        break;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>  在run(String[] args)中调用这个run(corba),程序运行，然后按照上述过程一次打开端口，运行服务器，运行客户端，就可以进行测试。</p>
<h4 id="源码传到了github上。"><a href="#源码传到了github上。" class="headerlink" title="源码传到了github上。"></a>源码传到了<a href="https://github.com/channel960608/CORBA" target="_blank" rel="noopener">github</a>上。</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2017/06/01/CORBA简介与简单实践/" data-id="cjfv1oauo0002rvzn7tew8e4f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CORBA/">CORBA</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/06/03/Java开发手册阅读整理/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Java开发手册阅读整理
        
      </div>
    </a>
  
  
    <a href="/2017/05/27/Hexo通过本地化设置提高访问字体库效率/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hexo通过本地化设置提高访问字体库效率</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
<!--高速版，加载速度快，使用前需测试页面的兼容性-->
<div id="SOHUCS" sid="CORBA简介与简单实践" style="padding: 0px 30px 0px 46px;"></div>
<script>
  (function(){
    var appid = 'cyt29gnpS',
    conf = 'ab6fb0a4df25f655315dc29bcd3837b3';
    var doc = document,
    s = doc.createElement('script'),
    h = doc.getElementsByTagName('head')[0] || doc.head || doc.documentElement;
    s.type = 'text/javascript';
    s.charset = 'utf-8';
    s.src =  'http://assets.changyan.sohu.com/upload/changyan.js?conf='+ conf +'&appid=' + appid;
    h.insertBefore(s,h.firstChild);
    window.SCS_NO_IFRAME = true;
  })()
</script>
  </section>
  </section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/" class="logo">Coder Am I</a>
      &copy; 2018 Channel<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollLoading.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>