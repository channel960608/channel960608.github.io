<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta name="baidu-site-verification" content="zhTMODK6kb" />
  <meta http-equiv="content-language" content="zh-cn">
  
  <title>Coder Am I</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Channel&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Coder Am I">
<meta property="og:url" content="http://channel960608.github.io/index.html">
<meta property="og:site_name" content="Coder Am I">
<meta property="og:description" content="Channel&apos;s blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Coder Am I">
<meta name="twitter:description" content="Channel&apos;s blog">
  
  
    <link rel="icon" href="/favicon.png">
  
  <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> -->
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <!--<link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">-->
  <!--<link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>-->
  <link href="/css/fonts/font.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  

</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/" class="logo">Coder Am I</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about/index.html">About</a>
        
          <a class="main-nav-link" href="/board">Board</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://channel960608.github.io"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/channel960608" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>
      <nav id="mobile-nav" class="off">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about/index.html" class="mobile-nav-link">About</a>
  
    <a href="/board" class="mobile-nav-link">Board</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://channel960608.github.io"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/11/通过20newsgroups案例进行Sklearn入门学习/">通过20newsgroups案例进行Sklearn入门学习</a>
          </li>
        
          <li>
            <a href="/2018/04/08/k近邻算法中kd树的实现/">k近邻算法中kd树的实现</a>
          </li>
        
          <li>
            <a href="/2018/03/19/一致性hash算法/">一致性hash算法原理简要理解</a>
          </li>
        
          <li>
            <a href="/2017/07/21/航天航空与臭虫/">航天航空与臭虫</a>
          </li>
        
          <li>
            <a href="/2017/06/18/JavaWeb会话与状态管理-Session机制学习/">JavaWeb会话与状态管理--Session机制学习</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CORBA/">CORBA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Web/">Java Web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine-Learning/">Machine Learning</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat-Linux/">Tomcat && Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/其他/">其他</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式数据库/">分布式数据库</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CORBA/" style="font-size: 10px;">CORBA</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Java-Web/" style="font-size: 10px;">Java Web</a> <a href="/tags/Machine-Learning/" style="font-size: 20px;">Machine Learning</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Tomcat-Linux/" style="font-size: 10px;">Tomcat && Linux</a> <a href="/tags/其他/" style="font-size: 10px;">其他</a> <a href="/tags/分布式数据库/" style="font-size: 10px;">分布式数据库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main">
  
    <article id="post-通过20newsgroups案例进行Sklearn入门学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/11/通过20newsgroups案例进行Sklearn入门学习/" class="article-date">
  <time datetime="2018-04-11T10:29:55.000Z" itemprop="datePublished">2018-04-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/11/通过20newsgroups案例进行Sklearn入门学习/">通过20newsgroups案例进行Sklearn入门学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录</strong>
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#通过20newsgroups案例进行Sklearn入门学习"><span class="toc-number">1.</span> <span class="toc-text"><a href="#&#x901A;&#x8FC7;20newsgroups&#x6848;&#x4F8B;&#x8FDB;&#x884C;Sklearn&#x5165;&#x95E8;&#x5B66;&#x4E60;" class="headerlink" title="&#x901A;&#x8FC7;20newsgroups&#x6848;&#x4F8B;&#x8FDB;&#x884C;Sklearn&#x5165;&#x95E8;&#x5B66;&#x4E60;"></a>&#x901A;&#x8FC7;20newsgroups&#x6848;&#x4F8B;&#x8FDB;&#x884C;Sklearn&#x5165;&#x95E8;&#x5B66;&#x4E60;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#流程"><span class="toc-number">1.0.1.</span> <span class="toc-text"><a href="#&#x6D41;&#x7A0B;" class="headerlink" title="&#x6D41;&#x7A0B;"></a>&#x6D41;&#x7A0B;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加载数据集"><span class="toc-number">1.0.2.</span> <span class="toc-text"><a href="#&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x96C6;" class="headerlink" title="&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x96C6;"></a>&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x96C6;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#提取feature"><span class="toc-number">1.0.3.</span> <span class="toc-text"><a href="#&#x63D0;&#x53D6;feature" class="headerlink" title="&#x63D0;&#x53D6;feature"></a>&#x63D0;&#x53D6;feature</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分类训练"><span class="toc-number">1.0.4.</span> <span class="toc-text"><a href="#&#x5206;&#x7C7B;&#x8BAD;&#x7EC3;" class="headerlink" title="&#x5206;&#x7C7B;&#x8BAD;&#x7EC3;"></a>&#x5206;&#x7C7B;&#x8BAD;&#x7EC3;</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Naive-Bayes-朴素贝叶斯法"><span class="toc-number">1.0.4.0.1.</span> <span class="toc-text"><a href="#Naive-Bayes-&#x6734;&#x7D20;&#x8D1D;&#x53F6;&#x65AF;&#x6CD5;" class="headerlink" title="Naive Bayes  &#x6734;&#x7D20;&#x8D1D;&#x53F6;&#x65AF;&#x6CD5;"></a>Naive Bayes  &#x6734;&#x7D20;&#x8D1D;&#x53F6;&#x65AF;&#x6CD5;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#KNN-k近邻算法"><span class="toc-number">1.0.4.0.2.</span> <span class="toc-text"><a href="#KNN-k&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;" class="headerlink" title="KNN  k&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;"></a>KNN  k&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SVN-支持向量机"><span class="toc-number">1.0.4.0.3.</span> <span class="toc-text"><a href="#SVN-&#x652F;&#x6301;&#x5411;&#x91CF;&#x673A;" class="headerlink" title="SVN  &#x652F;&#x6301;&#x5411;&#x91CF;&#x673A;"></a>SVN  &#x652F;&#x6301;&#x5411;&#x91CF;&#x673A;</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模型评估"><span class="toc-number">1.0.5.</span> <span class="toc-text"><a href="#&#x6A21;&#x578B;&#x8BC4;&#x4F30;" class="headerlink" title="&#x6A21;&#x578B;&#x8BC4;&#x4F30;"></a>&#x6A21;&#x578B;&#x8BC4;&#x4F30;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-number">1.0.6.</span> <span class="toc-text"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</span></a></li></ol></li></ol></li></ol>
        </div>
        

        <h1 id="通过20newsgroups案例进行Sklearn入门学习"><a href="#通过20newsgroups案例进行Sklearn入门学习" class="headerlink" title="通过20newsgroups案例进行Sklearn入门学习"></a>通过20newsgroups案例进行Sklearn入门学习</h1><p>为了对sklearn进行学习，在下将20newsgroups案例作为文本分析入手项目，并参考这篇<a href="https://blog.csdn.net/abcjennifer/article/details/23615947" target="_blank" rel="noopener">博客</a>完成了代码的编写并编译通过。下面进一步分析代码。  </p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><ul>
<li>加载数据集</li>
<li>提取feature</li>
<li>分类<ul>
<li>Naive Beyes</li>
<li>KNN</li>
<li>SVM</li>
</ul>
</li>
<li>聚类  </li>
</ul>
<h3 id="加载数据集"><a href="#加载数据集" class="headerlink" title="加载数据集"></a>加载数据集</h3><p>数据集下载<a href="http://qwone.com/~jason/20Newsgroups/20news-19997.tar.gz" target="_blank" rel="noopener">20news-19997.tar.gz</a>,下载后解压到根目录的<code>~/scikit_learn_data/</code>目录下，这个是数据默认路径。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> fetch_20newsgroups</span><br><span class="line">ategories = [<span class="string">'comp.graphics'</span>,</span><br><span class="line">    <span class="string">'comp.os.ms-windows.misc'</span>,</span><br><span class="line">    <span class="string">'comp.sys.ibm.pc.hardware'</span>,</span><br><span class="line">    <span class="string">'comp.sys.mac.hardware'</span>,</span><br><span class="line">    <span class="string">'comp.windows.x'</span>]</span><br><span class="line">newsgroup_train = fetch_20newsgroups(subset = <span class="string">'train'</span>, categories = categories)</span><br><span class="line">newsgroup_test = fetch_20newsgroups(subset = <span class="string">'test'</span>, categories = categories)</span><br></pre></td></tr></table></figure>
<p>对于<code>fetch_20newsgroups()</code>这个方法：<br><code>fetch_20newsgroups(data_home=None,subset=&#39;train&#39;,categories=None,shuffle=True,random_state=42,remove=(),download_if_missing=True)</code>  </p>
<ul>
<li><code>data_home</code> 数据集的地址，默认为<code>~/scikit_learn_data/</code>目录</li>
<li><code>subset</code> {train, test, all}三者可选，分别对应训练集，测试集，所有样本</li>
<li><code>categories</code> 类别，指定类别，可以提取出指定的目标类；如果是默认，则提取所有数据  </li>
<li><code>shuffle</code> 是否打乱文本顺序，如果相互独立的话  </li>
<li><code>random_state</code> 打乱顺序的随机种子</li>
<li><code>remove</code> 储存停用词的元组，例如标题引用</li>
<li><code>download_if_missing</code> 如果数据丢失则下载  </li>
</ul>
<h3 id="提取feature"><a href="#提取feature" class="headerlink" title="提取feature"></a>提取feature</h3><p>特征提取为数据挖掘任务最重要的环节之一，只有先提取出有效地特征，才能借助数据挖掘的力量找到问题的答案。常用的特征提取手段如下：</p>
<ul>
<li>DictVectorizer 将dict类型的list数据，转换成numpy array</li>
<li>FeatureHasher 特征哈希，相当于一种降维技巧</li>
<li>image 图像相关的特征提取</li>
<li>text 文本相关的特征提取  </li>
</ul>
<ol>
<li><p>text.CountVectorizer 将文本转换为每个词出现的个数的向量,总之用于标记和计数  </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer       </span><br><span class="line">vectorizer = CountVectorizer(min_df=<span class="number">1</span>)</span><br><span class="line">vectorizer</span><br><span class="line">  CountVectorizer(analyzer=...<span class="string">'word'</span>, binary=<span class="keyword">False</span>, charset=<span class="keyword">None</span>,</span><br><span class="line">  charset_error=<span class="keyword">None</span>, decode_error=...<span class="string">'strict'</span>,</span><br><span class="line">  dtype=&lt;... <span class="string">'numpy.int64'</span>&gt;, encoding=...<span class="string">'utf-8'</span>, input=...<span class="string">'content'</span>,</span><br><span class="line">  lowercase=<span class="keyword">True</span>, max_df=<span class="number">1.0</span>, max_features=<span class="keyword">None</span>, min_df=<span class="number">1</span>,</span><br><span class="line">  ngram_range=(<span class="number">1</span>, <span class="number">1</span>), preprocessor=<span class="keyword">None</span>, stop_words=<span class="keyword">None</span>,</span><br><span class="line">  strip_accents=<span class="keyword">None</span>, token_pattern=...<span class="string">'(?u)\\b\\w\\w+\\b'</span>,</span><br><span class="line">  tokenizer=<span class="keyword">None</span>, vocabulary=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p> 通过计数，来将一个文档转化为向量，即单词矩阵(a matrix of token counts)<br> <code>CountVectorizer()</code>方法的参数：</p>
<ul>
<li>input: string{‘filename’,’file’,’content’} 待分析的文件名，可读的文件，或者可以直接分析的字符串或字节项  </li>
<li>encoding 解码格式 默认 utf-8</li>
<li>decode_error: {‘strict’,’ignore’,’replace’} 解码错误之后的处理方式，默认 strict</li>
<li>strip_accents: {‘ascii’,’unicode’,None} 去除特殊字符，使用ascii更快，unicode更慢但可以对任何字符使用</li>
<li>analyzer: string,{‘word’,’char’,’char_wb’} or callable 是否将特征转化为word（单词），char（n-grams，一种简化单词的方式）或者char_wb（将单词表示成n-grams的形式）</li>
<li>preprcessor: callable or None(default) 改写预处理函数，同时保留标记和n-grams处理过程</li>
<li>tokenizer: callable or None(default) 改写字符串标记步骤，同时保留预处理和n-grams步骤</li>
<li>ngram-range: tuple(min_n,max_n) 在[min_n,max_n]范围内的n值会被用于n-grams提取</li>
<li>stop_words: string {‘english’},list,or None(default) 停用词，使用英文停用词列表，或者使用自己的字符串作为停用词列表，或者不使用停用词，这时可以将max_df设置到[0.7,1.0],自动检验和过滤基于其语料库的停用词</li>
<li>lowercase: boolean, default True  将所有字符转换为小写  </li>
<li>token_pattern string 构成token的正则表达式，在tokenize == ‘word’ 时启用。默认的正则式为选择两个或两个以上的字符(标点符号是被忽略的，仅当做token的分割)</li>
<li>max_df float in range[0.0，1.0] or int, optional, 1 by default 构建忽略词的字典的时候，这些忽略词要求要严格的低于给定的阈值。这个值在书中称之为截至值，如果是浮点数，那么代表的是文档中的比例，如果是整数那么就是绝对计数值。如果字典不是空的话，这个参数被忽略</li>
<li>max_features optional, None by default 非None时，构建词典的时候仅仅考虑语料库里词频最高的那些特征，如果词典非空，那么这个参数被忽略</li>
<li>vocabulary Mapping or iterable, optional 词作为key，value在特征矩阵中可以索引；或者是一个单词的迭代；如果没有给定，则在输入的文档库中选择</li>
<li>binary boolean, False by default 如果为真，则所有非零的计数被置为1.这对离散的只针对二值事件而非整数计数的概率模型非常有用  </li>
<li>dtype: type, optional 通过fit_transform() or transform() 处理之后返回矩阵的类型.</li>
</ul>
</li>
<li><p>text.TfidfVectorizer 将文本转换为tfidf值的向量<br>为了重新计算特征的计数权重，过滤掉一些常见的且没有实际意义的信息，转化为适合分类器使用的浮点值，我们使用tf-idf转换。词频(term frequency, TF)指某一个给定的词语在该文件中出现的频率，这个数字通常被归一化，为了防止其偏向长的文件。逆向文件频率(inverse document frequency, IDF)是一个词语普遍重要性的度量，主要思想是：如果包含词条t的文档越少，那么IDF越大，说明词条具有更强的类别区分能力  </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfTransformer</span><br><span class="line">transformer = TfidfTransformer()</span><br><span class="line">transformer</span><br><span class="line"></span><br><span class="line">TfidfTransformer(norm=...<span class="string">'l2'</span>, smooth_idf=<span class="keyword">True</span>, sublinear_tf=<span class="keyword">False</span>,</span><br><span class="line">                 use_idf=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<p><code>TfidfTransformer()</code>方法的参数：</p>
<ul>
<li>norm: ‘l1’,’l2’ or None, optional  norm参数用来正则化（归一化）词条向量，none则不进行正则化（归一化）（L1正则化和L2正则化可以看做是损失函数的惩罚项）</li>
<li>user_idf: boolean,default=True 使用逆向文件频率(idf)来进行加权</li>
<li>smooth_idf: boolean,default=Ture 平滑idf权重</li>
<li>sublinear_tf :booelean, default=False 使用亚曲线，例如使用<code>1 + log(tf)</code>来代替<code>tf</code>  </li>
<li><p>text.HashingVectorizer 文本的特征哈希<br>使用Hash Trick算法，将文本的特征进行降低。在降为之后，我们就无法解释特征向量中每一个维度的意义了，因此hash trick的解释性不强。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashingVectorizer(input=<span class="string">'content'</span>, encoding=<span class="string">'utf-8'</span>, decode_error=<span class="string">'strict'</span>, strip_accents=<span class="keyword">None</span>, lowercase=<span class="keyword">True</span>, preprocessor=<span class="keyword">None</span>, tokenizer=<span class="keyword">None</span>, stop_words=<span class="keyword">None</span>, token_pattern=<span class="string">'(?u)\b\w\w+\b'</span>, ngram_range=(<span class="number">1</span>, <span class="number">1</span>), analyzer=<span class="string">'word'</span>, n_features=<span class="number">1048576</span>, binary=<span class="keyword">False</span>, norm=<span class="string">'l2'</span>, alternate_sign=<span class="keyword">True</span>, non_negative=<span class="keyword">False</span>, dtype=&lt;<span class="class"><span class="keyword">class</span> '<span class="title">numpy</span>.<span class="title">float64</span>'&gt;)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>使用HashingVectorizer，规定feature个数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> HashingVectorizer</span><br><span class="line">vectorizer = HashingVectorizer(stop_words = <span class="string">'english'</span>, non_negative = <span class="keyword">True</span>,</span><br><span class="line">    n_features = <span class="number">10000</span>)</span><br><span class="line">fea_train = vectorizer.fit_transform(newsgroup_train.data)</span><br><span class="line">fea_test = vectorizer.fit_transform(newsgroup_test.data)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'size of fea_train:'</span> + repr(fea_train.shape))</span><br><span class="line">print(<span class="string">'size of fea_test:'</span> + repr(fea_test.shape))</span><br><span class="line"></span><br><span class="line">print(<span class="string">'The average feature sparsity is &#123;0:.3f&#125;%'</span>.format(</span><br><span class="line">fea_train.nnz/float(fea_train.shape[<span class="number">0</span>] * fea_train.shape[<span class="number">1</span>]) * <span class="number">100</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><code>HashingVectorizer()</code>方法的参数：</p>
<ul>
<li>input:  </li>
<li>encoding</li>
<li>decode_error</li>
<li>strip_accents</li>
<li>analyzer</li>
<li>preprocessor<br>tokenizer</li>
<li>ngram_range</li>
<li>stop_words</li>
<li>lowercase</li>
<li>token_pattern</li>
<li>n_features integer,default = (2 ** 20) 选择特征的数量。这个值太小的话会导致哈希碰撞(hash collisions)，太大的话起不到降维的效果(cause larger coefficient dimensions in linear leariners)</li>
<li>norm  ‘l1’, ‘l2’ or None, optional 正则化向量的方法</li>
<li>binary</li>
<li>dtype</li>
<li>alternate_sign boolean, optional, default True  <code>When True, an alternating sign is added to the features as to approximately conserve the inner product in the hashed space even for small n_features. This approach is similar to sparse random projection.</code></li>
<li><p>non_negative  boolean, optional, default False 对返回的特征矩阵的值取绝对值，这样会 <code>significantly reduces the inner product preservation property</code></p>
<p>其他参数的用法和<code>CountVectorizer()</code>一致  </p>
</li>
</ul>
</li>
</ol>
<h3 id="分类训练"><a href="#分类训练" class="headerlink" title="分类训练"></a>分类训练</h3><p>具体实现时用到了三种模型进行分类   </p>
<h5 id="Naive-Bayes-朴素贝叶斯法"><a href="#Naive-Bayes-朴素贝叶斯法" class="headerlink" title="Naive Bayes  朴素贝叶斯法"></a>Naive Bayes  朴素贝叶斯法</h5>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'*************************\nNaive Bayes\n*************************'</span>)</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> MultinomialNB <span class="comment"># 先验为多项式的朴素贝叶斯</span></span><br><span class="line">clf = MultinomialNB(alpha = <span class="number">0.01</span>)</span><br><span class="line"><span class="comment"># 拟合数据</span></span><br><span class="line">clf.fit(tfidf_train_2, newsgroup_train.target)</span><br><span class="line"><span class="comment"># 预测测试集</span></span><br><span class="line">pred = clf.predict(tfidf_test_2)</span><br></pre></td></tr></table></figure>
<p>  <code>MultinomialNB()</code> 先验为多项式的朴素贝叶斯，  </p>
<script type="math/tex; mode=display">P(X_j = x_{jl}|Y = C_k) = \frac{x_{jl} + \lambda}{m_k + n \lambda}</script><p>  参数如下：</p>
<ul>
<li>alpha: 即上述公式中的 $\lambda$ ,一般默认为1，称做拉普拉斯平滑。如果发现拟合不好，需要调优时，可以选择稍微大于1或者稍微小于1的数。</li>
<li>fit_prior boolean，表示是否考虑先验概率。如果是false，则所有的样品类别输出都有相容的类别先验概率。否则用第三个参数class_prior输入先验概率，或者不输入第三个参数class_prior，让MultinomialNB自己从训练集样本来计算先验概率，此时的先验概率 $P(Y = C_k) = m_k/m$ 。其中 $m$ 为训练样本总数量， $m_k$ 为第k类别的训练集样品数。  总结如下：  </li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">fit_prior</th>
<th style="text-align:left">class_prior</th>
<th style="text-align:left">最终先验概率</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">false</td>
<td style="text-align:left">填不填没有意义</td>
<td style="text-align:left">$P(Y = C_k) = 1/k$</td>
</tr>
<tr>
<td style="text-align:left">true</td>
<td style="text-align:left">不填</td>
<td style="text-align:left">$P(Y = C_k) = m_k/m$</td>
</tr>
<tr>
<td style="text-align:left">true</td>
<td style="text-align:left">填</td>
<td style="text-align:left">$P(Y = C_k) = class_prior$</td>
</tr>
</tbody>
</table>
</div>
<p>  来自<a href="https://www.cnblogs.com/pinard/p/6074222.html" target="_blank" rel="noopener">scikit-learn 朴素贝叶斯类库使用小结</a>  </p>
<h5 id="KNN-k近邻算法"><a href="#KNN-k近邻算法" class="headerlink" title="KNN  k近邻算法"></a>KNN  k近邻算法</h5>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line">print(<span class="string">'*************************\nKNN\n*************************'</span>)</span><br><span class="line">knnclf = KNeighborsClassifier()<span class="comment">#default with k=5</span></span><br><span class="line">knnclf.fit(tfidf_train_2,newsgroup_train.target)</span><br><span class="line">pred = knnclf.predict(tfidf_test_2)</span><br></pre></td></tr></table></figure>
<p>  <code>KNeighborsClassifier()</code>方法参数:</p>
<pre><code>- n_neighbors:int,optional default=5 k近邻算法中k的值，或者说k近邻搜索中选取最近的点的个数
- weights: str or callable, optional default = &#39;uniform&#39;
  - &#39;uniform&#39; 统一权重
  - &#39;distance&#39; 点的权重与距离成反比
  - [callable] 使用用户自定义的函数
- algorithm:  {‘auto’, ‘ball_tree’, ‘kd_tree’, ‘brute’}, optional 实现算法，BallTree， KDTree， brute-force search. &#39;auto&#39;会根据传入到fit方法中的值来决定最合适的实现算法
- leaf_size: int optional default = 30 传入BallTree或KDTree中的叶子结点个数   
- p:  integer,optional default=2 距离度量，p=1时是曼哈顿距离(Manhattan distance)，p=2时是欧式距离(Euclidean distance)  
- metric: string or callable, default &#39;minkowski&#39; 计算距离的公式，默认为Minkowski距离  
- metric_params: dict,optional default=None  上面自己定义的距离度量函数的参数
- n_jobs: int, optional default = 1 近邻搜索时的并行工作数量 如果设置为-1，则设置为cpu的核心数   
</code></pre><h5 id="SVN-支持向量机"><a href="#SVN-支持向量机" class="headerlink" title="SVN  支持向量机"></a>SVN  支持向量机</h5>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line">print(<span class="string">'*************************\nSVM\n*************************'</span>)</span><br><span class="line">svclf = SVC(kernel = <span class="string">'linear'</span>)</span><br><span class="line">svclf.fit(tfidf_train_2,newsgroup_train.target)</span><br><span class="line">pred = svclf.predict(tfidf_test_2)</span><br></pre></td></tr></table></figure>
<p>  <code>SVC()</code>这个函数是基于<code>libsvm</code>实现的，在参数设置上也有很多相似的地方。<br>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  sklearn.svm.SVC(C=<span class="number">1.0</span>, kernel=<span class="string">'rbf'</span>, degree=<span class="number">3</span>, gamma=<span class="string">'auto'</span>, coef0=<span class="number">0.0</span>, shrinking=<span class="keyword">True</span>, probability=<span class="keyword">False</span>,tol=<span class="number">0.001</span>, cache_size=<span class="number">200</span>, class_weight=<span class="keyword">None</span>, verbose=<span class="keyword">False</span>, max_iter=<span class="number">-1</span>, decision_function_shape=<span class="keyword">None</span>,random_state=<span class="keyword">None</span>)```     </span><br><span class="line">  参数：</span><br><span class="line">    - C: float, optional default=<span class="number">1.0</span> C-SVC的惩罚参数 C越大，相对于惩罚松弛变量，希望松弛变量接近<span class="number">0</span>，即对误分类的惩罚增大，趋向于对训练集全分对的情况，这样对训练集测试时准确率很高，但泛化能力弱。C值小，对误分类的惩罚减小，允许容错，将他们当成噪声点，泛化能力较强。</span><br><span class="line">    - kernel: string, optional &#123;<span class="string">'linear'</span>, <span class="string">'poly'</span>, <span class="string">'rbf'</span>, <span class="string">'sigmoid'</span>, <span class="string">'precomputed'</span>, callable&#125;，default = <span class="string">'rbf'</span>  核函数，可选择 线性，多项式，rbf函数，sigmoid函数</span><br><span class="line">    - degree: integer, optional default=<span class="number">3</span> 多项式poly函数的维度  </span><br><span class="line">    - gamma: float, optional default=<span class="number">0.0</span>  ‘rbf’,‘poly’ 和‘sigmoid’的核函数参数。默认是’auto’，则会选择<span class="number">1</span>/n_features  </span><br><span class="line">    - coef0: float, optional default=<span class="keyword">True</span> 核函数的常数项，应用于<span class="string">'poly'</span>和<span class="string">'sigmoid'</span></span><br><span class="line">    - probability: boolean, optional default=<span class="keyword">True</span>  是否使用概率估计(probability estimates), 这必须在fit之前调用，bong将减低fit方法的速度</span><br><span class="line">    - shrinking: boolean, optional default=true  是否采用shrinking heuristic方法</span><br><span class="line">    - tol: float, optional default = <span class="number">1e-3</span>  停止训练的误差值大小</span><br><span class="line">    - cache_size: float, optional   核函数的cache缓存大小  </span><br><span class="line">    - class_weight: &#123;dict, <span class="string">'balanced'</span>&#125;, optional  类别的权重，字典形式传递</span><br><span class="line">    - verbose: bool, default = <span class="keyword">False</span>  允许冗余输出(verbose output),只使用与单线程的方法，在多线程中可能出错</span><br><span class="line">    - max_iter: int, optional, default=<span class="number">-1</span> 最大迭代次数， <span class="number">-1</span>为无限制</span><br><span class="line">    - decision_function_shape: <span class="string">'ovo'</span>, <span class="string">'ovr'</span>, default = <span class="string">'ovr'</span>  </span><br><span class="line">    - random_state: int，RandomState instance <span class="keyword">or</span> <span class="keyword">None</span>, optional  default=<span class="keyword">None</span> 数据洗牌时的种子  </span><br><span class="line">    来自[sklearn.svm.SVC 参数说明](https://blog.csdn.net/szlcw1/article/details/<span class="number">52336824</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### 聚类  </span></span><br><span class="line">这边使用的是KMeans聚类算法</span><br><span class="line"></span><br><span class="line">```python  <span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans</span><br><span class="line">print(<span class="string">'*************************\nKMeans\n*************************'</span>)</span><br><span class="line">pred = KMeans(n_clusters=<span class="number">5</span>)</span><br><span class="line">pred.fit(tfidf_test_2)</span><br><span class="line">calculate_result(newsgroup_test.target,pred.labels_)</span><br></pre></td></tr></table></figure></p>
<p>关于<code>KMeans()</code>方法的参数:</p>
<ul>
<li>n_clusters: int,optional, default=8 数据分组数量，或者生成质心的数量  </li>
<li>init : {‘k-means++’, ‘random’ or an ndarray} default=’k-means++’  </li>
<li>n_init : int, default=10</li>
<li>max_iter : int, default: 300 一次运行中KMeans算法的最大迭代次数  </li>
<li>tol : float, default=1e-4 停止训练的误差值大小  </li>
<li>precompute_distances : {‘auto’, True, False} 预先计算距离（更快但消耗内存）<ul>
<li>auto n_samples * n_clusters &gt; 12 million则不使用预先计算</li>
<li>True</li>
<li>False</li>
</ul>
</li>
<li>verbose : int, default=0 冗余模式(verbosity mode)</li>
<li>random_state : int, RandomState instance or None, optional, default=None 数据洗牌时的种子</li>
<li>copy_x : boolean, default=True  是否复制原始数据 True复制原始数据，因此不修改原始数据，False则使用修改后的原始数据。</li>
<li>n_jobs : int 并行数量 -1则与cpu核心数相同</li>
<li>algorithm : “auto”, “full” or “elkan”, default=”auto” 选择实现算法  </li>
</ul>
<h3 id="模型评估"><a href="#模型评估" class="headerlink" title="模型评估"></a>模型评估</h3><p>模型的评估一般使用PRF（精确率，召回率，F1值）和Acc值（准确值）来评估，我们定义了<code>calculate_result()</code>来进行评估。  </p>
<figure class="highlight python"><figcaption><span>from sklearn import metrics</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_result</span><span class="params">(actual, pred)</span>:</span></span><br><span class="line">  m_precision = metrics.precision_score(actual,pred, average=<span class="string">'weighted'</span>)</span><br><span class="line">  m_recall = metrics.recall_score(actual, pred, average=<span class="string">'weighted'</span>)</span><br><span class="line"></span><br><span class="line">  print(<span class="string">'predict info:'</span>)</span><br><span class="line">  print(<span class="string">'precision:&#123;0:.3f&#125;'</span>.format(m_precision))</span><br><span class="line">  print(<span class="string">'recall:&#123;0:0.3f&#125;'</span>.format(m_recall))</span><br><span class="line">  print(<span class="string">'f1-score:&#123;0:.3f&#125;'</span>.format(metrics.f1_score(actual,pred,average=<span class="string">'weighted'</span>)))</span><br></pre></td></tr></table></figure>
<p>其中的定义</p>
<ol>
<li>TP，True Positive 做出pos判断且判断正确</li>
<li>FP，False Positive 做出pos判断且判断错误</li>
<li>TN，True Negative 做出neg判断且判断正确</li>
<li>FN，False Negative 做出neg判断且判断错误</li>
</ol>
<ul>
<li>precision 精确率 precision = TP / (TP + FP) 即所有做出pos判断的判定中判断正确的概率</li>
<li>recall 召回率  recall = TP / (TP + FN) 即所有应该被判断为pos的对象中被判断为pos的概率</li>
<li>accuracy 准确度 accuracy = (TP + TN) / (TP + FP + TN + FN) 即所有判断中，判断正确的概率</li>
<li>F1 score = 2 <em> P </em> R / (P + R) 其中P为precision, R为 recall</li>
</ul>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>最后，我选择<code>fetch_20newsgroups_vectorized()</code>方法提取的特征来训练分类聚类模型，最后的输出如下</p>
<pre><code class="lang-text">*************************
Naive Bayes
*************************
predict info:
precision:0.768
recall:0.766
f1-score:0.763
*************************
KNN
*************************
predict info:
precision:0.650
recall:0.641
f1-score:0.642
*************************
SVM
*************************
predict info:
precision:0.822
recall:0.818
f1-score:0.818
*************************
KMeans
*************************
predict info:
precision:0.077
recall:0.153
f1-score:0.093
</code></pre>
<p>不知为何聚类结果比原作者运行时的结果评分低了很多  </p>
<pre><code class="lang-text">*************************
KMeans
*************************
predict info:
precision:0.289
recall:0.313
f1-score:0.266
</code></pre>
<p>附上我这边能够运行的<a href="http://oqvbarc9z.bkt.clouddn.com/test_textanalyse.py" target="_blank" rel="noopener">代码</a><br>Environment：Python 3.6 + Scipy （scikit-learn）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2018/04/11/通过20newsgroups案例进行Sklearn入门学习/" data-id="cjfv1oav9000hrvznk5rbs46g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Machine-Learning/">Machine Learning</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-k近邻算法中kd树的实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/08/k近邻算法中kd树的实现/" class="article-date">
  <time datetime="2018-04-08T10:48:00.000Z" itemprop="datePublished">2018-04-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/08/k近邻算法中kd树的实现/">k近邻算法中kd树的实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录</strong>
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#k近邻算法中kd树的实现"><span class="toc-number">1.</span> <span class="toc-text"><a href="#k&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;&#x4E2D;kd&#x6811;&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="k&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;&#x4E2D;kd&#x6811;&#x7684;&#x5B9E;&#x73B0;"></a>k&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;&#x4E2D;kd&#x6811;&#x7684;&#x5B9E;&#x73B0;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#k近邻算法简述"><span class="toc-number">1.0.1.</span> <span class="toc-text"><a href="#k&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;&#x7B80;&#x8FF0;" class="headerlink" title="k&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;&#x7B80;&#x8FF0;"></a>k&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;&#x7B80;&#x8FF0;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据结构—kd树"><span class="toc-number">1.0.2.</span> <span class="toc-text"><a href="#&#x6570;&#x636E;&#x7ED3;&#x6784;&#x2014;kd&#x6811;" class="headerlink" title="&#x6570;&#x636E;&#x7ED3;&#x6784;&#x2014;kd&#x6811;"></a>&#x6570;&#x636E;&#x7ED3;&#x6784;&#x2014;kd&#x6811;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#搜索kd树算法"><span class="toc-number">1.0.3.</span> <span class="toc-text"><a href="#&#x641C;&#x7D22;kd&#x6811;&#x7B97;&#x6CD5;" class="headerlink" title="&#x641C;&#x7D22;kd&#x6811;&#x7B97;&#x6CD5;"></a>&#x641C;&#x7D22;kd&#x6811;&#x7B97;&#x6CD5;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码实现"><span class="toc-number">1.0.4.</span> <span class="toc-text"><a href="#&#x4EE3;&#x7801;&#x5B9E;&#x73B0;" class="headerlink" title="&#x4EE3;&#x7801;&#x5B9E;&#x73B0;"></a>&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</span></a></li></ol></li></ol></li></ol>
        </div>
        

        <h1 id="k近邻算法中kd树的实现"><a href="#k近邻算法中kd树的实现" class="headerlink" title="k近邻算法中kd树的实现"></a>k近邻算法中kd树的实现</h1><p>&emsp;&emsp;k近邻算法(k-nearest neighbor, k-NN)是比较基本的分类与回归算法。本文是参照《统计学习方法》一书对分类问题中k近邻算法的实现。<br>&emsp;&emsp;hexo博客中latex数学公式渲染的问题，参考这篇<a href="https://blog.csdn.net/u014630987/article/details/78670258" target="_blank" rel="noopener">博客</a>  </p>
<h3 id="k近邻算法简述"><a href="#k近邻算法简述" class="headerlink" title="k近邻算法简述"></a>k近邻算法简述</h3><p>输入： 训练数据集<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$T = \{(x_1,y_1),(x_2,y_2),\ldots,(x_N,y_N)\}$<br>&emsp;&emsp;其中，$x_i \in \cal X \subseteq R^n$ 为实例的特征向量，$y_i \in \cal Y = \{ c_1, c_2, \ldots, c_\rm K \}$ 为实例的类别， $i = 1, 2, \ldots, N$: 实例特征向量 $x$;<br>输出： 实例$x$所属的类$y$.</p>
<ol>
<li>在给定的距离度量，在训练集T中找到与 $x$ 最邻近的 $k$ 个点，涵盖这 $k$ 个点的 $x$ 的邻域记作$N_k(x)$;  </li>
<li>在$N_k(x)$ 中根据分类决策规则（如多数表决）决定 $x$ 的类别 $y$：<br>$y=arg \  max \sum_{x_i \subseteq N_k(x)} I(y_i = c_j), \ i = 1, 2, \ldots, N;$<br>上式中，$I$ 为指示函数，即当 $y_i = c_j$ 时 $I$ 为1，否则 $I$ 为 0.</li>
</ol>
<h3 id="数据结构—kd树"><a href="#数据结构—kd树" class="headerlink" title="数据结构—kd树"></a>数据结构—kd树</h3><p>&emsp;&emsp;k近邻算法在实现时主要考虑的问题是如何对训练的数据进行快速的k近邻搜索。为了在训练集很大时提高近邻搜索的效率，我们考虑使用特殊的结构存储训练数据。这里介绍的是kd树(kd tree)方法。  </p>
<p>&emsp;&emsp;kd树是一种对k位空间中的实例点进行存储以便于对其进行快速检索的二叉树结构。构造kd树相当于不断地利用垂直于坐标轴的的超平面将k维空间进行切分，构成一系列的k维超矩形区域。描述如下：  </p>
<ul>
<li>在超矩形区域(结点)上选择一个坐标轴和此坐标轴上的一个切分点，确定一个超平面，这个超平面通过选定的切分点并垂直于选定的坐标轴，将当前超矩形区域切分为左右两个子区域(子结点);这时，实例被分到两个子区域。这个过程直到子区域内没有实例时终止(终止时的结点为叶结点)。在此过程中，将实例保存到相应的结点上。</li>
<li><p>构造平衡kd树算法：<br>输入： $k$ 维空间数据集 $T = \{x_1,x_2,\ldots,x_N\}$ ,<br>其中 $x_i = (x_i^{(1)},x_i^{(2)}, \ldots , x_i^{(k)})^T, \ i = 1, 2, \ldots, N;$<br>输出： kd树.  </p>
<ol>
<li>开始：构造根结点，根结点对应于包含T的k维空间的超矩形区域。<br>&emsp;&emsp;选择 $x^{(1)}$ 为坐标轴，以 $T$ 中所有实例的 $x^{(1)}$ 坐标的中位数为切分点， 将根结点对应的超矩形区域切分为两个子区域. 切分由通过切分点并与坐标轴 $x^{(1)}$ 垂直的超平面实现。<br>&emsp;&emsp;由根结点实现连个深度为1的左右子结点：左子结点对应坐标 $x^{(1)}$ 小于切分点的子区域，右子结点对应坐标 $x^{(1)}$ 大于切分点的子区域。</li>
<li>重复：对深度为j的结点，选择 $x^{(l)}$ 为切分点的坐标轴， $l = j(mod k) + 1$ ,以该结点的区域中所有实例的 $x^{(l)}$ 坐标的中位数为切分点，将该结点对应的超矩形区域切分为两个子区域。切分由通过切分点并与坐标轴 $x^{(l)}$ 垂直的超平面实现。<br>&emsp;&emsp;由该结点生成深度为 $j+1$ 的左右子结点：左子结点对应坐标 $x^{(l)}$ 小于切分点的子区域，右子结点对应坐标 $x^{(l)}$ 大于切分点的子区域。<br>&emsp;&emsp;将落在切分超平面上的实例点保存在该结点。  </li>
</ol>
<ul>
<li>举例：<br>给定一个二维空间的数据集：$T=\{x_0 = (2,3)^T, x_1 = (5,4)^T, x_2 = (9,6)^T, x_3 = (4,7)^T, x_4 = (8,1)^T, x_5 = (7,2)^T\}$<br>构造kd树步骤如下：  <ul>
<li>选择 $x^{(1)}$ 作为切分坐标轴，将 $\{2,5,9,4,8,7\}$ 排序为 $\{2,4,5,7,8,9\}$ ，取中位数7，即将 $x_5$ 作为深度为0的根结点，并将 $\{x_0,x_1,x_3\}$ 归于左子区域(深度为1)，将 $\{x_2,x_4\}$归为右子区域(深度为1)。  </li>
<li>$l = 1(mod 2) + 1 = 2$, 以 $x^{(2)}$ 为切分坐标轴对深度为1的结点进行下一次划分。在深度为1的左子区域 $\{x_0,x_1,x_3\}$ 中，对 $\{3, 4, 7\}$ 排序并取中位数4，将 $x_1$ 作为左子区域的切分点，$x_0$ 归于  $x_1$ 下的左子区域(深度为2)，$x_3$ 归于  $x_1$ 下的右子区域(深度为2)。再继续对 $x_0$ 和 $x_1$ 所在的两个深度为2的子区域进行划分，$x_0$ 和  $x_1$  分别为两个子区域的下一个切分结点，而此时深度为3的4个子区域中都不再包含结点，因此切分结束。至此，深度为1的左子区域中所有结点已经划分完毕，下面只需要按同样的方式对深度为1的右子结点进行切分。  </li>
<li>最后构造的树形结构,用目录表示如下(第一个子目录为左结点，第二个子目录为右结点，null表示这个子树上没有结点)<ul>
<li>$x_5$<ul>
<li>$x_1$<ul>
<li>$x_0$</li>
<li>$x_3$</li>
</ul>
</li>
<li>$x_2$<ul>
<li>$x_4$</li>
<li>null</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="搜索kd树算法"><a href="#搜索kd树算法" class="headerlink" title="搜索kd树算法"></a>搜索kd树算法</h3><p>  描述如下：<br>  &emsp;&emsp;给定一个目标点，搜索其最近邻。首先找到包含目标点的叶结点；从该叶结点出发，一次退回到父结点；不断查找与目标点最邻近的结点，当确定不可能存在更近的结点时终止。这样搜索被限制在空间的局部区域，效率大为提高。<br>  &emsp;&emsp;包含目标点的叶结点对应包含目标点的最小超矩形区域。以此叶结点的实例点作为当前最近点。目标点的最近邻一定在以目标点为中心并通过当前最近点的超球体的内部。然后返回当前节点的父结点，如果父结点的另一个子结点的超矩形区域与超球体相交，那么在相交的区域内寻找与目标点更近的实例点。如果存在这样的点，将此点作为新的最近点。算法转到更上一级的父结点，继续上述过程。如果父结点的另一子结点的超矩形区域与超球体不相交，或不存在比当前最近点更近的点，则停止搜索。<br>  算法：<br>  输入： 已构造的kd树； 目标点 $x$ ;<br>  输出： $x$ 的最近邻.  </p>
<ol>
<li>在kd树中找到包含目标点 $x$ 的叶结点；从根结点出发，递归地向下访问kd树，若目标点 $x$ 当前维的坐标小于切分点的坐标，则移动到左子结点，否则移动到右子结点。直到子结点为叶子结点为止。</li>
<li>以此叶子结点为”当前最近点”</li>
<li>递归地向上回退，在每个结点进行一下操作：<ul>
<li>如果该结点保存的实例点比当前最近点距离目标点更近，则以该实例点为当前最近点。</li>
<li>当前最近点一定存在于该结点一个子结点对应的区域。检查该子结点的父结点的另一子结点对应的区域是否有更近的点。具体地，检查另一子结点对应的区域是否以目标点为球心、以目标点与“当前最近点”间的距离为半径的超球体相交。如果相交，则可能在另一子结点对应的区域内存在距离目标点更近的点，移动到另一子结点。接着，递归地进行最近邻搜索。如果不想交，向上回退。  </li>
</ul>
</li>
<li>当回退到根结点，搜索结束。最后的”当前最近点“即为 $x$ 的最近邻点。<br>&emsp;&emsp;如果实例随机分布，则kd树搜索的平均时间复杂度为 $O(\log N)$ , $N$ 为训练实例数。kd树更适用于训练实例数远大于空间维度时的k近邻搜索，当空间维数接近训练实例数时，它的效率会下降，几乎接近于线性扫描。  </li>
</ol>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><pre><code class="lang-python">    import numpy as np

    class Node:
        def __init__(self, data, lchild = None, rchild = None):
            self.data = data
            self.lchild = lchild
            self.rchild = rchild

    class KdTree:
        def __init__(self):
            self.kdTree = None

        def create(self, dataSet, depth):
            if (len(dataSet) &gt; 0):
                m, n = np.shape(dataSet)
                midIndex = int(m / 2)
                # print(midIndex)
                axis = depth % n
                sortedDataSet = self.sort(dataSet, axis, 0, m-1)
                # print(sortedDataSet)
                node = Node(sortedDataSet[midIndex])
                leftDataSet = sortedDataSet[: midIndex]
                rightDataSet = sortedDataSet[midIndex+1:]
                # print(leftDataSet)
                # print(rightDataSet)
                node.lchild = self.create(leftDataSet, depth+1)
                node.rchild = self.create(rightDataSet, depth+1)
                return node
            else:
                return None

        def quicksort(self, dataSet, axis, low, high):
            key = dataSet[low]
            while low &lt; high:
                while low &lt; high and dataSet[high][axis] &gt;= key[axis]:
                    high -= 1
                while low &lt; high and dataSet[high][axis] &lt; key[axis]:
                    dataSet[low] = dataSet[high]
                    low += 1
                    dataSet[high] = dataSet[low]
            dataSet[low] = key
            return low

        def sort(self, dataSet, axis, low, high): #采用快速排序，利用aixs作为轴进行划分
            if low &lt; high:
                key_index = self.quicksort(dataSet, axis, low, high)
                self.sort(dataSet, axis, low, key_index)
                self.sort(dataSet, axis, key_index+1, high)
            # print(sortDataSet)
            return dataSet

        def preOrder (self, node):
            if node != None:
                print(&quot;visit-&gt;%s&quot; % node.data)
                self.preOrder(node.lchild)
                self.preOrder(node.rchild)
        def search(self, tree, x):
            self.nearestPoint = None
            self.nearestValue = 0
            def travel(node, depth = 0):
                if node != None:
                    n = len(x)
                    axis = depth % n
                    if x[axis] &lt; node.data[axis]:
                        travel(node.lchild, depth+1)
                    else:
                        travel(node.rchild, depth+1)

                    distNodeAndX = self.dist(x, node.data, 2)
                    if(self.nearestPoint == None):
                        self.nearestPoint = node.data
                        self.nearestValue = distNodeAndX
                    elif (self.nearestValue &gt; distNodeAndX):
                        self.nearestPoint = node.data
                        self.nearestValue = distNodeAndX

                    print(node.data, depth, self.nearestValue, node.data[axis], x[axis])
                    if(abs(x[axis] - node.data[axis]) &lt;= self.nearestValue):
                        if x[axis] &lt; node.data[axis]:
                            travel(node.rchild, depth+1)
                        else:
                            travel(node.lchild, depth+1)
            travel(tree)
            return self.nearestPoint
        def dist(self, x1, x2, n):
            return ((np.array(x1) - np.array(x2)) ** n).sum() ** (1/n)


    dataSet = [[2, 3],
               [5, 4],
               [9, 6],
               [4, 7],
               [8, 1],
               [7, 2]]
    x = [5, 3]
    kdtree = KdTree()
    # print(kdtree.sort(dataSet, 0, 0, 5))

    tree = kdtree.create(dataSet, 0)
    kdtree.preOrder(tree)
    print(kdtree.search(tree, x))
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2018/04/08/k近邻算法中kd树的实现/" data-id="cjfv1oav2000arvzn6mbary42" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Machine-Learning/">Machine Learning</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-一致性hash算法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/19/一致性hash算法/" class="article-date">
  <time datetime="2018-03-19T13:12:00.000Z" itemprop="datePublished">2018-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/19/一致性hash算法/">一致性hash算法原理简要理解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录</strong>
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一致性hash算法"><span class="toc-number">1.</span> <span class="toc-text"><a href="#&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;" class="headerlink" title="&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;"></a>&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一致性hash算法-1"><span class="toc-number">1.0.1.</span> <span class="toc-text"><a href="#&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;-1" class="headerlink" title="&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;"></a>&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#原理"><span class="toc-number">1.0.1.0.1.</span> <span class="toc-text"><a href="#&#x539F;&#x7406;" class="headerlink" title="&#x539F;&#x7406;"></a>&#x539F;&#x7406;</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#环形Hash空间"><span class="toc-number">1.0.1.0.1.1.</span> <span class="toc-text"><a href="#&#x73AF;&#x5F62;Hash&#x7A7A;&#x95F4;" class="headerlink" title="&#x73AF;&#x5F62;Hash&#x7A7A;&#x95F4;"></a>&#x73AF;&#x5F62;Hash&#x7A7A;&#x95F4;</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#将数据通过一定的hash算法处理后映射到换上"><span class="toc-number">1.0.1.0.1.2.</span> <span class="toc-text"><a href="#&#x5C06;&#x6570;&#x636E;&#x901A;&#x8FC7;&#x4E00;&#x5B9A;&#x7684;hash&#x7B97;&#x6CD5;&#x5904;&#x7406;&#x540E;&#x6620;&#x5C04;&#x5230;&#x6362;&#x4E0A;" class="headerlink" title="&#x5C06;&#x6570;&#x636E;&#x901A;&#x8FC7;&#x4E00;&#x5B9A;&#x7684;hash&#x7B97;&#x6CD5;&#x5904;&#x7406;&#x540E;&#x6620;&#x5C04;&#x5230;&#x6362;&#x4E0A;"></a>&#x5C06;&#x6570;&#x636E;&#x901A;&#x8FC7;&#x4E00;&#x5B9A;&#x7684;hash&#x7B97;&#x6CD5;&#x5904;&#x7406;&#x540E;&#x6620;&#x5C04;&#x5230;&#x6362;&#x4E0A;</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#将机器通过hash算法映射到环上"><span class="toc-number">1.0.1.0.1.3.</span> <span class="toc-text"><a href="#&#x5C06;&#x673A;&#x5668;&#x901A;&#x8FC7;hash&#x7B97;&#x6CD5;&#x6620;&#x5C04;&#x5230;&#x73AF;&#x4E0A;" class="headerlink" title="&#x5C06;&#x673A;&#x5668;&#x901A;&#x8FC7;hash&#x7B97;&#x6CD5;&#x6620;&#x5C04;&#x5230;&#x73AF;&#x4E0A;"></a>&#x5C06;&#x673A;&#x5668;&#x901A;&#x8FC7;hash&#x7B97;&#x6CD5;&#x6620;&#x5C04;&#x5230;&#x73AF;&#x4E0A;</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#数据库结点的删除和添加"><span class="toc-number">1.0.1.0.2.</span> <span class="toc-text"><a href="#&#x6570;&#x636E;&#x5E93;&#x7ED3;&#x70B9;&#x7684;&#x5220;&#x9664;&#x548C;&#x6DFB;&#x52A0;" class="headerlink" title="&#x6570;&#x636E;&#x5E93;&#x7ED3;&#x70B9;&#x7684;&#x5220;&#x9664;&#x548C;&#x6DFB;&#x52A0;"></a>&#x6570;&#x636E;&#x5E93;&#x7ED3;&#x70B9;&#x7684;&#x5220;&#x9664;&#x548C;&#x6DFB;&#x52A0;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#平衡性—虚拟结点"><span class="toc-number">1.0.1.0.3.</span> <span class="toc-text"><a href="#&#x5E73;&#x8861;&#x6027;&#x2014;&#x865A;&#x62DF;&#x7ED3;&#x70B9;" class="headerlink" title="&#x5E73;&#x8861;&#x6027;&#x2014;&#x865A;&#x62DF;&#x7ED3;&#x70B9;"></a>&#x5E73;&#x8861;&#x6027;&#x2014;&#x865A;&#x62DF;&#x7ED3;&#x70B9;</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#原文"><span class="toc-number">1.0.1.0.3.1.</span> <span class="toc-text"><a href="#&#x539F;&#x6587;" class="headerlink" title="&#x539F;&#x6587;"></a>&#x539F;&#x6587;</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol>
        </div>
        

        <h1 id="一致性hash算法"><a href="#一致性hash算法" class="headerlink" title="一致性hash算法"></a>一致性hash算法</h1><p>一致性哈希算法能够有效地解决分布式数据的扩容问题。<br>一般的hash算法，将数据映射到具体的节点上，例如取模分片，固定分片hash算法等。但当一个节点出现故障退出集群，或者当需要添加新的数据节点进行扩容时，势必会导致原有数据映射的失效。<br>一致性hash算法解决了普通余数Hash算法伸缩性差的问题，可以保证上线、下线服务器的情况下尽量有多的请求命中原来路由到的服务器。</p>
<h3 id="一致性hash算法-1"><a href="#一致性hash算法-1" class="headerlink" title="一致性hash算法"></a>一致性hash算法</h3><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><ul>
<li><h6 id="环形Hash空间"><a href="#环形Hash空间" class="headerlink" title="环形Hash空间"></a>环形Hash空间</h6><p>使用环形空间存储hash值，将key进行hash运算之后放到2^32个桶组成的环形空间中，范围为 0~2^32-1。<br><img src="http://oqvbarc9z.bkt.clouddn.com/20160322100645490.png" alt="">  </p>
</li>
<li><h6 id="将数据通过一定的hash算法处理后映射到换上"><a href="#将数据通过一定的hash算法处理后映射到换上" class="headerlink" title="将数据通过一定的hash算法处理后映射到换上"></a>将数据通过一定的hash算法处理后映射到换上</h6><p>模拟将0bject1~4这四个对象通过hash函数计算出key值，散列到这个Hash环上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Hash(object1) = key1;  </span><br><span class="line">Hash(object2) = key2;  </span><br><span class="line">Hash(object3) = key3;  </span><br><span class="line">Hash(object4) = key4;</span><br></pre></td></tr></table></figure>
<p><img src="http://oqvbarc9z.bkt.clouddn.com/20160322100651969.png" alt="">  </p>
</li>
<li><h6 id="将机器通过hash算法映射到环上"><a href="#将机器通过hash算法映射到环上" class="headerlink" title="将机器通过hash算法映射到环上"></a>将机器通过hash算法映射到环上</h6><p>采用一致性hash算法后，若分布式集群中有新的数据结点加入，将使用对象存储一样的算法将结点也映射到环中，将结点的ip或者它唯一的别名作为输入计算hash值，并按照顺时针方向，将所有数据对象存储到离自己最近的结点中。<br>例如，假设有NODE1，NODE2，NODE3三个数据结点，通过hash算法，得到对应的key值，映射到环中。  </p>
<pre><code class="lang-java">Hash(NODE1) = KEY1;   
Hash(NODE2) = KEY2;  
Hash(NODE3) = KEY3;
</code></pre>
<p><img src="http://oqvbarc9z.bkt.clouddn.com/20160322101232331.png" alt=""><br>上述例子中，4个数据对象以及3个数据结点计算hash值之后分布在环中，而数据对象将存储在顺时针方向离自己最近的数据结点之中。object1存储在NODE1，object3存储在NODE2，object2，object4存储在NODE3中。<br>这样，在查询数据时，会根据数据对象的hash值找到最近的数据库结点，查找指定数据。  </p>
</li>
</ul>
<h5 id="数据库结点的删除和添加"><a href="#数据库结点的删除和添加" class="headerlink" title="数据库结点的删除和添加"></a>数据库结点的删除和添加</h5><p>一般的hash求余算法，在数据库结点添加或删除之后会造成大量的对象存储位置失效，而一致性hash算法则解决了这个问题。  </p>
<ul>
<li>数据库结点删除<br>以上面的三个结点为例，如果NODE2出现故障被删除，那么NODE2结点上存储的数据，应当按照原有存储规则，迁移至NODE2结点外，顺时针方向最近的结点，即为NODE3。这样，只有NODE3一个数据结点获取了迁移的数据，即删除数据节点只会影响到顺时针方向的下一个结点。<br><img src="http://oqvbarc9z.bkt.clouddn.com/20160322101236809.png" alt="">  </li>
<li>数据库结点添加<br>向集群中添加一个数据库结点NODE4，通过上面的方法计算hash值KEY4，映射到环上，按照之前的存储规则，将顺时针下一个数据库结点，满足条件的数据对象迁移到NODE4中<br><img src="http://oqvbarc9z.bkt.clouddn.com/20160322101240747.png" alt=""><br>通过数据库结点的删除添加原理的描述，我们可以大致了解到，使用一致性hash算法，在进行数据库扩容以及缩减时，只需要对顺时针的下一个数据节点进行数据迁移，这样的算法对于分布式集群来说是非常合适的，再出现故障以及需要扩容时避免的大量数据迁移，减小服务器的压力。  </li>
</ul>
<h5 id="平衡性—虚拟结点"><a href="#平衡性—虚拟结点" class="headerlink" title="平衡性—虚拟结点"></a>平衡性—虚拟结点</h5><p>从上面的图解我们可以看到，一致性hash算法满足了单调性和负载均衡地特性以及一般hash算法的分散性。下面讲一下一致性hash算法如何保证平衡性。<br>hash算法是不保证平衡的，上面只部署了NODE1和NODE3的情况，object1存储到了NODE1中，而object2、object3、object4都存储到了NODE3中，这样就造成了非常不平衡的状态。在一致性哈希算法中，为了尽可能的满足平衡性，其引入了虚拟节点。<br>虚拟结点（virtual）。一个实际数据库结点可以对应多个虚拟结点，这个对应虚拟结点的个数也成为复制个数，虚拟结点在环空间中也是以hash值排列。<br>以上面只部署了NODE1和NODE3的情况（NODE2被删除的图）为例，之前的对象在机器上的分布很不均衡，现在我们以2个副本（复制个数）为例，这样整个hash环中就存在了4个虚拟节点，最后对象映射的关系图如下：<br><img src="http://oqvbarc9z.bkt.clouddn.com/20160322101245263.png" alt=""><br>根据上图可知对象的映射关系：object1-&gt;NODE1-1，object2-&gt;NODE1-2，object3-&gt;NODE3-2，object4-&gt;NODE3-1。通过虚拟节点的引入，对象的分布就比较均衡了。那么在实际操作中，正真的对象查询是如何工作的呢？对象从hash到虚拟节点到实际节点的转换如下图：<br><img src="http://oqvbarc9z.bkt.clouddn.com/20160322101249206.png" alt=""><br>虚拟结点的哈希值计算，可以将对应结点的ip地址加上数字后缀作为输入值，计算相应的hash值。例如，NODE1的ip为192.168.0.1，那么它的hash值为Hash(“192.168.0.1”),当引入两个虚拟结点NODE1-1和NODE1-2之后，它的虚拟结点哈希值为  </p>
<pre><code class="lang-java">Hash(&quot;192.168.0.1#1&quot;);  
Hash(&quot;192.168.0.1#2&quot;);
</code></pre>
<h6 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h6><p><a href="http://blog.csdn.net/cywosp/article/details/23397179/" target="_blank" rel="noopener">《一致性哈希算法》</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2018/03/19/一致性hash算法/" data-id="cjfv1oav6000drvznb3glr0o5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式数据库/">分布式数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-航天航空与臭虫" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/21/航天航空与臭虫/" class="article-date">
  <time datetime="2017-07-21T15:41:10.000Z" itemprop="datePublished">2017-07-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/21/航天航空与臭虫/">航天航空与臭虫</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录</strong>
          <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是计算机臭虫"><span class="toc-number">2.</span> <span class="toc-text"><a href="#&#x4EC0;&#x4E48;&#x662F;&#x8BA1;&#x7B97;&#x673A;&#x81ED;&#x866B;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;&#x8BA1;&#x7B97;&#x673A;&#x81ED;&#x866B;"></a>&#x4EC0;&#x4E48;&#x662F;&#x8BA1;&#x7B97;&#x673A;&#x81ED;&#x866B;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#航天航空与臭虫的轻微碰撞"><span class="toc-number">3.</span> <span class="toc-text"><a href="#&#x822A;&#x5929;&#x822A;&#x7A7A;&#x4E0E;&#x81ED;&#x866B;&#x7684;&#x8F7B;&#x5FAE;&#x78B0;&#x649E;" class="headerlink" title="&#x822A;&#x5929;&#x822A;&#x7A7A;&#x4E0E;&#x81ED;&#x866B;&#x7684;&#x8F7B;&#x5FAE;&#x78B0;&#x649E;"></a>&#x822A;&#x5929;&#x822A;&#x7A7A;&#x4E0E;&#x81ED;&#x866B;&#x7684;&#x8F7B;&#x5FAE;&#x78B0;&#x649E;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bug引起的金星探测实验失败"><span class="toc-number">4.</span> <span class="toc-text"><a href="#Bug&#x5F15;&#x8D77;&#x7684;&#x91D1;&#x661F;&#x63A2;&#x6D4B;&#x5B9E;&#x9A8C;&#x5931;&#x8D25;" class="headerlink" title="Bug&#x5F15;&#x8D77;&#x7684;&#x91D1;&#x661F;&#x63A2;&#x6D4B;&#x5B9E;&#x9A8C;&#x5931;&#x8D25;"></a>Bug&#x5F15;&#x8D77;&#x7684;&#x91D1;&#x661F;&#x63A2;&#x6D4B;&#x5B9E;&#x9A8C;&#x5931;&#x8D25;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#细数其他由Bug导致的灾难"><span class="toc-number">5.</span> <span class="toc-text"><a href="#&#x7EC6;&#x6570;&#x5176;&#x4ED6;&#x7531;Bug&#x5BFC;&#x81F4;&#x7684;&#x707E;&#x96BE;" class="headerlink" title="&#x7EC6;&#x6570;&#x5176;&#x4ED6;&#x7531;Bug&#x5BFC;&#x81F4;&#x7684;&#x707E;&#x96BE;"></a>&#x7EC6;&#x6570;&#x5176;&#x4ED6;&#x7531;Bug&#x5BFC;&#x81F4;&#x7684;&#x707E;&#x96BE;</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#宰赫兰导弹事件，毫秒的误差"><span class="toc-number">5.0.1.</span> <span class="toc-text"><a href="#&#x5BB0;&#x8D6B;&#x5170;&#x5BFC;&#x5F39;&#x4E8B;&#x4EF6;&#xFF0C;&#x6BEB;&#x79D2;&#x7684;&#x8BEF;&#x5DEE;" class="headerlink" title="&#x5BB0;&#x8D6B;&#x5170;&#x5BFC;&#x5F39;&#x4E8B;&#x4EF6;&#xFF0C;&#x6BEB;&#x79D2;&#x7684;&#x8BEF;&#x5DEE;"></a>&#x5BB0;&#x8D6B;&#x5170;&#x5BFC;&#x5F39;&#x4E8B;&#x4EF6;&#xFF0C;&#x6BEB;&#x79D2;&#x7684;&#x8BEF;&#x5DEE;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#阿丽亚娜5型运载火箭，昂贵的简单复制"><span class="toc-number">5.0.2.</span> <span class="toc-text"><a href="#&#x963F;&#x4E3D;&#x4E9A;&#x5A1C;5&#x578B;&#x8FD0;&#x8F7D;&#x706B;&#x7BAD;&#xFF0C;&#x6602;&#x8D35;&#x7684;&#x7B80;&#x5355;&#x590D;&#x5236;" class="headerlink" title="&#x963F;&#x4E3D;&#x4E9A;&#x5A1C;5&#x578B;&#x8FD0;&#x8F7D;&#x706B;&#x7BAD;&#xFF0C;&#x6602;&#x8D35;&#x7684;&#x7B80;&#x5355;&#x590D;&#x5236;"></a>&#x963F;&#x4E3D;&#x4E9A;&#x5A1C;5&#x578B;&#x8FD0;&#x8F7D;&#x706B;&#x7BAD;&#xFF0C;&#x6602;&#x8D35;&#x7684;&#x7B80;&#x5355;&#x590D;&#x5236;</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-number">6.</span> <span class="toc-text"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</span></a></li></ol>
        </div>
        

        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>我们知道，如何彻底消灭害虫一直是困扰我国九亿农民的问题。社会底层的劳动人民深受其害而无能为力，而代表着我国最高新技术的航天航空技术科学家们，同样被这些“臭虫”折腾得夜不能寐。当然，这里所说的“臭虫”，并不是传统观念中的那些害虫。而是计算机系统中的“臭虫”— Bug。<br>计算机中的臭虫已经多次对航天航空的事业中造成重大灾难，我会对这些事故进行一个简单的介绍。与此同时，鉴于本人软件工程的专业，我会结合自己的专业知识，更进一步地介绍这些灾难的罪魁祸首。  </p>
<h3 id="什么是计算机臭虫"><a href="#什么是计算机臭虫" class="headerlink" title="什么是计算机臭虫"></a>什么是计算机臭虫</h3><p><img src="http://oqvbarc9z.bkt.clouddn.com/17072101.png" alt="软件史上第一虫"><br>这只被贴在笔记本上的飞蛾，就是史上的第一个计算机Bug，被称作万“虫”之母。<br>上个世纪40年代，美国武器系统对强大计算能力的需求催生了MARK系列计算机的出现。它凭借着其在当时堪称超高速的运算，成为了美国武器系统的强大保障。在一次MARK机实验中，Grace Murray Hopper，计算机史上最伟大的女性，发现自己的计算机出现了故障。找到出错的继电器后，她在其中发现了一只飞蛾的尸体，并发现它就是困扰多时的计算机运行故障的原因。于是她在自己的笔记本上贴上了这个Bug，并写道“First actual case of bug being found”。这只飞蛾的发现，奠定了Bug这个词在计算机世界的地位，同时，bug也成为了世界上所有程序员的噩梦。<br>从那以后，Bug这个词在计算机世界中，表示计算机程序中的错误和疏漏，它们会让计算机在运行过程中出现莫名其妙的结果，甚至会引起程序的崩溃。  </p>
<h3 id="航天航空与臭虫的轻微碰撞"><a href="#航天航空与臭虫的轻微碰撞" class="headerlink" title="航天航空与臭虫的轻微碰撞"></a>航天航空与臭虫的轻微碰撞</h3><p>1961年夏天，一名NASA的程序员戏剧性地向世人展示了编程语言的细节导致的一个小错误。<br>他测试一个用于计算环绕地球轨道的Fortran（世界上最早出现的计算机高级程序设计语言，广泛应用于科学和工程计算领域）子程序。这个子程序已经很多次用在了计算简短的Mercury（NASA登月计划3个阶段中的第一个阶段，另外两个是Gemini和Apollo）飞行中，尽管它的计算结果很接近，但总是无法达到预期的精度，而无法应用于航天器的更外层太空飞行和登月计划。<br><img src="http://oqvbarc9z.bkt.clouddn.com/17072102.jpg" alt="打孔时代的卡片"><br>在对算法，数据，预期结果进行长时间的检查之后，这位工程师将错误锁定在了下面这段代码之中：<br><code>Do 10 I = 1.10</code>———-代码（1）<br>其实，最初程序员是想编写下面这个循环语句：<br><code>Do 10 I = 1,10</code>———-代码（2）<br>两者的差别只是一个小数点和一个逗号，但在结果上却出现了差异。（2）式中，程序员的本意，是给变量“I”赋值为1，并通过Do语句，来对这个赋值过程循环10次。程序员为了避免打卡机（当时的计算机还是打卡机）振动产生误差，提高程序的可靠性，通过10次的迭代来逐步求精，得到最终的精确结果。但是由于程序员的粗心，把逗号写成了小数点，而变成了上边的(1)式。由于Fortran语言中，空白字符没有意义并且甚至可以在标识符内部出现空格，这一特征导致程序在编译过程中没有报错而是错误地理解了程序员的意图。于是(1)式的含义变成了给变量“Do1oI”赋值为1.10，而没有了循环10次迭代求精的过程，于是得到的结果也不再精确。<br>这个Bug发现的早，因此并没有导致灾难性的后果。然而，在Mariner飞行项目中，另一个Bug的存在却造成了极其昂贵的火箭以及探测器的损失。  </p>
<h3 id="Bug引起的金星探测实验失败"><a href="#Bug引起的金星探测实验失败" class="headerlink" title="Bug引起的金星探测实验失败"></a>Bug引起的金星探测实验失败</h3><p>1962年7月，Mariner 1发射，任务是将一个探测器放到金星上。但是在发射几分钟后，由于发射它的Atlas火箭开始偏离轨道，地面的控制中心不得不将它摧毁。<br>经过数周的检查和分析，专家发现出现这个问题的原因在于，算法上的一个语句被错误地抄写了。换句话说，程序严格地按照程序员的设想执行，但是提供给程序员的说明书本身就存在错误。在数学中，在变量符号前加上水平的“▔”来表示平均，即读作bar，但是提供给程序员的手写制导方程式中却遗漏了这个bar的符号。<br>因此，那个程序员按照要求正确编写了程序，并使用了从雷达指引的原始速度，而不是平均速度参与计算。在火箭发射过程中，程序发现了火箭速度的微小波动，并在经典的负反馈循环中尝试调节火箭的速度。但在调节过程中调用了上面这个自己调节速度的程序，出现了真正的不稳定行为。虽然这个有缺陷的调节速度程序已经用于以前的几个任务中，但是因为以前的实验都没有火箭速度波动的问题，因此这个子程序从未被调用过。实际上，即使出现速度波动的问题，地面控制台也会通过人为的方式修改火箭的速度。巧合的是，这次发射过程中，火箭上的天线也出现了故障，导致其无法接收到无线电指定，而无法同过地面来控制，对火箭的速度进行调节。最终火箭调用了速度调整程序，也就是上面所说的有缺陷的程序，最终造成了巨额的损失。  </p>
<h3 id="细数其他由Bug导致的灾难"><a href="#细数其他由Bug导致的灾难" class="headerlink" title="细数其他由Bug导致的灾难"></a>细数其他由Bug导致的灾难</h3><h5 id="宰赫兰导弹事件，毫秒的误差"><a href="#宰赫兰导弹事件，毫秒的误差" class="headerlink" title="宰赫兰导弹事件，毫秒的误差"></a>宰赫兰导弹事件，毫秒的误差</h5><p>1991年2月的第一次海湾战争中，一枚伊拉克发射的飞毛腿导弹准确击中了美国在沙特阿拉伯的宰赫兰基地，造成28名美国士兵死亡和100多人受伤。在后来的调查中发现，是一个简单的计算机bug，造成了基地的爱国者反导弹系统的失效，使其未能成功拦截飞毛腿导弹。<br>爱国者反导弹系统的时钟寄存器设计为24位，因此时间的精度也只限于24位。我们知道计算机是通过二进制来储存数据的，但是十进制的小数无法被绝对精确地转换成二进制，都会有一个误差。那么这个24位的精度到底有多大呢？<br>计算机中浮点数类型（float）可以保留十进制最多7位（二进制23位）有效数字。用浮点数举上面0.9的例子，储存一个float类型的变量，赋值为0.9，那么它的二进制值为0.11100110011001100110011，但这个二进制的实际十进制数值应该是0.89999998，这就造成了0.00000002的误差，即为10的-8次方。<br>这个数字在我们看来是完全可以忽略不计的。然而在当时，这个反导弹系统已经连续运行了100个小时，即为360000秒，数量级在10的5次方，最终累积的误差达到了0.33秒（因为没有具体变量值，我无法列出计算公式），这对于时速达到1.5km/s的侯赛因导弹来说，就是600m的误差。由于这600秒的误差，尽管爱国者反导弹系统发现了它，但却无法准确的跟踪，最终导致了这场悲剧。 </p>
<h5 id="阿丽亚娜5型运载火箭，昂贵的简单复制"><a href="#阿丽亚娜5型运载火箭，昂贵的简单复制" class="headerlink" title="阿丽亚娜5型运载火箭，昂贵的简单复制"></a>阿丽亚娜5型运载火箭，昂贵的简单复制</h5><p>1996年6月4日，阿丽亚娜5型运载火箭首次发射点火后，火箭开始偏离路线并最终逼迫引爆自毁，短短30秒的发射宣告失败。同样，这也是发射系统中的bug引发的事故。<br><img src="http://oqvbarc9z.bkt.clouddn.com/17072103.jpg" alt="花费4亿美金的阿丽亚娜5型烟花"><br>阿丽亚娜5型运载火箭是基于4型火箭开发的。在4型火箭系统中，对水平速率的测量值储存在16位的变量中。通过反复的验证，当时这个变量的值不会超过16位。但在5型火箭的开发过程中，开发人员并没有对其进行检查而直接复用了这段代码。在发射后，这个64位带小数点的变量被转化为16位不带小数点的变量，而造成数值的溢出。计算机中二进制变量的第一位储存的是这个值的正负，由于前者的具体数值超过了这个16位的变量能够储存的最大值，导致第二位向第一位进位，从0变成1，整体变量的符号也从正变为了负数（也就是我们说的发生了溢出），从而引发了后面的一系列错误。最终影响了火箭上所有的计算机和硬件，使系统瘫痪，火箭自毁。  </p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>航天航空科学技术这一高科技行业，对数据精确度有着极其苛刻的要求，决不能有丝毫的偏差。而应用其中的计算机技术，在进行数值计算以及逻辑控制时同样有着严苛的精确性需求。然而，在计算机中，系统程序往往会因为人为的细小的差错，系统不惹人注意的漏洞，或者因为外部看似毫无关联的变动而出错，最终酿成无法挽回的后果。这些错误看似不可避免，而我们则只能通过严密的实验，充足的测试来降低错误的风险。宁可在测试中投入大量成本，也不要在失败后再寻找错误出在哪！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2017/07/21/航天航空与臭虫/" data-id="cjfv1oav7000frvznztcu46sv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/其他/">其他</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-JavaWeb会话与状态管理-Session机制学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/18/JavaWeb会话与状态管理-Session机制学习/" class="article-date">
  <time datetime="2017-06-17T17:10:48.000Z" itemprop="datePublished">2017-06-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/18/JavaWeb会话与状态管理-Session机制学习/">JavaWeb会话与状态管理--Session机制学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录</strong>
          <ol class="toc"><li class="toc-item toc-level-6"><a class="toc-link" href="#摘要"><span class="toc-number">1.</span> <span class="toc-text"><a href="#&#x6458;&#x8981;" class="headerlink" title="&#x6458;&#x8981;"></a>&#x6458;&#x8981;</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Session机制"><span class="toc-number"></span> <span class="toc-text"><a href="#Session&#x673A;&#x5236;" class="headerlink" title="Session&#x673A;&#x5236;"></a>Session&#x673A;&#x5236;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Session-cookies"><span class="toc-number"></span> <span class="toc-text"><a href="#Session-cookies" class="headerlink" title="Session cookies"></a>Session cookies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Session的生命周期"><span class="toc-number"></span> <span class="toc-text"><a href="#Session&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;" class="headerlink" title="Session&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;"></a>Session&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#服务端新建HttpSession对象"><span class="toc-number"></span> <span class="toc-text"><a href="#&#x670D;&#x52A1;&#x7AEF;&#x65B0;&#x5EFA;HttpSession&#x5BF9;&#x8C61;" class="headerlink" title="&#x670D;&#x52A1;&#x7AEF;&#x65B0;&#x5EFA;HttpSession&#x5BF9;&#x8C61;"></a>&#x670D;&#x52A1;&#x7AEF;&#x65B0;&#x5EFA;HttpSession&#x5BF9;&#x8C61;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session的创建"><span class="toc-number"></span> <span class="toc-text"><a href="#Session&#x7684;&#x521B;&#x5EFA;" class="headerlink" title="Session&#x7684;&#x521B;&#x5EFA;"></a>Session&#x7684;&#x521B;&#x5EFA;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session-销毁"><span class="toc-number"></span> <span class="toc-text"><a href="#Session-&#x9500;&#x6BC1;" class="headerlink" title="Session &#x9500;&#x6BC1;"></a>Session &#x9500;&#x6BC1;</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Session的常用方法"><span class="toc-number"></span> <span class="toc-text"><a href="#Session&#x7684;&#x5E38;&#x7528;&#x65B9;&#x6CD5;" class="headerlink" title="Session&#x7684;&#x5E38;&#x7528;&#x65B9;&#x6CD5;"></a>Session&#x7684;&#x5E38;&#x7528;&#x65B9;&#x6CD5;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Session类在Java后台中的使用"><span class="toc-number"></span> <span class="toc-text"><a href="#Session&#x7C7B;&#x5728;Java&#x540E;&#x53F0;&#x4E2D;&#x7684;&#x4F7F;&#x7528;" class="headerlink" title="Session&#x7C7B;&#x5728;Java&#x540E;&#x53F0;&#x4E2D;&#x7684;&#x4F7F;&#x7528;"></a>Session&#x7C7B;&#x5728;Java&#x540E;&#x53F0;&#x4E2D;&#x7684;&#x4F7F;&#x7528;</span></a>
        </div>
        

        <h6 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h6><p>上一次面试Java后台的时候被问网页登录后如何保持会话，我回答是每次请求都验证一次登录信息，而在如何验证这个问题上陷入尴尬。现在意识到自己在做web项目的时候，完全没有Session这个概念，所以现在把Java Web的Session机制进行整理。   <a href="http://blog.csdn.net/yuchao2015/article/details/55806504" target="_blank" rel="noopener">前端</a>  <a href="http://blog.csdn.net/qq_26624661/article/details/52094721" target="_blank" rel="noopener">后台</a><br>实际的Spring MVC的框架中，直接使用Spring security会比较好一点。  </p>
<h2 id="Session机制"><a href="#Session机制" class="headerlink" title="Session机制"></a>Session机制</h2><ul>
<li>session机制采用的是在服务器端保存HTTP状态信息的方案  </li>
<li>当程序需要为某个客户端请求创建一个session时，服务器首先检查<em>客户端请求</em>里是否包含session标识 (sessionId)，如果已经包含一个sessionId，则说明此客户已经创建了一个session，服务器就按照sessionId 把这个session检索出来，如果不包含这个sessionId，就会新建一个（这种情况一般是由于服务端已经删除了这个session对象，而用户发送请求的时候加上了J SESSION这个参数）。如果客户端的请求不包含sessionId，则会为客户新建一个session并生成一个与之相关的sessionId。  </li>
</ul>
<p>使用Chrome的开发者模式可以查看发送的sessionId<br><img src="https://user-images.githubusercontent.com/12489453/27218197-b6502304-52af-11e7-8700-089c12d09d8d.png" alt="image"><br>其中的请求头Request Headers中的cookie属性，包含了JSESSION的值<br><img src="https://user-images.githubusercontent.com/12489453/27218244-fb6cd25c-52af-11e7-808e-b4ae6068c4dd.png" alt="image"><br>客户端和服务器端就是通过这个JSESSION的值判断当前用户  </p>
<h2 id="Session-cookies"><a href="#Session-cookies" class="headerlink" title="Session cookies"></a>Session cookies</h2><ul>
<li>session通过sessionId区分不同的用户，session是以cookie或url为基础的。<strong><em>默认使用cookie实现，系统会创建一个名为JSESSIONID的输出cookie，这称之为session cookie，以区别persistent cookie（我们通常说的cookie），session cookie存储在浏览器内存中</em></strong>。当浏览器设置为禁用cookie时，web服务器会采用URL重写的方式传递sessionId，可以在地址栏看到。</li>
<li>session cookie针对一次会话而言，会话结束，session cookie随之销毁。而persistent cookie只是存在客户端硬盘上的一段文本。</li>
<li>浏览器关闭，浏览区内存中的session cookie消失，服务器中的session对象不会受影响。保存在硬盘上的persistent cookie也不会受影响。</li>
</ul>
<h2 id="Session的生命周期"><a href="#Session的生命周期" class="headerlink" title="Session的生命周期"></a>Session的生命周期</h2><h4 id="服务端新建HttpSession对象"><a href="#服务端新建HttpSession对象" class="headerlink" title="服务端新建HttpSession对象"></a>服务端新建HttpSession对象</h4><ul>
<li>浏览器访问服务端任何一个JSP或Servlet，服务器端一般会创建HttpSession对象    </li>
<li>当前 JSP 或 Servlet 是客户端访问WEB的第一个资源时，且JSP中设置 <code>session=false</code> ，即JSP页面禁用隐含变量，则不会为JSP创建HttpSession对象，此时可以显示地创建 HttpSession 对象  </li>
<li>当前 JSP 或 Servlet 不是客户端访问WEB的第一个资源时，且其他页面已经创建了HttpSession对象时，不会创建HttpSession对象</li>
</ul>
<h4 id="Session的创建"><a href="#Session的创建" class="headerlink" title="Session的创建"></a>Session的创建</h4><ol>
<li>默认情况下，第一次访问web应用的JSP页面时，页面必须有一个和这个相关的Session对象。前提是JSP中的session属性为 true</li>
<li>JSP 中 session 属性为 false 的情况下，以及在 Servlet 下，可以通过 <code>request.getSession(flag);</code> 获取session对象。  <ul>
<li>若 flag 为 true ，则返回一个HttpSession对象，如果已经有和当前JSP页面关联的HttpSession，直接返回；如果没有，则创建一个返回。</li>
<li>若flag 为 false，若有关联的对象则返回，如果没有，则返回null</li>
</ul>
</li>
</ol>
<h4 id="Session-销毁"><a href="#Session-销毁" class="headerlink" title="Session 销毁"></a>Session 销毁</h4><ol>
<li>调用  HttpSession 的 <code>invalidate()</code> 方法  </li>
<li><p>HttpSession 超过过期时间自动销毁<br> session对象的几个方法</p>
<ul>
<li>返回最大时效： getMaxInactiveInterval() 单位是秒</li>
<li>设置最大时效： setMaxInactiveInterval(int interval)</li>
<li>Tomcat中 conf/web.xml 配置session的生命周期<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;session-config&gt;</span><br><span class="line">        &lt;session-timeout&gt;30&lt;/session-timeout&gt;</span><br><span class="line">&lt;/session-config&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>卸载WEB应用<br> 关闭浏览器并不能销毁session对象</p>
</li>
</ol>
<h2 id="Session的常用方法"><a href="#Session的常用方法" class="headerlink" title="Session的常用方法"></a>Session的常用方法</h2><p>主要是在 Java 里操作session的几个方法  </p>
<ul>
<li><strong>public void setAttribute</strong>（Sting name, Object value）以键值对的形式添加到Session对象中的属性，如果name已经存在则更新它。可以理解为Session中属性名字和值以键值对的形式存储在Session对象下的Map数据结构下。  </li>
<li><strong>public Object getAttribute(String name)</strong> 以属性的名字取属性值，不存在是返回 null</li>
<li><strong>public void removeAttribute(String name)</strong> 删除属性，如果属性不存在会出现异常  </li>
<li><strong>public void invalidate（）</strong> 使Session对象立即失效，原来对象中储存的Session对象将无法访问</li>
<li><strong>public String getId( )</strong> 获取当前会话的id，一般储存在cookie中</li>
<li><strong>public void setMaxInactiveInterval(int interval)</strong> 设置会话的最大持续时间，单位为秒，为负数的话Session不会失效  </li>
<li><strong>public long getCreationTime()</strong> 获取创建会话时间，单位是毫秒</li>
<li><strong>public long getLastAccessedTime()</strong> 获取会话最后访问时间，单位是毫秒<br>上面两个时间返回的类型是long的毫秒数，因此可以通过 <code>Date creationTime = new Date(session.getCreationTime());</code> 来获得Date类型的对象</li>
</ul>
<p>下面放了jsp 前端的例子，后面的记录中会把后台的处理代码放出来<br>login.jsp<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span>  </span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;  </span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;  </span><br><span class="line">&lt;html&gt;  </span><br><span class="line">&lt;head&gt;  </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;  </span><br><span class="line">&lt;title&gt;Insert title here&lt;<span class="regexp">/title&gt;  </span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;  </span><br><span class="line">&lt;body&gt;  </span><br><span class="line">  </span><br><span class="line">    SessionID: &lt;%= session.getId() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    IsNew: &lt;%= session.isNew() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    MaxInactiveInterval: &lt;%= session.getMaxInactiveInterval() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    CreateTime: &lt;%= session.getCreationTime() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">  </span><br><span class="line">    LastAccessTime: &lt;%= session.getLastAccessedTime() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    &lt;%   </span><br><span class="line">        Object username = session.getAttribute("username");  </span><br><span class="line">        if(username == null)&#123;  </span><br><span class="line">            username = "";  </span><br><span class="line">        &#125;  </span><br><span class="line">    %&gt;  </span><br><span class="line">      </span><br><span class="line">    &lt;form action="hello.jsp" method="post"&gt;  </span><br><span class="line">        username: &lt;input type="text" name="username"   </span><br><span class="line">            value="&lt;%= username %&gt;"/&gt;  </span><br><span class="line">        &lt;input type="submit" value="Submit"/&gt;  </span><br><span class="line">    &lt;/form&gt;  </span><br><span class="line">      </span><br><span class="line">&lt;/body&gt;  </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>hello.jsp  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;  </span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;  </span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;  </span><br><span class="line">&lt;html&gt;  </span><br><span class="line">&lt;head&gt;  </span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;  </span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;  </span><br><span class="line">&lt;/head&gt;  </span><br><span class="line">&lt;body&gt;  </span><br><span class="line">  </span><br><span class="line">    SessionID: &lt;%= session.getId() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    IsNew: &lt;%= session.isNew() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    MaxInactiveInterval: &lt;%= session.getMaxInactiveInterval() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    CreateTime: &lt;%= session.getCreationTime() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">  </span><br><span class="line">    LastAccessTime: &lt;%= session.getLastAccessedTime() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    Hello: &lt;%= request.getParameter(&quot;username&quot;) %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    &lt;%   </span><br><span class="line">        session.setAttribute(&quot;username&quot;, request.getParameter(&quot;username&quot;));   </span><br><span class="line">    %&gt;  </span><br><span class="line">      </span><br><span class="line">    &lt;a href=&quot;login.jsp&quot;&gt;重新登录&lt;/a&gt;      </span><br><span class="line">          </span><br><span class="line">    &lt;a href=&quot;logout.jsp&quot;&gt;注销&lt;/a&gt;   </span><br><span class="line">      </span><br><span class="line">&lt;/body&gt;  </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>logout.jsp  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;  </span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;  </span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;  </span><br><span class="line">&lt;html&gt;  </span><br><span class="line">&lt;head&gt;  </span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;  </span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;  </span><br><span class="line">&lt;/head&gt;  </span><br><span class="line">&lt;body&gt;  </span><br><span class="line">      </span><br><span class="line">    SessionID: &lt;%= session.getId() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    IsNew: &lt;%= session.isNew() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    MaxInactiveInterval: &lt;%= session.getMaxInactiveInterval() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    CreateTime: &lt;%= session.getCreationTime() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">  </span><br><span class="line">    LastAccessTime: &lt;%= session.getLastAccessedTime() %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    Bye: &lt;%= session.getAttribute(&quot;username&quot;) %&gt;  </span><br><span class="line">    &lt;br&gt;&lt;br&gt;  </span><br><span class="line">      </span><br><span class="line">    &lt;a href=&quot;login.jsp&quot;&gt;重新登录&lt;/a&gt;      </span><br><span class="line">      </span><br><span class="line">    &lt;%   </span><br><span class="line">        //使session失效  </span><br><span class="line">        session.invalidate();  </span><br><span class="line">    %&gt;  </span><br><span class="line">      </span><br><span class="line">&lt;/body&gt;  </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Session类在Java后台中的使用"><a href="#Session类在Java后台中的使用" class="headerlink" title="Session类在Java后台中的使用"></a>Session类在Java后台中的使用</h2><p>首先后台实现登录功能，要创建用户的实体类 User.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ublic class User &#123;  </span><br><span class="line">    private String uname;  </span><br><span class="line">    private String pwd;  </span><br><span class="line">      </span><br><span class="line">    public String getUname() &#123;  </span><br><span class="line">        return uname;  </span><br><span class="line">    &#125;  </span><br><span class="line">    public void setUname(String uname) &#123;  </span><br><span class="line">        this.uname = uname;  </span><br><span class="line">    &#125;  </span><br><span class="line">    public String getPwd() &#123;  </span><br><span class="line">        return pwd;  </span><br><span class="line">    &#125;  </span><br><span class="line">    public void setPwd(String pwd) &#123;  </span><br><span class="line">        this.pwd = pwd;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    public String toString() &#123;  </span><br><span class="line">        return &quot;User [uname=&quot; + uname + &quot;, pwd=&quot; + pwd + &quot;]&quot;;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">```  </span><br><span class="line">用户类中只定义了用户名 uname 以及密码 pwd 这两个字符串类型，并添加了getter和setter方法。  </span><br><span class="line"></span><br><span class="line">控制器 Controller 方法  </span><br><span class="line">LoginController.java</span><br></pre></td></tr></table></figure>
<p>public class LoginController {  </p>
<pre><code>@RequestMapping(&quot;/login&quot;)  
public String login(User user,ModelMap map) {  
    //user会自己注入session中  
    //将uname放入session作用域中，这样转发页面也可以取到这个数据。  
    map.addAttribute(&quot;uname&quot;, user.getUname());  
    return &quot;loginSuccess&quot;;  
}  
</code></pre><p>}<br>```  </p>
<p>其中的 ModelMap 对象，主要用于传递控制方法处理数据到结果页面。简单地说，就是通过ModelMap这个数据结构，手动将你想要传递的后台数据传输到前端。<br>ModelMap的用法，从上面提到的 addAttribute() 方法可以猜到，又是一个Map的结构。<br>user是自己注入到Session中，其实user对象自带了uname的属性，不过我们可以通过ModelMap手动添加属性。<br>前端 jsp 可以通过调用 <code>sessionScope.user.uname</code> 或者 <code>sessionScope.uname</code>，获取uname这个属性的值，即user.getUname()的值。  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2017/06/18/JavaWeb会话与状态管理-Session机制学习/" data-id="cjfv1oauv0005rvznp90aus1w" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-Web/">Java Web</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-centos-mysql-tomcat环境下Web项目配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/12/centos-mysql-tomcat环境下Web项目配置/" class="article-date">
  <time datetime="2017-06-12T10:52:11.000Z" itemprop="datePublished">2017-06-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/12/centos-mysql-tomcat环境下Web项目配置/">centos+mysql+tomcat环境下Web项目配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录</strong>
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL"><span class="toc-number">1.</span> <span class="toc-text"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#重置密码"><span class="toc-number">1.0.1.</span> <span class="toc-text"><a href="#&#x91CD;&#x7F6E;&#x5BC6;&#x7801;" class="headerlink" title="&#x91CD;&#x7F6E;&#x5BC6;&#x7801;"></a>&#x91CD;&#x7F6E;&#x5BC6;&#x7801;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#远程连接"><span class="toc-number">1.0.2.</span> <span class="toc-text"><a href="#&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;" class="headerlink" title="&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;"></a>&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据转移"><span class="toc-number">1.0.3.</span> <span class="toc-text"><a href="#&#x6570;&#x636E;&#x8F6C;&#x79FB;" class="headerlink" title="&#x6570;&#x636E;&#x8F6C;&#x79FB;"></a>&#x6570;&#x636E;&#x8F6C;&#x79FB;</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcat"><span class="toc-number">2.</span> <span class="toc-text"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#环境检查"><span class="toc-number">2.0.1.</span> <span class="toc-text"><a href="#&#x73AF;&#x5883;&#x68C0;&#x67E5;" class="headerlink" title="&#x73AF;&#x5883;&#x68C0;&#x67E5;"></a>&#x73AF;&#x5883;&#x68C0;&#x67E5;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FTP配置"><span class="toc-number">2.0.2.</span> <span class="toc-text"><a href="#FTP&#x914D;&#x7F6E;" class="headerlink" title="FTP&#x914D;&#x7F6E;"></a>FTP&#x914D;&#x7F6E;</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#下面是配置的选项及说明"><span class="toc-number">2.0.2.1.</span> <span class="toc-text"><a href="#&#x4E0B;&#x9762;&#x662F;&#x914D;&#x7F6E;&#x7684;&#x9009;&#x9879;&#x53CA;&#x8BF4;&#x660E;" class="headerlink" title="&#x4E0B;&#x9762;&#x662F;&#x914D;&#x7F6E;&#x7684;&#x9009;&#x9879;&#x53CA;&#x8BF4;&#x660E;"></a>&#x4E0B;&#x9762;&#x662F;&#x914D;&#x7F6E;&#x7684;&#x9009;&#x9879;&#x53CA;&#x8BF4;&#x660E;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#匿名登录设置"><span class="toc-number">2.0.2.2.</span> <span class="toc-text"><a href="#&#x533F;&#x540D;&#x767B;&#x5F55;&#x8BBE;&#x7F6E;" class="headerlink" title="&#x533F;&#x540D;&#x767B;&#x5F55;&#x8BBE;&#x7F6E;"></a>&#x533F;&#x540D;&#x767B;&#x5F55;&#x8BBE;&#x7F6E;</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#如果允许匿名登录"><span class="toc-number">2.0.2.2.1.</span> <span class="toc-text"><a href="#&#x5982;&#x679C;&#x5141;&#x8BB8;&#x533F;&#x540D;&#x767B;&#x5F55;" class="headerlink" title="&#x5982;&#x679C;&#x5141;&#x8BB8;&#x533F;&#x540D;&#x767B;&#x5F55;"></a>&#x5982;&#x679C;&#x5141;&#x8BB8;&#x533F;&#x540D;&#x767B;&#x5F55;</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#用户限制设置"><span class="toc-number">2.0.2.3.</span> <span class="toc-text"><a href="#&#x7528;&#x6237;&#x9650;&#x5236;&#x8BBE;&#x7F6E;" class="headerlink" title="&#x7528;&#x6237;&#x9650;&#x5236;&#x8BBE;&#x7F6E;"></a>&#x7528;&#x6237;&#x9650;&#x5236;&#x8BBE;&#x7F6E;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#限制目录"><span class="toc-number">2.0.2.4.</span> <span class="toc-text"><a href="#&#x9650;&#x5236;&#x76EE;&#x5F55;" class="headerlink" title="&#x9650;&#x5236;&#x76EE;&#x5F55;"></a>&#x9650;&#x5236;&#x76EE;&#x5F55;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#日志设置"><span class="toc-number">2.0.2.5.</span> <span class="toc-text"><a href="#&#x65E5;&#x5FD7;&#x8BBE;&#x7F6E;" class="headerlink" title="&#x65E5;&#x5FD7;&#x8BBE;&#x7F6E;"></a>&#x65E5;&#x5FD7;&#x8BBE;&#x7F6E;</span></a></li></ol></li></ol></li></ol></li></ol>
        </div>
        

        <p>由于我们的web项目服务器即将到期，项目组为了配合数据分析方面的python环境，准备将云服务器从以前的Windows系统换成Linux系统，我在腾讯云的CentOS6.4+Mysql+Tomcat的服务器上尝试做了一下环境的迁移。</p>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h4 id="重置密码"><a href="#重置密码" class="headerlink" title="重置密码"></a>重置密码</h4><p>选择了这个自带Mysql和Tomcat的镜像之后，开始对环境进行配置。首先从MySQL数据库开始。<br><code># service mysqld start</code>启动数据库正常。尝试登陆数据库，由于某种未知的原因，无法使用系统默认的root账号加空的默认密码进行登陆。于是尝试修改默认密码。<br>现在服务器上找到my.cnf文件，并对其进行编辑。博主的文件在 <code>/etc/my.cnf</code> 。<br>使用vim编辑该配置文件，<code># vi /etc/my.cnf</code> ，并在<code>[mysql]</code> 下面加上 <code>skip-grant-tables</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># For advice on how to change settings please see</span><br><span class="line"># http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">skip-grant-tables</span><br><span class="line">character-set-server=utf8</span><br><span class="line">default-storage-engine=MYISAM</span><br><span class="line">default-tmp-storage-engine=MYISAM</span><br><span class="line">table_open_cache=256</span><br><span class="line">performance_schema_max_table_instances=400</span><br><span class="line">table_definition_cache=400</span><br><span class="line">skip-name-resolve</span><br></pre></td></tr></table></figure></p>
<p>下面可以直接登陆mysql了，<code># mysql -uroot -p</code> ，密码直接回车即可，进入mysql环境。  </p>
<p>接着输入如下的指令，将默认的root密码修改为123<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mysql -uroot -p</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql; </span><br><span class="line">mysql&gt; update user set password=password(&apos;123&apos;) where user=&apos;root&apos;; </span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure></p>
<p>退出mysql，并将上面<code>my.cnf</code>中的<code>skip-grant-tables</code>删除，并重启mysql <code>service mysqld restart</code>，尝试使用root和123的账号密码登陆。</p>
<h4 id="远程连接"><a href="#远程连接" class="headerlink" title="远程连接"></a>远程连接</h4><ul>
<li><code>mysql&gt; grant all privileges on *.* to &#39;root&#39;@&#39;%&#39; identified by &#39;123&#39; with grant option;</code>    </li>
<li><code>mysql&gt; flush privileges;  #重载系统权限</code>  </li>
<li><code>exit; #退出</code> </li>
</ul>
<p>将所有权限赋予了root用户，，并允许通过密码123在任意主机下连接数据库。<br>可以尝试在windows下使用Navicat连接该数据库，如果不成功，可能是没有在服务器上打开3306端口<br><code>iptables -I INPUT -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT</code>  </p>
<p>为了保证服务器的安全，并给与他人权限操作数据库，我们可以添加其他MySQL用户来作为远程连接的账号密码，并给与其部分权限防止造成不可挽回的后果，只需要将上面的grant指令中的all privileges改为你要赋予的指令，并自定义账号密码就行了。  </p>
<h4 id="数据转移"><a href="#数据转移" class="headerlink" title="数据转移"></a>数据转移</h4><p>使用 Navicat for MySQL 的图形化界面对数据库操作，直接进行数据的转移。  </p>
<ul>
<li>以防万一，首先对现在的数据库进行备份  </li>
<li>右击要迁移的的数据库，点击数据传输，将数据库数据存在sql文件中  </li>
<li>在目标数据库中执行sql文件，这样数据库就迁移过来了</li>
<li>好像没有视图结构的直接转移，还好创建视图的时候进行了保存，直接在数据库中执行sql文件即可  </li>
</ul>
<p>那这样数据库就已经搭好了</p>
<h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><h4 id="环境检查"><a href="#环境检查" class="headerlink" title="环境检查"></a>环境检查</h4><p>先检查java的版本，<code># java -version</code>，没有问题直接找Tomcat安装路径。</p>
<h4 id="FTP配置"><a href="#FTP配置" class="headerlink" title="FTP配置"></a>FTP配置</h4><p>要把项目部署到linux服务器上，需要在linux上配置ftp服务器，通过ftp来上传文件。</p>
<p>首先要在服务器上安装vsftpd服务，并修改配置文件 <code>/etc/vsftpd/vsftpd.conf</code>,具体修改内容如下  </p>
<h5 id="下面是配置的选项及说明"><a href="#下面是配置的选项及说明" class="headerlink" title="下面是配置的选项及说明"></a>下面是配置的选项及说明</h5><ul>
<li><p>允许本地用户登录<br><code>local_enable=YES</code></p>
</li>
<li><p>本地用户的写权限<br><code>write_enable=YES</code></p>
</li>
<li><p>使用FTP的本地文件权限,默认为077<br>一般设置为022<br><code>local_umask=022</code></p>
</li>
<li><p>切换目录时<br>是否显示目录下<code>.message</code>的内容<br><code>dirmessage_enable=YES</code><br><code>dirlist_enable = NO</code></p>
</li>
<li><p>验证方式<br><code>pam_service_name=vsftpd</code></p>
</li>
<li><p>启用FTP数据端口的数据连接<br><code>connect_from_port_20=YES</code></p>
</li>
<li><p>以独立的FTP服务运行<br><code>listen=yes</code></p>
</li>
<li><p>修改连接端口<br><code>listen_port=2121</code></p>
</li>
</ul>
<h5 id="匿名登录设置"><a href="#匿名登录设置" class="headerlink" title="匿名登录设置"></a>匿名登录设置</h5><ul>
<li>允许匿名登录<br><code>anonymous_enable=NO</code></li>
</ul>
<h6 id="如果允许匿名登录"><a href="#如果允许匿名登录" class="headerlink" title="如果允许匿名登录"></a>如果允许匿名登录</h6><ul>
<li><p>是否开启匿名上传权限<br> <code>anon_upload_enable=YES</code></p>
</li>
<li><p>是否允许匿名建立文件夹并在文件夹内上传文件<br> <code>anon_mkdir_write_enable=YES</code></p>
</li>
<li><p>匿名帐号可以有删除的权限<br> <code>anon_other_write_enable=yes</code></p>
</li>
<li><p>匿名的下载权限<br>匿名为Other,可设置目录/文件属性控制<br><code>anon_world_readable_only=no</code></p>
</li>
<li><p>限制匿名用户传输速率,单位bite<br><code>anon_max_rate=30000</code></p>
<h5 id="用户限制设置"><a href="#用户限制设置" class="headerlink" title="用户限制设置"></a>用户限制设置</h5><ul>
<li><p>用userlist来限制用户访问<br><code>userlist_enable=yes</code></p>
</li>
<li><p>名单中的人不允许访问<br><code>userlist_deny=no</code></p>
</li>
<li><p>限制名单文件放置的路径<br><code>userlist_file=/etc/vsftpd/userlist_deny.chroot</code></p>
</li>
</ul>
<h5 id="限制目录"><a href="#限制目录" class="headerlink" title="限制目录"></a>限制目录</h5><ul>
<li><p>限制所有用户都在家目录<br><code>chroot_local_user=yes</code></p>
</li>
<li><p>调用限制在家目录的用户名单<br><code>chroot_list_enable=YES</code></p>
</li>
<li><p>限制在家目录的用户名单所在路径<br><code>chroot_list_file=/etc/vsftpd/chroot_list</code></p>
</li>
</ul>
<h5 id="日志设置"><a href="#日志设置" class="headerlink" title="日志设置"></a>日志设置</h5><ul>
<li><p>日志文件路径设置<br><code>xferlog_file=/var/log/vsftpd.log</code></p>
</li>
<li><p>激活上传/下载的日志<br><code>xferlog_enable=YES</code></p>
</li>
<li><p>使用标准的日志格式<br><code>xferlog_std_format=YES</code></p>
</li>
</ul>
</li>
</ul>
<p>ftp服务器开启，还需要查看linux服务器的20,21,22端口是否能够已经打开或者没有被占用，可以使用iptables打开端口。<br>需要注意的是，如果你使用的是阿里云的专有网络，需要在ECS控制台添加安全规则打开20,21端口。另外，如果Tomcat要改到80端口，同样需要在控制台打开。</p>
<p>FTP服务器配置完成后，可以通过CuteFTP等，连接ftp服务器的工具，来实现从windows到linux的ftp连接。<br>将web项目打包成war文件，上传到linux服务器之后，将war包移动到tomcat目录下的webapps目录下，就会自动解压成网站的项目文件，然后重启Tomcat就可以了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2017/06/12/centos-mysql-tomcat环境下Web项目配置/" data-id="cjfv1oav4000brvzn23h03qs1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat-Linux/">Tomcat && Linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java开发手册阅读整理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/03/Java开发手册阅读整理/" class="article-date">
  <time datetime="2017-06-02T16:03:13.000Z" itemprop="datePublished">2017-06-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/03/Java开发手册阅读整理/">Java开发手册阅读整理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录</strong>
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#编程规范"><span class="toc-number">1.</span> <span class="toc-text"><a href="#&#x7F16;&#x7A0B;&#x89C4;&#x8303;" class="headerlink" title="&#x7F16;&#x7A0B;&#x89C4;&#x8303;"></a>&#x7F16;&#x7A0B;&#x89C4;&#x8303;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）命名规范"><span class="toc-number">1.1.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E00;&#xFF09;&#x547D;&#x540D;&#x89C4;&#x8303;" class="headerlink" title="&#xFF08;&#x4E00;&#xFF09;&#x547D;&#x540D;&#x89C4;&#x8303;"></a>&#xFF08;&#x4E00;&#xFF09;&#x547D;&#x540D;&#x89C4;&#x8303;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）常量定义"><span class="toc-number">1.2.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E8C;&#xFF09;&#x5E38;&#x91CF;&#x5B9A;&#x4E49;" class="headerlink" title="&#xFF08;&#x4E8C;&#xFF09;&#x5E38;&#x91CF;&#x5B9A;&#x4E49;"></a>&#xFF08;&#x4E8C;&#xFF09;&#x5E38;&#x91CF;&#x5B9A;&#x4E49;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）格式规约"><span class="toc-number">1.3.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E09;&#xFF09;&#x683C;&#x5F0F;&#x89C4;&#x7EA6;" class="headerlink" title="&#xFF08;&#x4E09;&#xFF09;&#x683C;&#x5F0F;&#x89C4;&#x7EA6;"></a>&#xFF08;&#x4E09;&#xFF09;&#x683C;&#x5F0F;&#x89C4;&#x7EA6;</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#代码规范示例如下"><span class="toc-number">1.3.0.1.</span> <span class="toc-text"><a href="#&#x4EE3;&#x7801;&#x89C4;&#x8303;&#x793A;&#x4F8B;&#x5982;&#x4E0B;" class="headerlink" title="&#x4EE3;&#x7801;&#x89C4;&#x8303;&#x793A;&#x4F8B;&#x5982;&#x4E0B;"></a>&#x4EE3;&#x7801;&#x89C4;&#x8303;&#x793A;&#x4F8B;&#x5982;&#x4E0B;</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（四）OOP规范"><span class="toc-number">1.4.</span> <span class="toc-text"><a href="#&#xFF08;&#x56DB;&#xFF09;OOP&#x89C4;&#x8303;" class="headerlink" title="&#xFF08;&#x56DB;&#xFF09;OOP&#x89C4;&#x8303;"></a>&#xFF08;&#x56DB;&#xFF09;OOP&#x89C4;&#x8303;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（五）集合处理"><span class="toc-number">1.5.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E94;&#xFF09;&#x96C6;&#x5408;&#x5904;&#x7406;" class="headerlink" title="&#xFF08;&#x4E94;&#xFF09;&#x96C6;&#x5408;&#x5904;&#x7406;"></a>&#xFF08;&#x4E94;&#xFF09;&#x96C6;&#x5408;&#x5904;&#x7406;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（六）并发处理"><span class="toc-number">1.6.</span> <span class="toc-text"><a href="#&#xFF08;&#x516D;&#xFF09;&#x5E76;&#x53D1;&#x5904;&#x7406;" class="headerlink" title="&#xFF08;&#x516D;&#xFF09;&#x5E76;&#x53D1;&#x5904;&#x7406;"></a>&#xFF08;&#x516D;&#xFF09;&#x5E76;&#x53D1;&#x5904;&#x7406;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（七）控制语句"><span class="toc-number">1.7.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E03;&#xFF09;&#x63A7;&#x5236;&#x8BED;&#x53E5;" class="headerlink" title="&#xFF08;&#x4E03;&#xFF09;&#x63A7;&#x5236;&#x8BED;&#x53E5;"></a>&#xFF08;&#x4E03;&#xFF09;&#x63A7;&#x5236;&#x8BED;&#x53E5;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（八）注释规范"><span class="toc-number">1.8.</span> <span class="toc-text"><a href="#&#xFF08;&#x516B;&#xFF09;&#x6CE8;&#x91CA;&#x89C4;&#x8303;" class="headerlink" title="&#xFF08;&#x516B;&#xFF09;&#x6CE8;&#x91CA;&#x89C4;&#x8303;"></a>&#xFF08;&#x516B;&#xFF09;&#x6CE8;&#x91CA;&#x89C4;&#x8303;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（九）其他"><span class="toc-number">1.9.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E5D;&#xFF09;&#x5176;&#x4ED6;" class="headerlink" title="&#xFF08;&#x4E5D;&#xFF09;&#x5176;&#x4ED6;"></a>&#xFF08;&#x4E5D;&#xFF09;&#x5176;&#x4ED6;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异常日志"><span class="toc-number">2.</span> <span class="toc-text"><a href="#&#x5F02;&#x5E38;&#x65E5;&#x5FD7;" class="headerlink" title="&#x5F02;&#x5E38;&#x65E5;&#x5FD7;"></a>&#x5F02;&#x5E38;&#x65E5;&#x5FD7;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）异常处理"><span class="toc-number">2.1.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E00;&#xFF09;&#x5F02;&#x5E38;&#x5904;&#x7406;" class="headerlink" title="&#xFF08;&#x4E00;&#xFF09;&#x5F02;&#x5E38;&#x5904;&#x7406;"></a>&#xFF08;&#x4E00;&#xFF09;&#x5F02;&#x5E38;&#x5904;&#x7406;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）日志规范"><span class="toc-number">2.2.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E8C;&#xFF09;&#x65E5;&#x5FD7;&#x89C4;&#x8303;" class="headerlink" title="&#xFF08;&#x4E8C;&#xFF09;&#x65E5;&#x5FD7;&#x89C4;&#x8303;"></a>&#xFF08;&#x4E8C;&#xFF09;&#x65E5;&#x5FD7;&#x89C4;&#x8303;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL规范"><span class="toc-number">3.</span> <span class="toc-text"><a href="#MySQL&#x89C4;&#x8303;" class="headerlink" title="MySQL&#x89C4;&#x8303;"></a>MySQL&#x89C4;&#x8303;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）建表规范"><span class="toc-number">3.1.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E00;&#xFF09;&#x5EFA;&#x8868;&#x89C4;&#x8303;" class="headerlink" title="&#xFF08;&#x4E00;&#xFF09;&#x5EFA;&#x8868;&#x89C4;&#x8303;"></a>&#xFF08;&#x4E00;&#xFF09;&#x5EFA;&#x8868;&#x89C4;&#x8303;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）索引规范"><span class="toc-number">3.2.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E8C;&#xFF09;&#x7D22;&#x5F15;&#x89C4;&#x8303;" class="headerlink" title="&#xFF08;&#x4E8C;&#xFF09;&#x7D22;&#x5F15;&#x89C4;&#x8303;"></a>&#xFF08;&#x4E8C;&#xFF09;&#x7D22;&#x5F15;&#x89C4;&#x8303;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）SQL规范"><span class="toc-number">3.3.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E09;&#xFF09;SQL&#x89C4;&#x8303;" class="headerlink" title="&#xFF08;&#x4E09;&#xFF09;SQL&#x89C4;&#x8303;"></a>&#xFF08;&#x4E09;&#xFF09;SQL&#x89C4;&#x8303;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（四）ORM规范"><span class="toc-number">3.4.</span> <span class="toc-text"><a href="#&#xFF08;&#x56DB;&#xFF09;ORM&#x89C4;&#x8303;" class="headerlink" title="&#xFF08;&#x56DB;&#xFF09;ORM&#x89C4;&#x8303;"></a>&#xFF08;&#x56DB;&#xFF09;ORM&#x89C4;&#x8303;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#工程规约"><span class="toc-number">4.</span> <span class="toc-text"><a href="#&#x5DE5;&#x7A0B;&#x89C4;&#x7EA6;" class="headerlink" title="&#x5DE5;&#x7A0B;&#x89C4;&#x7EA6;"></a>&#x5DE5;&#x7A0B;&#x89C4;&#x7EA6;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）应用分层"><span class="toc-number">4.1.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E00;&#xFF09;&#x5E94;&#x7528;&#x5206;&#x5C42;" class="headerlink" title="&#xFF08;&#x4E00;&#xFF09;&#x5E94;&#x7528;&#x5206;&#x5C42;"></a>&#xFF08;&#x4E00;&#xFF09;&#x5E94;&#x7528;&#x5206;&#x5C42;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）二方库规约"><span class="toc-number">4.2.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E8C;&#xFF09;&#x4E8C;&#x65B9;&#x5E93;&#x89C4;&#x7EA6;" class="headerlink" title="&#xFF08;&#x4E8C;&#xFF09;&#x4E8C;&#x65B9;&#x5E93;&#x89C4;&#x7EA6;"></a>&#xFF08;&#x4E8C;&#xFF09;&#x4E8C;&#x65B9;&#x5E93;&#x89C4;&#x7EA6;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）服务器规约"><span class="toc-number">4.3.</span> <span class="toc-text"><a href="#&#xFF08;&#x4E09;&#xFF09;&#x670D;&#x52A1;&#x5668;&#x89C4;&#x7EA6;" class="headerlink" title="&#xFF08;&#x4E09;&#xFF09;&#x670D;&#x52A1;&#x5668;&#x89C4;&#x7EA6;"></a>&#xFF08;&#x4E09;&#xFF09;&#x670D;&#x52A1;&#x5668;&#x89C4;&#x7EA6;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安全规约"><span class="toc-number">5.</span> <span class="toc-text"><a href="#&#x5B89;&#x5168;&#x89C4;&#x7EA6;" class="headerlink" title="&#x5B89;&#x5168;&#x89C4;&#x7EA6;"></a>&#x5B89;&#x5168;&#x89C4;&#x7EA6;</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#法律声明："><span class="toc-number">5.0.0.1.</span> <span class="toc-text"><a href="#&#x6CD5;&#x5F8B;&#x58F0;&#x660E;&#xFF1A;" class="headerlink" title="&#x6CD5;&#x5F8B;&#x58F0;&#x660E;&#xFF1A;"></a><strong>&#x6CD5;&#x5F8B;&#x58F0;&#x660E;</strong>&#xFF1A;</span></a></li></ol></li></ol></li></ol></li></ol>
        </div>
        

        <p>今天把阿里巴巴的《Java开发手册》阅读了一下，把觉得重要的地方，以及自己不懂的地方进行了摘抄和整理，方便大家交流以及自己以后的查用。<br>就本人感觉而言，这套针对Java Web后台开发的手册对我的帮助比较大。主要体现在代码的规范，MySQL数据库使用规范，以及后台一些常见的问题解决办法，给了我指导性的意见。本人在开发过程中遇到的一些问题，在这本手册中都得到了比较好的解答，也知道了一些问题解决的最优解。所以拿出来和大家分享交流。<br>有的知识点不太理解，本着宁滥勿缺的原则，我通过类似摘抄的方法记录下来，希望读者见谅。<br><a href="http://oqvbarc9z.bkt.clouddn.com/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%28%E6%AD%A3%E5%BC%8F%E7%89%88%29.pdf" target="_blank" rel="noopener">《阿里巴巴Java开发手册1.0.0》</a></p>
<h2 id="编程规范"><a href="#编程规范" class="headerlink" title="编程规范"></a>编程规范</h2><h3 id="（一）命名规范"><a href="#（一）命名规范" class="headerlink" title="（一）命名规范"></a>（一）命名规范</h3><ol>
<li>类名使用驼峰风格，例如UpperCamelCase，领域模型例外   </li>
<li>方法名，参数名，成员变量，局部变量同意使用 lowerCamelCase 风格  </li>
<li>常量命名全部大写，并用下划线隔开，力求语义表达完整，例如 MAX_STOCK_COUNT  </li>
<li>抽象类命名使用Abstract或Base开头：异常类命名使用Exception结尾；测试类命名以它要测试的类的名称开始，以Test结尾  </li>
<li>数组以下面的方式定义， String[] args;  </li>
<li>POJO类中，也就是JavaBean类中，布尔类型变量都不要加is，否则部分分析框架会引起序列化错误  </li>
<li>使用设计模式是需要在类的命名是体现出来，例如<br>public class OrderFactory;<br>public class LoginProxy;<br>public class ResourceObserver;</li>
<li>接口类中的方法和属性不要加修饰符号，包括public，并加上有效的Javadoc注释</li>
<li>枚举类名建议加上Enum后缀，枚举成员名称需要全大写，单词间用下划线隔开</li>
<li>各层命名规范,偷懒上图了<br><img src="http://oqvbarc9z.bkt.clouddn.com/17060301.png" alt="">  </li>
</ol>
<h3 id="（二）常量定义"><a href="#（二）常量定义" class="headerlink" title="（二）常量定义"></a>（二）常量定义</h3><ol>
<li>long或Long初始赋值时，必须用大写的Long，防止字母 l 与数字 1 混淆</li>
<li>按常量功能进行分类，储存在不同的常量类中</li>
<li>跨应用的常量应放置在二方库的constant目录下<br>引用共享常量放在一方库的modules中的constant目录下</li>
</ol>
<h3 id="（三）格式规约"><a href="#（三）格式规约" class="headerlink" title="（三）格式规约"></a>（三）格式规约</h3><ol>
<li>大括号为空不需要换行。非空的大括号，左大括号前不换行，左大括号后换行，右大括号前换行，右大括号后有else等代码不换行。右大括号表示终止，后面必须换行</li>
<li>左括号和后一个字符之间不出现空格；有括号和前一个字符之间不出现空格。</li>
<li>if/for/while/switch/do等保留字与左右括号间必须有空格。</li>
<li>任何运算符左右必须有空格</li>
<li>缩进禁止使用tab，使用四个空格<br>如果你一定要用，IDEA设置tab为4个空格时，请勿勾选 Use tab character，而在 eclipse中，必须勾选 insert spaces for tabs。</li>
<li>单行字符数不超过120个，换行时<ul>
<li>第二行相对第一行缩进4个空格，从第三行开始，不再缩进</li>
<li>运算符与下文一起换行</li>
<li>方法调用的点符号与下文一起换行</li>
<li>在多个参数超长，在逗号后换行</li>
<li>在括号前不换行<br><img src="http://oqvbarc9z.bkt.clouddn.com/17060302.png" alt=""></li>
</ul>
</li>
<li>方法的参数，多个参数都好后加空格</li>
<li>IDE的text file encoding设置为 UTF-8 ， IDE 中文件换行符使用Unix格式，比使用WIndows格式</li>
</ol>
<h5 id="代码规范示例如下"><a href="#代码规范示例如下" class="headerlink" title="代码规范示例如下"></a>代码规范示例如下</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String args[]) &#123; </span><br><span class="line">    // 缩进4个空格 </span><br><span class="line">    String say = &quot;hello&quot;;</span><br><span class="line">     // 运算符的左右必须有一个空格 </span><br><span class="line">    int flag = 0; </span><br><span class="line">    //关键词if与括号之间必须有一个空格，括号内的 f 与左括号，0与右括号不需要空格</span><br><span class="line">     if (flag == 0) &#123;</span><br><span class="line">        System.out.println(say);</span><br><span class="line">     &#125;</span><br><span class="line">    // 左大括号前加空格且不换行；左大括号后换行 if (flag == 1) &#123;</span><br><span class="line">    System.out.println(&quot;world&quot;);</span><br><span class="line">    // 右大括号前换行，右大括号后有 else，不用换行</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">         System.out.println(&quot;ok&quot;);</span><br><span class="line">    // 在右大括号后直接结束，则必须换行</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="（四）OOP规范"><a href="#（四）OOP规范" class="headerlink" title="（四）OOP规范"></a>（四）OOP规范</h3><ol>
<li>直接用类名来访问类的静态变量或静态方法</li>
<li>Object的equals方法容易抛出指针异常，所以推荐使用常量或确定有值的对象来调用equals，例如 “test”.euquals(object);</li>
<li>所有相同类型的包装类对象之间的值比较，全部使用equals方法<br>文档中解释也不是很清楚<br><img src="http://oqvbarc9z.bkt.clouddn.com/17060303.png" alt=""></li>
<li>POJO类必须写toString方法，使用IDE中source &gt; generate toString时，如果继承了另一个POJO类注意在前面加 super.toString。</li>
<li>循环体内，字符串的联结方式，使用StringBuilder的append方法进行拓展</li>
<li>慎用 Object 的clone方法拷贝对象  </li>
</ol>
<h3 id="（五）集合处理"><a href="#（五）集合处理" class="headerlink" title="（五）集合处理"></a>（五）集合处理</h3><ol>
<li>遍历Map类集合KV时，尽量使用entrySet而不是使用keySet<br> 使用keySet遍历Map时，第一次遍历把键值对转化为Iteration对象，当你得到key想获得value时又遍历了一次map，而使用entrySet，第一次遍历直接把键值对直接放到了entrySet中，效率更高。<br>  JDK8可以直接使用Map.foreach方法</li>
<li>4中Map实现类的比较<br><img src="http://oqvbarc9z.bkt.clouddn.com/17060304.png" alt=""></li>
<li>对集合去重时，尽量利用Set元素唯一的特性，可以提高效率</li>
<li>list的subList方法需要注意的地方很多，谨慎使用</li>
<li><p>集合转数组，推荐使用 toArray(T[] array)方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = new ArrayList&lt;String&gt;(2); </span><br><span class="line">String[] array = new String[list.size];</span><br><span class="line">array = list.toArray(array);</span><br></pre></td></tr></table></figure>
<p>数组转集合，可以使用Arrays.asList()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String[] str = new String[] &#123; &quot;a&quot;, &quot;b&quot; &#125;; </span><br><span class="line">List list = Arrays.asList(str);</span><br></pre></td></tr></table></figure>
</li>
<li><p>不要在foreach循环中进行add/remove操作，会造成错误，如果强行要使用可以利用Iteration遍历，并发操作还需要加锁</p>
</li>
<li>初始化ArrayList时要注意使用ArrayList(int initialCapacity)规定其大小</li>
</ol>
<h3 id="（六）并发处理"><a href="#（六）并发处理" class="headerlink" title="（六）并发处理"></a>（六）并发处理</h3><p>这一部分由于作者本人并发编程经验较为匮乏，无法辨别要点重要与否，本着学习的态度进行详细书写以便以后参考。</p>
<ol>
<li>获取单例对象需要保证线程安全，对象的方法也需要注意。资源驱动类，工具类，单例工厂类都需要注意。</li>
<li><p>创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimerTaskThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123; <span class="function"><span class="keyword">public</span> <span class="title">TimerTaskThread</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.setName(<span class="string">"TimerTaskThread"</span>); </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。<br>使用线程池的好处是减少在创建和销毁线程上所花的时间以及系统资源的开销，解决资 源不足的问题。如果不     使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者“过度切换”的问题</p>
</li>
<li>线程池不允许使用 Executors去创建，而是通过ThreadPoolExecutor的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</li>
<li><p>SimpleDateFormat是线程不安全的类，一般不要定义为static变量，如果定义为static，必须加锁，或者使用DateUtils工具类。使用DateUtils是推荐下面的方法</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private static final ThreadLocal&lt;DateFormat&gt; df = new ThreadLocal&lt;DateFormat&gt;() &#123; </span><br><span class="line">    @Override protected DateFormat initialValue() &#123; </span><br><span class="line">        return new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p> 如果是JDK8的应用，可以使用Instant代替Date，LocalDateTime代替Calendar，DateTimeFormatter代替Simpledateformatter，官方给出的解释：simple beautiful strong immutable thread-safe。</p>
</li>
<li>高并发时，能用无锁数据结构，就不要用锁；能 锁区块，就不要锁整个方法体；能用对象锁，就不要用类锁。</li>
<li>对多个资源、数据库表、对象同时加锁时，需要保持一致的加锁顺序，否则可能会造成死锁</li>
<li>并发修改同一记录时，避免更新丢失，要么在应用层加锁，要么在缓存加锁，要么在数据库层使用乐观锁，使用version作为更新依据。如果每次访问冲突概率小于 20%，推荐使用乐观锁，否则使用悲观锁。乐观锁的重试次 数不得小于 3 次</li>
<li>多线程并行处理定时任务时，Timer运行多个TimeTask时，只要其中之一没有捕获抛出的异常，其它任务便会自动终止运行，使用ScheduledExecutorService则没有这个问题。</li>
</ol>
<h3 id="（七）控制语句"><a href="#（七）控制语句" class="headerlink" title="（七）控制语句"></a>（七）控制语句</h3><ol>
<li>switch必须包含default语句放到最后。</li>
<li>即使只有一行代码，if/else/for/while/do也必须使用大括号</li>
<li><p>尽量少使用if else的结构，改写成以下结构</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">If(condition) &#123;</span><br><span class="line">…</span><br><span class="line">Return obj;</span><br><span class="line"> &#125;</span><br><span class="line">…</span><br></pre></td></tr></table></figure>
<p>如果一定要用的话，一定不能超过三层if else的结构</p>
</li>
<li>条件判断的参数要尽量简洁，可读性要尽可能高，推荐赋值给布尔值</li>
<li>尽量提升循环体内的语句性能，定义变量，对象，获取数据库连接尽量在循环体外，try-catch也尽量在循环体外</li>
</ol>
<h3 id="（八）注释规范"><a href="#（八）注释规范" class="headerlink" title="（八）注释规范"></a>（八）注释规范</h3><ol>
<li>类、类属性、类方法的注释必须使用Javadoc规范，使用/**内容**/格式,不得使用 //xxx方式。</li>
<li>抽象方法必须注释，除了返回值，参数，异常之外，还需要指出方法做了什么</li>
<li>类需要添加创造者信息</li>
<li>所有枚举类需要注释</li>
<li>与其用半吊子英文，不如用中文注释讲清楚</li>
<li>注释掉的代码尽量要配合注释进行说明</li>
</ol>
<h3 id="（九）其他"><a href="#（九）其他" class="headerlink" title="（九）其他"></a>（九）其他</h3><ol>
<li>后台传输给页面的变量必须加$!{var}，这样如果传过去的数据var=null或不存在，$!{var}可以直接显示在页面上</li>
<li>Math.random()返回的是double类，取值范围 [0,1), 若要取整数类型的随机数，不要把x放大10若干倍后取整，应该使用Random对象的nextInt或nextLong方法</li>
<li>获取当前毫秒数，使用 System.currentTImeMills(), 而不是 new Date().getTime()<br>利用 System,nanoTime() 可获得更精确的纳米级时间值。<br>JDK8中，针对统计时间场景，推荐使用 Instant 类  </li>
<li>任何数据结构构造或初始化，应当指定大小，避免数据结构无限增长吃光内存  </li>
</ol>
<h2 id="异常日志"><a href="#异常日志" class="headerlink" title="异常日志"></a>异常日志</h2><h3 id="（一）异常处理"><a href="#（一）异常处理" class="headerlink" title="（一）异常处理"></a>（一）异常处理</h3><ol>
<li>不要捕获继承RuntimeException的运行时异常类，如IndexOutOfBoundsException / NullPointerException，这些异常必须与检查来规避。</li>
<li>finally必须对资源对象，流对象进行关闭，有异常也需要try-catch</li>
<li>防止NPE是程序员的基本修养，注意一下场景：<ul>
<li>返回类型为包装数据类型，有可能是null，返回int值时注意判空</li>
<li>数据库查询结果可能是null</li>
<li>集合里的元素及时isNotEmpty，取出元素也可能为null</li>
<li>远程调用返回对象，一律要求进行NPE判断</li>
<li>对Session中获取数据，建议NPE检查。避免空指针</li>
<li>级联调用obj.getA().getB().getC()，一连串调用，易产生NPE</li>
</ul>
</li>
<li>使用有业务含义的自定义异常，避免跑出Exception或者Throwable，推荐业界自定义异常，DaoException，ServiceException</li>
<li>避免代码重复</li>
</ol>
<h3 id="（二）日志规范"><a href="#（二）日志规范" class="headerlink" title="（二）日志规范"></a>（二）日志规范</h3><ol>
<li>应用日志框架SLF4J中的API进行日志管理，而不是使用日志系统(Log4j,Logback)</li>
<li>日志文件推荐保存至少15天</li>
<li>拓展日志命名方式： <ul>
<li>appName_logType_logName.log。</li>
<li>logType:日志类型，推荐分类有stats/desc/monitor/visit等</li>
<li>logName:日志描述。</li>
</ul>
</li>
<li>异常信息应该包括两类信息：案发现场信息和异常堆栈信息，案发现场信息这个好好笑</li>
</ol>
<h2 id="MySQL规范"><a href="#MySQL规范" class="headerlink" title="MySQL规范"></a>MySQL规范</h2><h3 id="（一）建表规范"><a href="#（一）建表规范" class="headerlink" title="（一）建表规范"></a>（一）建表规范</h3><ol>
<li>表达是否概念的字段以 is_xxx的方式命名，数据类型是unsigned tinyint,1表示是，0表示否。任何字段为非负数时，类型必须是unsigned</li>
<li>表名，字段名必须使用小写字母和数字，禁止使用数字开头，禁止两个下划线中间只有数字。数据库字段名修改代价太大，必须慎之又慎！</li>
<li>表名不使用复数名词</li>
<li>唯一索引名为uk_字段名，普通索引为idx_字段名</li>
<li>小数类型为decimal，禁止使用float和double</li>
<li>储存定长度字符串，需要使用char定长字符串类型</li>
<li>varchar可变长字符串，不预先分配存储空间，长度不超过5000，超过5000，则定义为text，独立出一张表，用主键对应，避免影响其他字段索引效率</li>
<li>表必备字段 id，gmt_create,gmt_modified,其中id必为主键，类型为unsigned bigint、单表自增、步长为1。gmt_create,gmt_modified的类型均为date_time类型。这两个字段从字面理解的话应该是一条记录创建的时间和最后一次修改的时间。</li>
<li>表命名是最好加上“业务名称_表的作用”</li>
<li>单表行数超过500万或者单表容量超过2GB，才推荐分库分表  </li>
</ol>
<h3 id="（二）索引规范"><a href="#（二）索引规范" class="headerlink" title="（二）索引规范"></a>（二）索引规范</h3><ol>
<li>业务上具有唯一特征的字段，即使是组合字段，也必须建成唯一索引。</li>
<li>超过三个表禁止join</li>
<li>在varchar字段上建立索引，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度。</li>
<li>sql性能优化的目标：至少达到range级别，要求是ref级别，如果可以是consts最好<ul>
<li>consts： 单表中自多只有一个匹配行（主键或者唯一索引），在优化阶段即可读取到数据</li>
<li>ref： 使用普通的索引（normal index）</li>
<li>range： 对索引进行范围检索</li>
</ul>
</li>
<li>如果有order by的场景，注意利用索引的有序性。Order by最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现file_sort的情况，影响查询性能。<br> 例如：索引中有范围查找，那么索引有序性无法利用，如：<code>Where a&gt;10 order by b;</code> 索引a_b无法排序。而 where a=? and b = ? order by c; 索引： a_b_c 就不会影响查询性能</li>
<li>建立组合索引的时候，区分度越高，放在越左边</li>
</ol>
<h3 id="（三）SQL规范"><a href="#（三）SQL规范" class="headerlink" title="（三）SQL规范"></a>（三）SQL规范</h3><ol>
<li>不要使用 COUNT(column) 代替 COUNT(*)，前者不会统计 column 为 null 的一列，而后者不会统计一列全为 null 的值</li>
<li>COUNT(distinct col) 计算该列除 NULL 之外的不重复数量， 注意使用 COUNT(distinct col1,col2) 时，只有有一列为 NULL，就不会统计改行</li>
<li>当某一行全为NULL，count(col)返回0，但sum(col)返回 NULL，因此sun()需要注意NPE的问题。</li>
<li>NULL与任何值比较返回都是NULL。使用ISNULL()可以判断是否为NULL。</li>
<li>写分页查询时，如果count为0则直接返回，避免执行后面的分页语句。</li>
<li>不得使用外键与级联，一切外键概念必须在应用层解决。<br>外键和级联更新适用于单机低并发，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库跟新风暴的风险；外键影响数据库的插入速度。</li>
<li>禁止使用存储过程，存储过程难以调试和拓展，没有移植性</li>
<li>数据订正，删除，和修改记录，要先select，避免出现误删除，确认无误才能更新</li>
<li>in操作能避免就避免，如果避免不了，要控制in后面的集合在1000个以内</li>
<li>如果有全球化需要，所有字符存储和表示，均以utf-8编码，如果使用表情，用utfmb4来存储</li>
<li>TRUNCATE TABLE 比 DELETE速度快，且使用的系统和事务日志资源少，但TRUNCATE无事务且不触发trigger，有可能造成事故，故不建议在开发代码中使用它。</li>
</ol>
<h3 id="（四）ORM规范"><a href="#（四）ORM规范" class="headerlink" title="（四）ORM规范"></a>（四）ORM规范</h3><ol>
<li>表查询中不准使用*作为查询字段，必须写明哪些字段</li>
<li>POJO类的boolean属性不能加is，而数据库字段必须加is_,要求在resultMap中进行字段与属性之间的影射。</li>
<li>不要用resultClass当返回参数，即使所有类属性名为数据库字段一一对应，也需要定义：反过来，每一个表也必须有一个与之对应。</li>
<li>xml配置中参数注意使用： #{}，#param# 不要使用 &amp;{} 这种方法容易出现SQL注入</li>
<li>iBATIS自带的queryForList(Stirng statementName, int start, int size)不推荐</li>
<li>不允许将HashMap与Hashtable作为查询结果集输出</li>
<li>更新数据表记录时，必须同时更新记录对应的gmt_modified字段值为当前时间</li>
<li>写数据更新接口，传入为POJO类，不要写大而全的接口，换句话说，如果你要更新一个字段，就为这个字段特定写一个接口，不要加上一些不需要修改的字段，否则会出现一下问题：1.易出错 2.效率低 3.binlog增加储存</li>
<li>@Transactional 事务不要滥用</li>
<li><isequal> 中的compareValue是与属性值对比的常量，一般是数字，表示相等时带上此条件；<isnotempty> 表示不为空且不为null时执行；<isnotnull>表示不为null值时执行。</isnotnull></isnotempty></isequal></li>
</ol>
<h2 id="工程规约"><a href="#工程规约" class="headerlink" title="工程规约"></a>工程规约</h2><h3 id="（一）应用分层"><a href="#（一）应用分层" class="headerlink" title="（一）应用分层"></a>（一）应用分层</h3><ol>
<li><p><img src="http://oqvbarc9z.bkt.clouddn.com/17060305.png" alt="">     </p>
<ul>
<li>开放接口层：可直接封装Servuce接口暴露成RPC接口；听过web封装成http接口；网口控制层等</li>
<li>终端显示层： 各个端的模板渲染并执行显示层。当前主要是velocity渲染，js渲染，jsp渲染，移动端展示层等。</li>
<li>Web层：主要是对访问控制进行转发，各类基本参数校验，或者不服用的业务简单等</li>
<li>Service层： 相对具体的业务逻辑服务层</li>
<li>Manager层：通用业务处理层，它有如下特征</li>
<li>对第三方平台封装的层，预处理返回结果级转化异常结果</li>
<li>对Service层通用能力的下沉，如缓存方案、中间件通用处理</li>
<li>与DAO层交互、对DAO的业务通用能录的封装</li>
<li>DAO层：数据访问层，与底层MySQL，Oracle，Hbase进行数据交互</li>
<li>外部接口或第三方平台：包括其他部门RPC开放接口，基础平台，其他公司的HTTP接口。   </li>
</ul>
</li>
<li><p>DAO层出现异常使用try-catch语句控制，并throw newDAOException；在Service层出现异常，必须记录日志信息到磁盘，尽可能带上参数信息，相当于保护案发现场。Web层已经处于顶层，不可以继续向上抛出异常，应该跳转到有好的错误页面。  </p>
</li>
</ol>
<h3 id="（二）二方库规约"><a href="#（二）二方库规约" class="headerlink" title="（二）二方库规约"></a>（二）二方库规约</h3><p>二方库使用比较少，也就不准备对这方面进行研究了</p>
<h3 id="（三）服务器规约"><a href="#（三）服务器规约" class="headerlink" title="（三）服务器规约"></a>（三）服务器规约</h3><ol>
<li>并发服务器建议调小TCP协议的time_wait超时时间<br>操作系统默认240秒之后才会关闭time_wait状态的连接，在高并发访问下，服务器会因为连接数太多而无法建立新的连接，所以需要在服务器上调小此等待值</li>
<li>调大服务器支持的最大文件句柄数</li>
<li>给JVM设置-XX:+HeapDumpOnOutOfMemoryError参数，让 JVM 碰到OOM场景时输出 dump信息</li>
<li>服务器内部重定向使用forward，外部重定向使用URL拼装工具类生成</li>
</ol>
<h2 id="安全规约"><a href="#安全规约" class="headerlink" title="安全规约"></a>安全规约</h2><ol>
<li>隶属于用户个人的页面或者功能必须进行权限控制校验</li>
<li>用户名敏感数据禁止直接展示，必须对展示数据脱敏</li>
<li>防止SQL注入，用户输入sql参数严格使用参数绑定或者METADATA字段限定，禁止字符串拼接SQL访问数据库</li>
<li>用户请求传入的任何参数必须做有效性验证，防止<ul>
<li>Page size 过大导致内存溢出</li>
<li>恶意 order by 导致数据库慢查询</li>
<li>任意重定向</li>
<li>SQL注入</li>
<li>反序列化注入</li>
<li>正则输入源串拒绝服务 ReDoS<br>使用正则表达式验证客户端输入时，有些正则写法验证普通用户输入没问题，但一些特殊构造的字符串输入可能导致死循环的效果</li>
</ul>
</li>
<li>禁止向HTML页面输出未经安全过滤或未正确转义的用户数据</li>
<li>表单，AJAX提交必须执行CSRF安全过滤</li>
<li>在使用平台资源，譬如短信、邮件、电话、下单、支付，必须实现正确的防重放限制，如数量限制、疲劳度控制、验证码校验，避免被滥刷、资损。</li>
<li>发贴、评论、发送即时消息等用户生成内容的场景必须实现防刷、文本内容违禁词过滤等风控策略。</li>
</ol>
<h5 id="法律声明："><a href="#法律声明：" class="headerlink" title="法律声明："></a><strong>法律声明</strong>：</h5><p>该手册为阿里巴巴集团技术部的技术分享，版权归阿里巴巴集团所有，仅供大家交流、学习及研究使用，禁止使用商业用途，违者必究</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2017/06/03/Java开发手册阅读整理/" data-id="cjfv1oaux0006rvznemyxhdas" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CORBA简介与简单实践" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/01/CORBA简介与简单实践/" class="article-date">
  <time datetime="2017-06-01T11:34:19.000Z" itemprop="datePublished">2017-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/01/CORBA简介与简单实践/">CORBA简介与简单实践</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        

        <p>这学期《网络与分布式计算》有一个大作业是使用Java/CORBA实现分布应用编程，自己查阅了一些资料，并对CORBA进行了实践。</p>
<h2 id="关于CORBA"><a href="#关于CORBA" class="headerlink" title="关于CORBA"></a>关于CORBA</h2><h3 id="什么是CORBA"><a href="#什么是CORBA" class="headerlink" title="什么是CORBA"></a>什么是CORBA</h3><p><strong>CORBA</strong>：Common Object Request Broker Architecture,通用对象请求代理体系。是由对象管理组(Object Management Group, OMG)制定的一种标准的面向对象分布式应用程序体系规范，旨在为异构分布式环境中，硬件和软件系统的互联而提出的一种解决方案。</p>
<h3 id="解决异构分布式系统两条主要原则"><a href="#解决异构分布式系统两条主要原则" class="headerlink" title="解决异构分布式系统两条主要原则"></a>解决异构分布式系统两条主要原则</h3><ul>
<li>寻求独立于平台的模型和抽象，这样有助于解决大部分问题 </li>
<li>在不牺牲太多性能的前提下，尽可能隐藏底层的复杂细节</li>
</ul>
<p>第一点不是很理解，我只能理解为为了规避现有开发模型而建立独立的模型和抽象，为的是解决其他平台本身存在而无法解决的问题<br>第二点应该是为了实现java语言的封装性，利用接口,隐藏底层的具体实现</p>
<h3 id="对象管理组-OMG-定义的两类与平台无关的分布式对象模型"><a href="#对象管理组-OMG-定义的两类与平台无关的分布式对象模型" class="headerlink" title="对象管理组(OMG)定义的两类与平台无关的分布式对象模型"></a>对象管理组(OMG)定义的两类与平台无关的分布式对象模型</h3><ol>
<li>对象模型(Object Model)：用来定义在一个异构环境中，如何描述分布式对象接口。对象模型将对象定义为永恒不变、始终唯一的，对象模型封装实体，这些实体只能被严格定义的接口访问，客户机通过向对象发请求，才能使用对象提供的服务，对象的实现细节和它的位置对于客户机上隐藏的。</li>
<li>引用模型(Reference Model)：用来说明对象之间如何交互。引用模型提供的接口种类，通常是按对象接口编组，所有接口种类有一个对象请求代理(Object Request Broker,ORB)按概念链接在一起。通常，一个ORB可以在客户机和对象之间进行通信，当请求发送给对象时，透明地激活那些没有运行的对象。</li>
</ol>
<h3 id="对象管理组-OMG-的接口种类"><a href="#对象管理组-OMG-的接口种类" class="headerlink" title="对象管理组(OMG)的接口种类"></a>对象管理组(OMG)的接口种类</h3><ol>
<li><strong>对象服务接口</strong>：Object Services,OS.是与领域无关(水平定向)的接口，对象管理组定义的命名服务(Naming Service)和交易服务(Trading Service)都是对象服务。对象服务通常被认为是分布式计算架构的核心部分。</li>
<li><strong>领域接口</strong>：Domain Interface,DI.其作用与对象服务接口类似，但是领域接口针对领域而已，它与特定领域相关(垂直定向)。</li>
<li><strong>应用程序接口</strong>：Application Interface,AI.是专门为特定应用程序而开发的，并不是对象管理组所制定的标准。但是如果某些应用程序的接口出现在许多不同的应用程序中，那么这些应用程序接口应作为其他接口种类中的一类成为接口标准化的备选项。</li>
</ol>
<p><img src="http://oqvbarc9z.bkt.clouddn.com/0_1308019197TIvx.png" alt=""><br>图片引用自<a href="http://blog.csdn.net/chjttony/article/details/6543116" target="_blank" rel="noopener">CSDN博客</a></p>
<h2 id="关于实践"><a href="#关于实践" class="headerlink" title="关于实践"></a>关于实践</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>需求文档是英文的，这里只简单说一下。想要看更详细的英文任务书可以在这里<a href="http://oqvbarc9z.bkt.clouddn.com/CORBA%E7%BC%96%E7%A8%8B%E4%BB%BB%E5%8A%A1%E4%B9%A6.docx" target="_blank" rel="noopener">下载</a></p>
<p>使用Java/CORBA完成一个分布式的计划清单(to-do list)应用，使用Java IDL，一个完全由java编写的CORBA ORB编译器。以下所有功能必须由客户端使用CORBA naming service来调用，每一个用户的计划列表必须是有CORBA管理的独立对象。<br>需要实现以下功能：</p>
<ul>
<li>用户注册<br>新用户需要注册。新的用户必须提供用户名(user name)和密码(password)。如果提供的用户名已经存在，就在屏幕上打印错误信息。如果成功注册，客户端需要打印信息说明注册成功。当一个用户成功注册时，服务器应当为该用户初始化一个新的任务列表对象(a new to-do list object)</li>
<li>添加事项<br>已注册的用户将会添加新的事项(item)到他们的事项清单中。每一个事项包含以下三个要素：开始时间，结束时间和一个便签。无论添加成功还是失败，用户应当收到客户端发送的相关提示信息。</li>
<li>查询事项<br>已注册的用户将会浏览在一定时间范围内的所有的事项。所以每次进行查询操作时，输入的参数必须包括这个时间范围的开始时间和结束时间，并返回一系列在这个时间段内的事项对象。在这一串返回的清单中，需要包含事项开始时间，结束时间以及便签的内容。  </li>
<li>删除事项<br>已注册的用户将会从自己的清单中删除不想继续保留的事项。这一操作需要输入特定的参数来鉴别是哪一个事项。</li>
</ul>
<h3 id="CORBA应用的基础实现"><a href="#CORBA应用的基础实现" class="headerlink" title="CORBA应用的基础实现"></a>CORBA应用的基础实现</h3><p>首先需要使用使用Java IDL对需要实现的接口进行定义，这里我只是构建CORBA框架，暂时实现的接口只有测试<br>在项目中新建一个Corba.idl文件，定义测试接口：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module CorbaApp&#123;</span><br><span class="line">        interface Corba&#123;</span><br><span class="line">                string corbaTest();</span><br><span class="line">                oneway void shutdown();</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后通过java idl工具编译idl文件，生成目标类。<br>博主用的是windows下的MINGW64环境，使用windows的cmd命令行同样可以<code>$ idlj -fall Corba.idl</code><br>生成了以下文件夹  </p>
<p><img src="http://oqvbarc9z.bkt.clouddn.com/17060103.png" alt="">  </p>
<p>我们只需要用到的CorbaPOA.java这个类，新建类CorbaImpl实现这个POA接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class CorbaImpl extends CorbaPOA&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String corbaTest() &#123;</span><br><span class="line">        System.out.println(&quot;corbaTest&quot;);</span><br><span class="line">        return &quot;Test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void shutdown() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个shutdown方法应该是用来关闭服务器的，我没有实现它，并不妨碍项目。<br>这里CorbaImpl中实现的corbatTest方法，在方法中打印了corbaTest，返回了“Test”，这里CORBA的机制，Test会在Server端打印，corbaTest会在Client端打印，具体的原理会在后面讲到。</p>
<h4 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h4><p>下面实现Server类CorbaServer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">package corba.server;</span><br><span class="line"></span><br><span class="line">import CorbaApp.Corba;</span><br><span class="line">import CorbaApp.CorbaHelper;</span><br><span class="line">import org.omg.CORBA.ORB;</span><br><span class="line">import org.omg.CosNaming.NameComponent;</span><br><span class="line">import org.omg.CosNaming.NamingContextExt;</span><br><span class="line">import org.omg.CosNaming.NamingContextExtHelper;</span><br><span class="line">import org.omg.PortableServer.POA;</span><br><span class="line">import org.omg.PortableServer.POAHelper;</span><br><span class="line"></span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by channel on 2017/5/31.</span><br><span class="line"> */</span><br><span class="line">public class CorbaServer &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void run(String[] args) throws Exception &#123;</span><br><span class="line">        //生成一个对象请求代理（ORB），并初始化</span><br><span class="line">        Properties props = new Properties();</span><br><span class="line">        //初始化端口，默认的端口是900</span><br><span class="line">        props.put(&quot;org.omg.CORBA.ORBInitialPort&quot;, &quot;1050&quot;);</span><br><span class="line">        //绑定到服务器</span><br><span class="line">        props.put(&quot;org.omg.CORBA.ORBInitialHost&quot;, &quot;localhost&quot;);</span><br><span class="line">        //初始化ORB</span><br><span class="line">        ORB orb = ORB.init(args, props);</span><br><span class="line">        // get reference to rootpoa &amp; activate the POAManager</span><br><span class="line">        //获取一个根POA引用，并激活POA管理器</span><br><span class="line">        POA poa = POAHelper.narrow(orb.resolve_initial_references(&quot;RootPOA&quot;));</span><br><span class="line">        poa.the_POAManager().activate();</span><br><span class="line">        //实例化一个HelloImpl对象</span><br><span class="line">        CorbaImpl corba = new CorbaImpl();</span><br><span class="line">        // 从servant获得一个对象引用</span><br><span class="line">        org.omg.CORBA.Object ref = poa.servant_to_reference(corba);</span><br><span class="line">        Corba href = CorbaHelper.narrow(ref);</span><br><span class="line">        // 获得命名上下文</span><br><span class="line">        org.omg.CORBA.Object objref = orb.resolve_initial_references(&quot;NameService&quot;);</span><br><span class="line">        // 使用NamingContextExt 它是INS（Interoperable Naming Service，协同命名规范）的一部分</span><br><span class="line">        NamingContextExt ncRef = NamingContextExtHelper.narrow(objref);</span><br><span class="line">        //绑定一个对象引用，以便客户端可以调用</span><br><span class="line">        String name = &quot;Corba&quot;;</span><br><span class="line">        NameComponent[] nc = ncRef.to_name(name);</span><br><span class="line">        ncRef.rebind(nc, href);</span><br><span class="line">        System.out.println(&quot;CorbaServer ready and waiting......&quot;);</span><br><span class="line"></span><br><span class="line">        //运行ORB</span><br><span class="line">        orb.run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        CorbaServer server = new CorbaServer();</span><br><span class="line">        try &#123;</span><br><span class="line">            server.run(args);</span><br><span class="line">        &#125;catch(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务器主要运行方法run中<br>初始化ORB对象orb，并绑定服务器和端口，这里我绑定的是本机localhost，和1050端口<br><code>Properties props = new Properties();</code><br><code>props.put(&quot;org.omg.CORBA.ORBInitialPort&quot;, &quot;1050&quot;);</code><br><code>ORB orb = ORB.init(args, props);</code><br><strong>ORB</strong>：Object Request Broker,对象请求代理，在一个面向对象的分布式环境中，ORB可以为应用程序、服务器、网络设施之间分发消息提供关键通信设施。可以将ORB想象成一组软件总线，它提供了一个公用消息传递接口，通过这个接口，不同类型的对象可以以对等层策略进行通信。ORB是CORBA的核心组件，提供了识别和定位对象、处理连接管理、传送数据和请求通信的框架结构。<br>所以这里的orb对象是服务器的通信接口，服务器和客户端在网络介质的基础上，通过ORB进行通信。<br>下面初始化POA对象poa，获取poa的根引用并激活POA管理器。<br><code>POA poa = POAHelper.narrow(orb.resolve_initial_references(&quot;RootPOA&quot;));</code><br><code>poa.the_POAManager().activate();</code><br>POA提供了一组服务器端的接口以及操作。POA关注的重点是跟踪侍服对象的实例化以及内存空间信息，侍服对象的激活以及去激活（activation and deactivation），对象引用的创建，以及对象生命周期的管理<br>POA Manager 理论上POA Manager 负责一个或者多个POA的传输终点，负责对POA的请求流进行管理。<br>然后就可以初始化我们的CorbaImpl类对象了<br><code>CorbaImpl corba = new CorbaImpl();</code><br>初始化了这个corba对象，为了让客户端的程序能够调用到corba的方法，需要对其在POA Manager中从servant获得一个引用<br><code>org.omg.CORBA.Object ref = poa.servant_to_reference(corba);</code><br><code>Corba href = CorbaHelper.narrow(ref);</code><br>获得命名上下文<br><code>org.omg.CORBA.Object objref = orb.resolve_initial_references(&quot;NameService&quot;);</code><br>使用NamingContextExt 它是INS（Interoperable Naming Service，协同命名规范）的一部分<br><code>NamingContextExt ncRef = NamingContextExtHelper.narrow(objref);</code><br>绑定一个对象引用，以便客户端可以调用<br><code>String name = &quot;Corba&quot;;</code><br><code>NameComponent[] nc = ncRef.to_name(name);</code><br><code>ncRef.rebind(nc, href);</code><br>下面运行ORB<br><code>orb.run();</code></p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><p>下面是客户端CorbaClient.java的代码：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">package corba.client;</span><br><span class="line"></span><br><span class="line">import CorbaApp.Corba;</span><br><span class="line">import CorbaApp.CorbaHelper;</span><br><span class="line">import corba.corba.util.Database;</span><br><span class="line">import corba.corba.util.Item;</span><br><span class="line">import org.omg.CORBA.ORB;</span><br><span class="line">import org.omg.CosNaming.NamingContextExt;</span><br><span class="line">import org.omg.CosNaming.NamingContextExtHelper;</span><br><span class="line"></span><br><span class="line">import java.text.ParseException;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Properties;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by channel on 2017/5/31.</span><br><span class="line"> */</span><br><span class="line">public class CorbaClient &#123;</span><br><span class="line">    public void run(String[] args) throws Exception &#123;</span><br><span class="line">        Properties props = new Properties();</span><br><span class="line">        // 生成一个ORB，并初始化，这个和Server端一样</span><br><span class="line">        props .put(&quot;org.omg.CORBA.ORBInitialPort&quot;, &quot;1050&quot;);</span><br><span class="line">        props.put(&quot;org.omg.CORBA.ORBInitialHost&quot;, &quot;localhost&quot;);</span><br><span class="line">        ORB orb = ORB.init(args, props);</span><br><span class="line">        // 获得根命名上下文</span><br><span class="line">        org.omg.CORBA.Object objRef = orb.resolve_initial_references(&quot;NameService&quot;);</span><br><span class="line">        // 用NamingContextExt代替NamingContext.</span><br><span class="line">        NamingContextExt ncRef = NamingContextExtHelper.narrow(objRef);</span><br><span class="line"></span><br><span class="line">        // 通过名称获取服务器端的对象引用</span><br><span class="line">        String name = &quot;Corba&quot;;</span><br><span class="line">        Corba corba = CorbaHelper.narrow(ncRef.resolve_str(name));</span><br><span class="line">        System.out.println(&quot;You can input help for help&quot;);</span><br><span class="line">        //调用远程对象</span><br><span class="line">        System.out.println(corba.corbaTest());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        CorbaClient client = new CorbaClient();</span><br><span class="line">        try &#123;</span><br><span class="line">            client.run(args);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>像Server端一样，首先要建立ORB连接，并设置IP地址和端口<br><code>Properties props = new Properties();</code><br><code>props .put(&quot;org.omg.CORBA.ORBInitialPort&quot;, &quot;1050&quot;);</code><br><code>props.put(&quot;org.omg.CORBA.ORBInitialHost&quot;, &quot;localhost&quot;);</code><br><code>ORB orb = ORB.init(args, props);</code><br>获得根命名上下文<br><code>org.omg.CORBA.Object objRef = orb.resolve_initial_references(&quot;NameService&quot;);</code><br>用NamingContextExt代替NamingContext.<br><code>NamingContextExt ncRef = NamingContextExtHelper.narrow(objRef);</code><br>通过名称获取服务器端的对象引用<br><code>String name = &quot;Corba&quot;;</code><br><code>Corba corba = CorbaHelper.narrow(ncRef.resolve_str(name));</code><br>然后我们可以通过corba来调用CorbaImpl的方法了<br><code>System.out.println(corba.corbaTest());</code><br>最后运行corba<br><code>run(crrba);</code>  </p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>首先需要在服务器所在机器开启orbd服务，并开启localhost的1050端口<br><code>$ orbd -ORBInitialPort 1050 -ORBInitialHost localhost</code><br>然后运行服务器 CorbaServer<br>服务器运行成功后再运行客户端CorbaClient<br>然后客户端会在屏幕上输出Test，而不会输出corbaTest<br>我们回头看corbaTest()方法  </p>
<pre><code>@Override
        public String corbaTest() {
            System.out.println(&quot;corbaTest&quot;);
            return &quot;Test&quot;;
        }     
</code></pre><p>因为客户端只是通过引用，使服务器端调用corbaTest()方法，所以System.out.println()的输出是在服务器的控制台中，而这里我们打印了这个方法的返回，所以客户端只有“Test”。</p>
<h3 id="进入正题"><a href="#进入正题" class="headerlink" title="进入正题"></a>进入正题</h3><p>Corba分布式应用框架基本上搭好了，下面就是完成用户事项部分了。<br>项目基本框架如下，使用的编辑器是IDEA<br><img src="http://oqvbarc9z.bkt.clouddn.com/17060201.png" alt=""><br>应用的主体在corba.util包中<br>定义User类，作为用户的持久层，包括账号，密码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> corba.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by channel on 2017/5/31.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPass</span><span class="params">(String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pass = pass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pass.equals(getPass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中verify()方法用于使用用户名获得User对象后进行密码确认。 </p>
<p>定义Item类，作为事项的持久层，包括id，开始日期，结束日期，标签内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> corba.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by channel on 2017/5/31.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    Long id;</span><br><span class="line">    Date start;</span><br><span class="line">    Date end;</span><br><span class="line">    String label;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setStart(<span class="keyword">new</span> Date());</span><br><span class="line">        setEnd(<span class="keyword">new</span> Date());</span><br><span class="line">        setLabel(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">(String begin, String end, String label)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        <span class="comment">//SimpleDateFormat sdf = new SimpleDateFormat("yyyy/MM/dd HH:mm:ss.SSS");</span></span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy/MM/dd HH:mm:ss.SSS"</span>);</span><br><span class="line"></span><br><span class="line">        Date date1 = sdf.parse(begin);</span><br><span class="line">        Date date2 = sdf.parse(end);</span><br><span class="line">        setStart(date1);</span><br><span class="line">        setEnd(date2);</span><br><span class="line">        setLabel(label);</span><br><span class="line">        Calendar now = Calendar.getInstance();</span><br><span class="line">        setId(now.getTimeInMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long i)</span> </span>&#123;</span><br><span class="line">        id = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareBegin</span><span class="params">(Item another)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getStart().compareTo(another.getStart());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareEnd</span><span class="params">(Item another)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getEnd().compareTo(another.getEnd());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Date start,Date end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(getStart().compareTo(start) &gt;= <span class="number">0</span> &amp;&amp; getEnd().compareTo(end) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStart</span><span class="params">(Date start)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnd</span><span class="params">(Date end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLabel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> label;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLabel</span><span class="params">(String label)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.label = label;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"id: "</span> + getId() + <span class="string">" Start date: "</span> + getStart().toString() + <span class="string">" End date: "</span> + getEnd().toString() + <span class="string">" Label: "</span> + getLabel());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义了compare（）方法比较该item是否在某一个时段的区间中</p>
<p>下面是Database类，虽然叫数据库，但只是一个内存中的持久对象。因为项目比较简单也没有要求使用数据库，就将用户信息和事项清单的数据存在服务器内存中，每次服务器重启之后数据都会清空。</p>
<p>Database中储存数据的基本数据格式如下：<br><code>HashMap&lt;String,User&gt; userMap;</code><br><code>HashMap&lt;String,List&lt;Item&gt;&gt; itemMap;</code><br>使用链表LinkedList储存事项清单，是因为考虑到用户添加，删除事项使用链表更快，而对于查询而言，必须遍历所有的Item，LinkedList和ArrayList耗时是一样的，因此选择链表作为最优的数据结构。<br>使用HashMap，将用户名和用户名对应的User对象作为一个键值对储存，将用户名和其对应的事项清单List<item>作为又一个键值对储存。  </item></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> corba.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by channel on 2017/5/31.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Database</span> </span>&#123;</span><br><span class="line">    HashMap&lt;String,List&lt;Item&gt;&gt; itemMap;</span><br><span class="line">    HashMap&lt;String,User&gt; userMap;</span><br><span class="line">    <span class="keyword">int</span> nameMapSize;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Database</span><span class="params">()</span></span>&#123;</span><br><span class="line">        itemMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        userMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        nameMapSize = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">duplicate</span><span class="params">(String m_name)</span></span>&#123;</span><br><span class="line">        Set&lt;String&gt; nameSet = userMap.keySet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String name:nameSet)&#123;</span><br><span class="line">            <span class="keyword">if</span>(m_name.equals(name))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">getItem</span><span class="params">(String username, <span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Item&gt; list = getItemList(username);</span><br><span class="line">            <span class="keyword">for</span>(Item it:list)&#123;</span><br><span class="line">                <span class="keyword">if</span>(id == it.getId())</span><br><span class="line">                    <span class="keyword">return</span> it;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pass</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  0 正常返回</span></span><br><span class="line"><span class="comment">     *          -1 用户名已存在</span></span><br><span class="line"><span class="comment">     *          -2 未知错误</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addUser</span><span class="params">(String username,String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(duplicate(username)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            User user = <span class="keyword">new</span> User();</span><br><span class="line">            user.setUsername(username);</span><br><span class="line">            user.setPass(pass);</span><br><span class="line">            userMap.put(username, user);</span><br><span class="line">            itemMap.put(username, <span class="keyword">new</span> LinkedList&lt;&gt;());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> User if it exists.</span></span><br><span class="line"><span class="comment">     *          Otherwise, it returns null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(String username)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMap.get(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">userExist</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMap.containsKey(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pass</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0 登录成功</span></span><br><span class="line"><span class="comment">     *          -2 不存在该用户</span></span><br><span class="line"><span class="comment">     *          -1 账号密码不正确</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">login</span><span class="params">(String username, String pass)</span> </span>&#123;</span><br><span class="line">        User m_user = getUser(username);</span><br><span class="line">        <span class="keyword">if</span>(m_user.equals(<span class="keyword">null</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!m_user.verify(pass)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">getItemList</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Item&gt; list=itemMap.get(username);</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">query</span><span class="params">(String username, Date start, Date end)</span> </span>&#123;</span><br><span class="line">        List&lt;Item&gt; list=getItemList(username);</span><br><span class="line">        List&lt;Item&gt; list2 = <span class="keyword">new</span> LinkedList&lt;Item&gt;();</span><br><span class="line">        <span class="keyword">if</span>(list==<span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(Item it:list) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">1</span> == it.compare(start, end)) &#123;</span><br><span class="line">                list2.add(it);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list2;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> it</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0 正常</span></span><br><span class="line"><span class="comment">     *          -2 未知错误</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addItem</span><span class="params">(String username, Item it)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List list = getItemList(username);</span><br><span class="line">            list.add(it);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0 正常</span></span><br><span class="line"><span class="comment">     *          -1 没找到这个Item</span></span><br><span class="line"><span class="comment">     *          -2 未知错误</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteItem</span><span class="params">(String username,Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Item&gt; list = getItemList(username);</span><br><span class="line">            <span class="keyword">for</span>(Item it : list) &#123;</span><br><span class="line">                <span class="keyword">if</span> (id.equals(it.getId())) &#123;</span><br><span class="line">                    list.remove(it);</span><br><span class="line">                    itemMap.replace(username, list);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0 成功</span></span><br><span class="line"><span class="comment">     *          -1 用户不存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clear</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!userMap.containsKey(username))</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        itemMap.replace(username, <span class="keyword">new</span> LinkedList&lt;Item&gt;());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Database类完成后，就需要考虑如何将Database的方法封装到CorbaImpl接口中了。<br>修改Corba.idl接口定义文档，添加对数据库操作的接口，由于对idl中自定义类型不了解，所以方法的返回和参数都使用了基础类型。<br>Corba.idl  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module CorbaApp&#123;</span><br><span class="line">        interface Corba&#123;</span><br><span class="line">                </span><br><span class="line">                short regist(in wstring username, in wstring pass);</span><br><span class="line">                short login(in wstring username, in wstring pass);</span><br><span class="line">                short add(in wstring username, in wstring date1, in wstring date2, in wstring label);</span><br><span class="line">                wstring query(in wstring username, in wstring starttime, in wstring endtime);</span><br><span class="line">                short delete(in wstring username, in long long id);</span><br><span class="line">                short clear(in wstring username);</span><br><span class="line"></span><br><span class="line">                oneway void shutdown();</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>用之前的方法更新CorbaApp下的生成的6个类，修改CorbaImpl接口实现类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> corba.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> CorbaApp.CorbaPOA;</span><br><span class="line"><span class="keyword">import</span> corba.util.Database;</span><br><span class="line"><span class="keyword">import</span> corba.util.Item;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by channel on 2017/5/31.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorbaImpl</span> <span class="keyword">extends</span> <span class="title">CorbaPOA</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Database data = <span class="keyword">new</span> Database();</span><br><span class="line">    List&lt;Item&gt; list = <span class="keyword">new</span> LinkedList();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">regist</span><span class="params">(String username, String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">short</span>)data.addUser(username, pass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">login</span><span class="params">(String username, String pass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">short</span>)data.login(username, pass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">add</span><span class="params">(String username, String date1, String date2, String label)</span> </span>&#123;</span><br><span class="line">        Item it = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            it = <span class="keyword">new</span> Item(date1, date2, label);</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">short</span>) data.addItem(username, it);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">(String username, String starttime, String endtime)</span> </span>&#123;</span><br><span class="line">        list = <span class="keyword">null</span>;</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy/MM/dd HH:mm:ss.SSS"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Date date1 = sdf.parse(starttime);</span><br><span class="line">            Date date2 = sdf.parse(endtime);</span><br><span class="line">            list = data.query(username, date1, date2);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == list) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                String out=<span class="string">""</span>;</span><br><span class="line">                <span class="keyword">for</span>(Item it : list) &#123;</span><br><span class="line">                    out += <span class="string">"Id: "</span> + it.getId()+ <span class="string">" "</span>;</span><br><span class="line">                    out += <span class="string">""</span> +</span><br><span class="line">                            <span class="string">""</span>;</span><br><span class="line">                    out += <span class="string">"Start time: "</span> + it.getStart().toString() + <span class="string">" "</span>;</span><br><span class="line">                    out += <span class="string">""</span> +</span><br><span class="line">                            <span class="string">""</span>;</span><br><span class="line">                    out += <span class="string">"End time: "</span> + it.getEnd() + <span class="string">" "</span>;</span><br><span class="line">                    out += <span class="string">""</span> +</span><br><span class="line">                            <span class="string">""</span>;</span><br><span class="line">                    out += <span class="string">"Label: "</span> + it.getLabel() + <span class="string">" "</span>;</span><br><span class="line">                    out += <span class="string">""</span> +</span><br><span class="line">                            <span class="string">""</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> out;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">delete</span><span class="params">(String username, <span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">short</span>) data.deleteItem(username, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">clear</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">short</span>) data.clear(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Database <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面在客户端实现整个程序的运行流程，自定义方法run(),并将Corba对象作为参数传入  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line">public void run(Corba corba)&#123;</span><br><span class="line">        boolean stop = false;</span><br><span class="line">        Scanner scan = new Scanner(System.in);</span><br><span class="line">        String username = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">        while (!stop) &#123;</span><br><span class="line">            String input = scan.nextLine();</span><br><span class="line">            String[] split = input.split(&quot; &quot;);</span><br><span class="line">            if (split.length &lt;= 0) &#123;</span><br><span class="line">                System.out.println(&quot;Input error!&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                switch (split[0]) &#123;</span><br><span class="line">                    case &quot;register&quot;:</span><br><span class="line">                        System.out.println(&quot;username:&quot;);</span><br><span class="line">                        String m_username = scan.nextLine();</span><br><span class="line"></span><br><span class="line">                        System.out.println(&quot;password:&quot;);</span><br><span class="line">                        String m_pass = scan.nextLine();</span><br><span class="line">                        int i = corba.regist(m_username, m_pass);</span><br><span class="line">                        switch (i) &#123;</span><br><span class="line">                            case 0:</span><br><span class="line">                                System.out.println(&quot;Success!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                            case -1:</span><br><span class="line">                                System.out.println(&quot;The username has been used!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                            case -2:</span><br><span class="line">                                System.out.println(&quot;Unknown error!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;login&quot;:</span><br><span class="line">                        System.out.println(&quot;username:&quot;);</span><br><span class="line">                        String n_username = scan.nextLine();</span><br><span class="line"></span><br><span class="line">                        System.out.println(&quot;password:&quot;);</span><br><span class="line">                        String n_pass = scan.nextLine();</span><br><span class="line">                        int k = corba.login(n_username, n_pass);</span><br><span class="line">                        switch (k) &#123;</span><br><span class="line">                            case 0:</span><br><span class="line">                                System.out.println(&quot;User &quot; + n_username + &quot; has logged in&quot;);</span><br><span class="line">                                username = n_username;</span><br><span class="line">                                break;</span><br><span class="line">                            case -1:</span><br><span class="line">                                System.out.println(&quot;Wrong password!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                            case -2:</span><br><span class="line">                                System.out.println(&quot;The username &quot; + n_username + &quot; has not been registered!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;add&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            System.out.println(&quot;Input start time in this type yyyy/MM/dd HH:mm:ss.SSS&quot;);</span><br><span class="line">                            String starttime = scan.nextLine();</span><br><span class="line">                            System.out.println(&quot;Input end time in this type yyyy/MM/dd HH:mm:ss.SSS&quot;);</span><br><span class="line">                            String endtime = scan.nextLine();</span><br><span class="line">                            System.out.println(&quot;Input the label information&quot;);</span><br><span class="line">                            String label = scan.nextLine();</span><br><span class="line">                            int p = corba.add(username, starttime, endtime, label);</span><br><span class="line">                            switch (p) &#123;</span><br><span class="line">                                case 0:</span><br><span class="line">                                    System.out.println(&quot;Success!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case -2:</span><br><span class="line">                                    System.out.println(&quot;Unknow error!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case -9:</span><br><span class="line">                                    System.out.println(&quot;Unable to initilize the item!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                     &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;query&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">                            System.out.println(&quot;Input start time in this type yyyy/MM/dd HH:mm:ss.SSS&quot;);</span><br><span class="line">                            String starttime = scan.nextLine();</span><br><span class="line">                            System.out.println(&quot;Input end time in this type yyyy/MM/dd HH:mm:ss.SSS&quot;);</span><br><span class="line">                            String endtime = scan.nextLine();</span><br><span class="line">                            Date date1 = null;</span><br><span class="line">                            String p = corba.query(username, starttime, endtime);</span><br><span class="line">                            if(p == null) &#123;</span><br><span class="line">                                System.out.println(&quot;Unknown error!&quot;);</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                System.out.println(p);</span><br><span class="line">                                System.out.println(&quot;Query finished&quot;);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;delete&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            System.out.println(&quot;Input the id of the item you want to delete:&quot;);</span><br><span class="line">                            Long id = scan.nextLong();</span><br><span class="line">                            int m = corba.delete(username, id);</span><br><span class="line">                            switch (m) &#123;</span><br><span class="line">                                case 0:</span><br><span class="line">                                    System.out.println(&quot;Success!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case -1:</span><br><span class="line">                                    System.out.println(&quot;The item is not found&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case -2:</span><br><span class="line">                                    System.out.println(&quot;Unknown error!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;clear&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            System.out.println(&quot;Are you going to clear the items list? Y/N&quot;);</span><br><span class="line">                            String pandaun = scan.nextLine();</span><br><span class="line">                            switch (pandaun) &#123;</span><br><span class="line">                                case &quot;N&quot;:</span><br><span class="line">                                case &quot;n&quot;:</span><br><span class="line">                                    System.out.println(&quot;Canceled&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case &quot;Y&quot;:</span><br><span class="line">                                case &quot;y&quot;:</span><br><span class="line">                                    int l = corba.clear(username);</span><br><span class="line">                                    if(l == -1) &#123;</span><br><span class="line">                                        System.out.println(&quot;Unknown username!&quot;);</span><br><span class="line">                                        break;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    System.out.println(&quot;Success!&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;logout&quot;:</span><br><span class="line">                        if (&quot;&quot; == username) &#123;</span><br><span class="line">                            System.out.println(&quot;You have not logged in!&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            System.out.println(&quot;Are you ready to log out? Y/N&quot;);</span><br><span class="line">                            String p = scan.nextLine();</span><br><span class="line">                            switch (p) &#123;</span><br><span class="line">                                case &quot;N&quot;:</span><br><span class="line">                                case &quot;n&quot;:</span><br><span class="line">                                    System.out.println(&quot;Canceled&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                                case &quot;Y&quot;:</span><br><span class="line">                                case &quot;y&quot;:</span><br><span class="line">                                    username = null;</span><br><span class="line">                                    System.out.println(&quot;Logged out&quot;);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;quit&quot;:</span><br><span class="line">                        System.out.println(&quot;Are you ready to quit? Y/N&quot;);</span><br><span class="line">                        String q = scan.nextLine();</span><br><span class="line">                        switch (q) &#123;</span><br><span class="line">                            case &quot;N&quot;:</span><br><span class="line">                            case &quot;n&quot;:</span><br><span class="line">                                System.out.println(&quot;Canceled&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;Y&quot;:</span><br><span class="line">                            case &quot;y&quot;:</span><br><span class="line">                                stop = true;</span><br><span class="line">                                System.out.println(&quot;quit!&quot;);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line"></span><br><span class="line">                    case &quot;help&quot;:</span><br><span class="line">                        System.out.println(&quot;Input register for User Registration&quot;);</span><br><span class="line">                        System.out.println(&quot;Input login for User Login&quot;);</span><br><span class="line">                        System.out.println(&quot;Input logout for User Logout&quot;);</span><br><span class="line">                        System.out.println(&quot;Input add for Adding Items&quot;);</span><br><span class="line">                        System.out.println(&quot;Input query for Querying Items&quot;);</span><br><span class="line">                        System.out.println(&quot;Input delete for Deleting Items&quot;);</span><br><span class="line">                        System.out.println(&quot;Input clear for Clearing Items&quot;);</span><br><span class="line">                        System.out.println(&quot;Input quit to stop&quot;);</span><br><span class="line">                        System.out.println(&quot;Input help for Help&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                    default:</span><br><span class="line">                        System.out.println(&quot;Error input&quot;);</span><br><span class="line">                        break;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>  在run(String[] args)中调用这个run(corba),程序运行，然后按照上述过程一次打开端口，运行服务器，运行客户端，就可以进行测试。</p>
<h4 id="源码传到了github上。"><a href="#源码传到了github上。" class="headerlink" title="源码传到了github上。"></a>源码传到了<a href="https://github.com/channel960608/CORBA" target="_blank" rel="noopener">github</a>上。</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2017/06/01/CORBA简介与简单实践/" data-id="cjfv1oauo0002rvzn7tew8e4f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CORBA/">CORBA</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Hexo通过本地化设置提高访问字体库效率" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/27/Hexo通过本地化设置提高访问字体库效率/" class="article-date">
  <time datetime="2017-05-26T17:51:40.000Z" itemprop="datePublished">2017-05-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/27/Hexo通过本地化设置提高访问字体库效率/">Hexo通过本地化设置提高访问字体库效率</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录</strong>
          <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hexo的特点"><span class="toc-number">1.</span> <span class="toc-text"><a href="#Hexo&#x7684;&#x7279;&#x70B9;" class="headerlink" title="Hexo&#x7684;&#x7279;&#x70B9;"></a>Hexo&#x7684;&#x7279;&#x70B9;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#遇到的问题"><span class="toc-number">2.</span> <span class="toc-text"><a href="#&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;" class="headerlink" title="&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;"></a>&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决方法"><span class="toc-number">3.</span> <span class="toc-text"><a href="#&#x89E3;&#x51B3;&#x65B9;&#x6CD5;" class="headerlink" title="&#x89E3;&#x51B3;&#x65B9;&#x6CD5;"></a>&#x89E3;&#x51B3;&#x65B9;&#x6CD5;</span></a></li></ol>
        </div>
        

        <p>今天刚刚利用GitHub+Hexo搭建了自己的博客，遇到了字体css无法加载的问题于是花功夫解决了一下。本文解决的步骤<br>参考了<a href="http://tyr.gift/hexo-optimization.html" target="_blank" rel="noopener">TyrChen’s Notes上的这篇博客</a>，<br>所以非常感谢博主Tyr。</p>
<h3 id="Hexo的特点"><a href="#Hexo的特点" class="headerlink" title="Hexo的特点"></a>Hexo的特点</h3><p>CORBA：Common Object Request Broker Architecture,通用对象请求代理体系。是由对象管理组(Object Management Group, OMG)制定的一种标准的面向对象分布式应用程序体系规范，旨在为异构分布式环境中，硬件和软件系统的互联而提出的一种解决方案。<br>Hexo是一个<strong>全静态化</strong>的博客系统，我采用了GitHub作为托管服务器，具有一下特点：</p>
<ul>
<li><strong>静态化处理非常迅速</strong> ：相比较其他静态博客而言，HEXO可以快速生成大量静态网页，生成每个页面仅需几毫秒的时间，而这仅需执行一条<code>hexo g</code>命令</li>
<li><strong>支持Markdown语法</strong>  ：我使用的是Idea的markdown插件来进行md文件编辑，个人感觉Markdown简洁美观的特征特别符合程序员的审美呀，至于具体的语法，我之前也写了<a href="https://channel960608.github.io/2017/05/26/Mastering-Markdown/">Mastering Markdown</a>这篇文章</li>
<li><p><strong>操作简便</strong> ： 在搭建好博客之后，发布博文以及调试的步骤非常简单</p>
<ul>
<li>创建post  使用命令<code>hexo new &#39;title&#39;</code>，就会在 <em>souce/_posts/</em> 目录下生成 <em>title.md</em> 文件，进行博文编辑</li>
<li>生成静态html文件 使用命令 <code>hexo clean</code>，清空 <em>public/</em> 目录下的项目，使用命令 <code>hexo g</code> ，<em>public/</em> 目录下会生成新的网站项目</li>
<li>本地测试 使用命令 <code>hexo s</code>, 可以在 <em>localhost:4000</em> 下访问本地运行的博客</li>
<li>发布博客 使用命令 <code>hexo d</code>，将 <em>public/</em> 目录下的项目部署到目标服务器上，在这之前需要在 <em>_config.yml</em> 文件中配置</li>
</ul>
</li>
</ul>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>刚刚搭建完博客，自己电脑上访问一切正常。在我换用平板访问我的博客主页时，发现首次加载网页竟然花了一分半。F12打开Chrome的开发工具，发现有两个字体的css文件的GET请求返回了504和502的错误，分别是</p>
<ul>
<li>fonts.useso.com/css?family=Source+Code+Pro:400,700</li>
<li>fonts.useso.com/css?family=Open+Sans:400,600</li>
</ul>
<p>众所周知，因为在之前google的前端字体库在我朝一直无法使用，所以大家都改用了360的前端字体库替代google，即字体库从<code>fonts.googleapis.com</code>替换为了<code>fonts.useso.com</code>，前端库从<code>ajax.googleapis.com</code>替换为了<code>ajax.useso.com</code>。但事实上，目前，<em>useso</em>下的前端字体库反而无法正常访问，需要通过goole的字体库下载需求的字体。原因我没有去查，我用的是武汉大学的校园网。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>对于一个前端开发者来说，本地化字体库无疑是一劳永逸的办法</p>
<p>虽然 <em>fonts.useso.com</em> 无法访问，但我反而从 <em>fonts.googleapis.com</em> 上下载到了我需要的字体</p>
<ul>
<li>fonts.googleapis.com/css?family=Source+Code+Pro:400,700</li>
<li>fonts.googleapis.com/css?family=Open+Sans:400,600</li>
</ul>
<p>分别访问上述两个url，返回如下的代码</p>
<pre><code>/* cyrillic-ext */
@font-face {
    font-family: &#39;Open Sans&#39;;
    font-style: normal;
    font-weight: 400;
    src: local(&#39;Open Sans&#39;), local(&#39;OpenSans&#39;), url(http://fonts.gstatic.com/s/opensans/v13/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2) format(&#39;woff2&#39;);
    unicode-range: U+0460-052F, U+20B4, U+2DE0-2DFF, U+A640-A69F;
}
/* cyrillic */
@font-face {
    font-family: &#39;Open Sans&#39;;
    font-style: normal;
    font-weight: 400;
    src: local(&#39;Open Sans&#39;), local(&#39;OpenSans&#39;), url(http://fonts.gstatic.com/s/opensans/v13/RjgO7rYTmqiVp7vzi-Q5URJtnKITppOI_IvcXXDNrsc.woff2) format(&#39;woff2&#39;);
    unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
/* greek-ext */
@font-face {
    font-family: &#39;Open Sans&#39;;
    font-style: normal;
    font-weight: 400;
    src: local(&#39;Open Sans&#39;), local(&#39;OpenSans&#39;), url(http://fonts.gstatic.com/s/opensans/v13/LWCjsQkB6EMdfHrEVqA1KRJtnKITppOI_IvcXXDNrsc.woff2) format(&#39;woff2&#39;);
    unicode-range: U+1F00-1FFF;
}
</code></pre><p>并上述代码保存在一个新建的 <em>font.css</em> 文件中</p>
<p>我们注意到，上述的文件中仍然存在着GET请求， <code>src: local(&#39;Open Sans&#39;), local(&#39;OpenSans&#39;), url(http://fonts.gstatic.com/s/opensans/v13/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2) format(&#39;woff2&#39;);</code>，所以我们需要把上述所有的 <em>woff</em> 和 <em>woff2</em> 文件下载下来，放在一个 <em>woff</em> 文件夹下</p>
<p>由于是使用的Hexo框架，所以并不像一般的静态网页，只需要改动源文件就行了。我们需要做的是修改主题的脚本文件，以我使用的Alex框架为例。</p>
<p>找到 <em>/themes/alex/source/</em> 文件夹，这里存放的是Hexo生成的网站项目中的资源部分，所以把我们下载的字体文件放在这里。我把 <em>font.css</em> 放在了<em>/themes/alex/source/css/fonts/</em> 下，把 <em>woff</em> 文件夹放在了 <em>/themes/alex/source/css/</em> 下</p>
<p>找到 <em>/themes/alex/layout/</em> 文件夹，这里的<em>ejs</em>文件规定了生成的博客框架的格式，以后需要修改自己框架的前端也可以从这里入手。</p>
<p>找到 <em>_partial/head.ejs</em> 并对它编辑</p>
<pre><code>&lt;!-- &lt;link href=&#39;http://fonts.googleapis.com/css?family=Open+Sans:400,600&#39; rel=&#39;stylesheet&#39; type=&#39;text/css&#39;&gt; --&gt;
  &lt;!-- &lt;link href=&quot;//fonts.googleapis.com/css?family=Source+Code+Pro:400,700&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt; --&gt;
  &lt;link href=&quot;//fonts.useso.com/css?family=Source+Code+Pro:400,700&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
  &lt;link href=&#39;//fonts.useso.com/css?family=Open+Sans:300,600&#39; rel=&#39;stylesheet&#39; type=&#39;text/css&#39;&gt;
  &lt;%- css(&#39;css/style&#39;) %&gt;
  &lt;%- partial(&#39;google-analytics&#39;) %&gt;
</code></pre><p>将上面的<code>&lt;link&gt;</code>标签中的 <code>href</code> 改为本地目录，如下</p>
<pre><code>&lt;!-- &lt;link href=&#39;http://fonts.googleapis.com/css?family=Open+Sans:400,600&#39; rel=&#39;stylesheet&#39; type=&#39;text/css&#39;&gt; --&gt;
  &lt;!-- &lt;link href=&quot;//fonts.googleapis.com/css?family=Source+Code+Pro:400,700&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt; --&gt;
  &lt;!--&lt;link href=&quot;//fonts.useso.com/css?family=Source+Code+Pro:400,700&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;--&gt;
  &lt;!--&lt;link href=&#39;//fonts.useso.com/css?family=Open+Sans:300,600&#39; rel=&#39;stylesheet&#39; type=&#39;text/css&#39;&gt;--&gt;
  &lt;link href=&quot;/css/fonts/font.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
  &lt;%- css(&#39;css/style&#39;) %&gt;
  &lt;%- partial(&#39;google-analytics&#39;) %&gt;
</code></pre><p>于此同时，需要对 <em>font.css</em> 进行修改</p>
<pre><code>/* cyrillic-ext */
    @font-face {
        font-family: &#39;Open Sans&#39;;
        font-style: normal;
        font-weight: 400;
        src: local(&#39;Open Sans&#39;), local(&#39;OpenSans&#39;), url(http://fonts.gstatic.com/s/opensans/v13/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2) format(&#39;woff2&#39;);
        unicode-range: U+0460-052F, U+20B4, U+2DE0-2DFF, U+A640-A69F;
    }
</code></pre><p>将上述请求 <em>woff</em> 文件的url改为本地的目录，及时上面下载的 <em>woff</em> 文件存放的目录，我的修改如下</p>
<pre><code> src: local(&#39;Open Sans&#39;), local(&#39;OpenSans&#39;), url(../woff/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2) format(&#39;woff2&#39;);
</code></pre><p>这样修改就基本上完成了，部署到服务器上，打开chrome的开发者工具，在console上没有发现报错信息。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2017/05/27/Hexo通过本地化设置提高访问字体库效率/" data-id="cjfv1oauh0000rvznqpu1kf10" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hexo/">Hexo</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Mastering-Markdown" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/26/Mastering-Markdown/" class="article-date">
  <time datetime="2017-05-26T10:12:24.000Z" itemprop="datePublished">2017-05-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/26/Mastering-Markdown/">Mastering Markdown</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录</strong>
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#What-you-will-learn"><span class="toc-number">1.</span> <span class="toc-text"><a href="#What-you-will-learn" class="headerlink" title="What you will learn"></a>What you will learn</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#What-is-Markdown"><span class="toc-number">2.</span> <span class="toc-text"><a href="#What-is-Markdown" class="headerlink" title="What is Markdown?"></a>What is Markdown?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Examples"><span class="toc-number">3.</span> <span class="toc-text"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Text"><span class="toc-number">3.0.1.</span> <span class="toc-text"><a href="#Text" class="headerlink" title="Text"></a>Text</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lists"><span class="toc-number">3.0.2.</span> <span class="toc-text"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Images"><span class="toc-number">3.0.3.</span> <span class="toc-text"><a href="#Images" class="headerlink" title="Images"></a>Images</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Headers-amp-Quotes"><span class="toc-number">3.0.4.</span> <span class="toc-text"><a href="#Headers-amp-Quotes" class="headerlink" title="Headers &amp; Quotes"></a>Headers &amp; Quotes</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Structured-documents"><span class="toc-number">4.</span> <span class="toc-text"><a href="#Structured-documents" class="headerlink" title="Structured documents"></a>Structured documents</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#This-is-a-third-tier-heading"><span class="toc-number">4.0.1.</span> <span class="toc-text"><a href="#This-is-a-third-tier-heading" class="headerlink" title="This is a third-tier heading"></a>This is a third-tier heading</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code"><span class="toc-number">4.0.2.</span> <span class="toc-text"><a href="#Code" class="headerlink" title="Code"></a>Code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Extras"><span class="toc-number">4.0.3.</span> <span class="toc-text"><a href="#Extras" class="headerlink" title="Extras"></a>Extras</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Syntax-guide"><span class="toc-number">5.</span> <span class="toc-text"><a href="#Syntax-guide" class="headerlink" title="Syntax guide"></a>Syntax guide</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Headers"><span class="toc-number">5.0.1.</span> <span class="toc-text"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Emphasis"><span class="toc-number">5.0.2.</span> <span class="toc-text"><a href="#Emphasis" class="headerlink" title="Emphasis"></a>Emphasis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List"><span class="toc-number">5.0.3.</span> <span class="toc-text"><a href="#List" class="headerlink" title="List"></a>List</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Unordered"><span class="toc-number">5.0.3.1.</span> <span class="toc-text"><a href="#Unordered" class="headerlink" title="Unordered"></a>Unordered</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ordered"><span class="toc-number">5.0.3.2.</span> <span class="toc-text"><a href="#Ordered" class="headerlink" title="Ordered"></a>Ordered</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Images-1"><span class="toc-number">5.0.3.3.</span> <span class="toc-text"><a href="#Images-1" class="headerlink" title="Images"></a>Images</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Links"><span class="toc-number">5.0.4.</span> <span class="toc-text"><a href="#Links" class="headerlink" title="Links"></a>Links</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blockquotes"><span class="toc-number">5.0.5.</span> <span class="toc-text"><a href="#Blockquotes" class="headerlink" title="Blockquotes"></a>Blockquotes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Inline-code"><span class="toc-number">5.0.6.</span> <span class="toc-text"><a href="#Inline-code" class="headerlink" title="Inline code"></a>Inline code</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GitHub-Flavored-Markdown"><span class="toc-number">6.</span> <span class="toc-text"><a href="#GitHub-Flavored-Markdown" class="headerlink" title="GitHub Flavored Markdown"></a>GitHub Flavored Markdown</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Syntax-highlighting"><span class="toc-number">6.0.1.</span> <span class="toc-text"><a href="#Syntax-highlighting" class="headerlink" title="Syntax highlighting"></a>Syntax highlighting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-Lists"><span class="toc-number">6.0.2.</span> <span class="toc-text"><a href="#Task-Lists" class="headerlink" title="Task Lists"></a>Task Lists</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tables"><span class="toc-number">6.0.3.</span> <span class="toc-text"><a href="#Tables" class="headerlink" title="Tables"></a>Tables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SHA-reference"><span class="toc-number">6.0.4.</span> <span class="toc-text"><a href="#SHA-reference" class="headerlink" title="SHA reference"></a>SHA reference</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Issue-references-within-a-repository"><span class="toc-number">6.0.5.</span> <span class="toc-text"><a href="#Issue-references-within-a-repository" class="headerlink" title="Issue references within a repository"></a>Issue references within a repository</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Username-mentions"><span class="toc-number">6.0.5.1.</span> <span class="toc-text"><a href="#Username-mentions" class="headerlink" title="Username @mentions"></a>Username @mentions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Automatic-linking-for-URLs"><span class="toc-number">6.0.6.</span> <span class="toc-text"><a href="#Automatic-linking-for-URLs" class="headerlink" title="Automatic linking for URLs"></a>Automatic linking for URLs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strikethrough"><span class="toc-number">6.0.7.</span> <span class="toc-text"><a href="#Strikethrough" class="headerlink" title="Strikethrough"></a>Strikethrough</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Emoji"><span class="toc-number">6.0.8.</span> <span class="toc-text"><a href="#Emoji" class="headerlink" title="Emoji"></a>Emoji</span></a></li></ol></li></ol></li></ol>
        </div>
        

        <p>Markdown is a lightweight and easy-to-use syntax for styling all forms of writing on the GitHub platform.</p>
<p>I edit this passage referring from the <a href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="noopener">page</a> on GitHub Guides about Markdown. Meanwhile, you can download the <a href="https://guides.github.com/pdfs/markdown-cheatsheet-online.pdf" target="_blank" rel="noopener">PDF</a> version. </p>
<h1 id="What-you-will-learn"><a href="#What-you-will-learn" class="headerlink" title="What you will learn"></a>What you will learn</h1><ul>
<li>How the Markdown format makes styled collaborative editing easy</li>
<li>How Markdown differs from tradition formatting approach</li>
<li>How to use Markdown to format text</li>
<li>How to leverage GitHub’s automatic Markdown rendering</li>
<li>How to apply GitHub;s unique Markdown extension</li>
</ul>
<h1 id="What-is-Markdown"><a href="#What-is-Markdown" class="headerlink" title="What is Markdown?"></a>What is Markdown?</h1><p><a href="https://daringfireball.net/projects/markdown/" target="_blank" rel="noopener">Markdown</a> is a way to style text on the web. You control the display of the document; formatting words  as bold or italic, adding images, and creating lists are just a few of the things we can do with Markdown. Mostly, Markdown is just regular text with a few non-alphabetic characters thrown in, like <code>#</code> or <code>*</code>  </p>
<p>  You can use Markdown most places around GitHub:</p>
<ul>
<li><a href="https://gist.github.com/" target="_blank" rel="noopener">Gists</a></li>
<li>Comments in Issues and Pull Requests</li>
<li><p>Files with the <code>.md</code> or <code>.markdown</code> extension</p>
<p>For more information, see “<a href="https://help.github.com/categories/writing-on-github/" target="_blank" rel="noopener">Writing on GitHub</a>“<br>in the _GitHub_ help  </p>
</li>
</ul>
<h1 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h1><h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><pre><code>  It&#39;s very easy to make some words **bold** and other words *italic* with 
  Markdown. You can even [link to Google!](http://google.com)
</code></pre><p>   It’s very easy to make some words <strong>bold</strong> and other words <em>italic</em> with Markdown.<br>   You can even <a href="http://google.com" target="_blank" rel="noopener">link to Google!</a>  </p>
<h3 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h3><pre><code>Sometimes you want numbered lists:

1. One
2. Two
3. Three

Sometimes you want bullet points:

* Start a line with a star
* Profit!

Alternatively,

- Dashes work just as well
- And if you have sub points, put two spaces before the dash or star:
  - Like this
  - And this
</code></pre><p>Sometimes you want numbered lists:</p>
<ol>
<li>One</li>
<li>Two</li>
<li>Three</li>
</ol>
<p>Sometimes you want bullet points:</p>
<ul>
<li>Start a line with a star</li>
<li>Profit!</li>
</ul>
<p>Alternatively,</p>
<ul>
<li>Dashes work just as well</li>
<li>And if you have sub points, put two spaces before the dash or star:<ul>
<li>Like this</li>
<li>And this  </li>
</ul>
</li>
</ul>
<h3 id="Images"><a href="#Images" class="headerlink" title="Images"></a>Images</h3><pre><code> If you want to embed images, this is how you do it:

 ![Image of Yaktocat](https://octodex.github.com/images/yaktocat.png)
</code></pre><p>If you want to embed images, this is how you do it:</p>
<p><img src="https://octodex.github.com/images/yaktocat.png" alt="Image of Yaktocat"></p>
<h3 id="Headers-amp-Quotes"><a href="#Headers-amp-Quotes" class="headerlink" title="Headers &amp; Quotes"></a>Headers &amp; Quotes</h3><pre><code># Structured documents

Sometimes it&#39;s useful to have different levels of headings to structure your documents. Start lines with a `#` to create headings. Multiple `##` in a row denote smaller heading sizes.

### This is a third-tier heading

You can use one `#` all the way up to `######` six for different heading sizes.

If you&#39;d like to quote someone, use the &gt; character before the line:

&gt; Coffee. The finest organic suspension ever devised... I beat the Borg with it.
&gt; - Captain Janeway
</code></pre><h1 id="Structured-documents"><a href="#Structured-documents" class="headerlink" title="Structured documents"></a>Structured documents</h1><p>Sometimes it’s useful to have different levels of headings to structure your documents. Start lines with a <code>#</code> to create headings. Multiple <code>##</code> in a row denote smaller heading sizes.</p>
<h3 id="This-is-a-third-tier-heading"><a href="#This-is-a-third-tier-heading" class="headerlink" title="This is a third-tier heading"></a>This is a third-tier heading</h3><p>You can use one <code>#</code> all the way up to <code>######</code> six for different heading sizes.</p>
<p>If you’d like to quote someone, use the &gt; character before the line:</p>
<blockquote>
<p>Coffee. The finest organic suspension ever devised… I beat the Borg with it.<br>-Captain Janeway</p>
</blockquote>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p>There are many different ways to style code with GitHub’s markdown. If you have inline code blocks, wrap them in backticks: <code>var example = true</code>.  If you’ve got a longer block of code, you can indent with four spaces:</p>
<pre><code>if (isAwesome){
   return true
 }
</code></pre><p>GitHub also supports something called code fencing, which allows for multiple lines without indentation:</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (isAwesome)&#123;</span><br><span class="line">  return true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><p>And if you’d like to use syntax highlighting, include the language:</p>
<pre><code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isAwesome)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><p>There are many different ways to style code with GitHub’s markdown. If you have inline code blocks, wrap them in backticks: <code>var example = true</code>.  If you’ve got a longer block of code, you can indent with four spaces:</p>
<pre><code>if (isAwesome){
  return true
}
</code></pre><p>GitHub also supports something called code fencing, which allows for multiple lines without indentation:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (isAwesome)&#123;</span><br><span class="line">  return true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And if you’d like to use syntax highlighting, include the language:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isAwesome)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Extras"><a href="#Extras" class="headerlink" title="Extras"></a>Extras</h3><pre><code>GitHub supports many extras in Markdown that help you reference and link to people. If you ever want to direct a comment at someone, you can prefix their name with an @ symbol: Hey @kneath — love your sweater!

But I have to admit, tasks lists are my favorite:

- [x] This is a complete item
- [ ] This is an incomplete item

When you include a task list in the first comment of an Issue, you will see a helpful progress bar in your list of issues. It works in Pull Requests, too!

And, of course emoji! :sparkles: :camel: :boom:
</code></pre><p>GitHub supports many extras in Markdown that help you reference and link to people. If you ever want to direct a comment at someone, you can prefix their name with an @ symbol: Hey @kneath — love your sweater!</p>
<p>But I have to admit, tasks lists are my favorite:</p>
<ul>
<li>[x] This is a complete item</li>
<li>[ ] This is an incomplete item</li>
</ul>
<p>When you include a task list in the first comment of an Issue, you will see a helpful progress bar in your list of issues. It works in Pull Requests, too!</p>
<p>And, of course emoji! :sparkles: :camel: :boom:</p>
<h1 id="Syntax-guide"><a href="#Syntax-guide" class="headerlink" title="Syntax guide"></a>Syntax guide</h1><p>Here’s an overview of Markdown syntax that you can use anywhere on GitHub.com or in your own text files.</p>
<h3 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h3><pre><code># This is an &lt;h1&gt; tag
## This is an &lt;h2&gt; tag
###### This is an &lt;h6&gt; tag
</code></pre><h3 id="Emphasis"><a href="#Emphasis" class="headerlink" title="Emphasis"></a>Emphasis</h3><pre><code>*This text will be italic*
_This will also be italic_

**This text will be bold**
__This will also be bold__

   _You **can** combine them_
</code></pre><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><h4 id="Unordered"><a href="#Unordered" class="headerlink" title="Unordered"></a>Unordered</h4><pre><code>   * Item 1
   * Item 2
     * Item 2a
     * Item 2b
</code></pre><h4 id="Ordered"><a href="#Ordered" class="headerlink" title="Ordered"></a>Ordered</h4><pre><code>   1. Item 1
   1. Item 2
   1. Item 3
      1. Item 3a
      1. Item 3b
</code></pre><h4 id="Images-1"><a href="#Images-1" class="headerlink" title="Images"></a>Images</h4><pre><code>   ![GitHub Logo](/images/logo.png)
   Format: ![Alt Text](url)
</code></pre><h3 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h3><pre><code>   http://github.com - automatic!
   [GitHub](http://github.com)
</code></pre><h3 id="Blockquotes"><a href="#Blockquotes" class="headerlink" title="Blockquotes"></a>Blockquotes</h3><pre><code>   As Kanye West said:

   &gt; We&#39;re living the future so
   &gt; the present is our past.
</code></pre><h3 id="Inline-code"><a href="#Inline-code" class="headerlink" title="Inline code"></a>Inline code</h3><pre><code>   I think you should use an
   `&lt;addr&gt;` element here instead.
</code></pre><h1 id="GitHub-Flavored-Markdown"><a href="#GitHub-Flavored-Markdown" class="headerlink" title="GitHub Flavored Markdown"></a>GitHub Flavored Markdown</h1><p>GitHub.com uses its own version of the Markdown syntax that provides an additional set of useful features, many of which make it easier to work with content on GitHub.com.</p>
<p>Note that some features of GitHub Flavored Markdown are only available in the descriptions and comments of Issues and Pull Requests. These include @mentions as well as references to SHA-1 hashes, Issues, and Pull Requests. Task Lists are also available in Gist comments and in Gist Markdown files.</p>
<h3 id="Syntax-highlighting"><a href="#Syntax-highlighting" class="headerlink" title="Syntax highlighting"></a>Syntax highlighting</h3><p>Here’s an example of how you can use syntax highlighting with<br><a href="https://help.github.com/categories/writing-on-github/" target="_blank" rel="noopener">GitHub Flavored Markdown</a>:  </p>
<pre><code>```javascript
function fancyAlert(arg) {
  if(arg) {
    $.facebox({div:&#39;#foo&#39;})
  }
}
```   
</code></pre><p>You can also simply indent your code by four spaces:</p>
<pre><code>   function fancyAlert(arg) {
      if(arg) {
        $.facebox({div:&#39;#foo&#39;})
      }
    }
</code></pre><p>Here’s an example of Python code without syntax highlighting:</p>
<pre><code>def foo():
    if not bar:
        return True
</code></pre><h3 id="Task-Lists"><a href="#Task-Lists" class="headerlink" title="Task Lists"></a>Task Lists</h3><pre><code>- [x] @mentions, #refs, [links](), **formatting**, and &lt;del&gt;tags&lt;/del&gt; supported
- [x] list syntax required (any unordered or ordered list supported)
- [x] this is a complete item
- [ ] this is an incomplete item
</code></pre><p>If you include a task list in the first comment of an Issue, you will get a handy progress indicator in your issue list. It also works in Pull Requests!</p>
<h3 id="Tables"><a href="#Tables" class="headerlink" title="Tables"></a>Tables</h3><p>You can create tables by assembling a list of words and dividing them with hyphens <code>-</code> (for the first row), and then separating each column with a pipe <code>|</code>:</p>
<pre><code>First Header | Second Header
------------ | -------------
Content from cell 1 | Content from cell 2
Content in the first column | Content in the second column
</code></pre><p>Would become:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>First Header</th>
<th>Second Header</th>
</tr>
</thead>
<tbody>
<tr>
<td>  Content from cell 1</td>
<td>Content from cell 2</td>
</tr>
<tr>
<td>  Content in the first column</td>
<td>Content in the second column</td>
</tr>
</tbody>
</table>
</div>
<h3 id="SHA-reference"><a href="#SHA-reference" class="headerlink" title="SHA reference"></a>SHA reference</h3><p>Any reference to a commit’s <a href="https://en.wikipedia.org/wiki/SHA-1" target="_blank" rel="noopener">SHA-1 hash</a> will be automatically converted into a link to that commit on GitHub.</p>
<pre><code>16c999e8c71134401a78d4d46435517b2271d6ac
mojombo@16c999e8c71134401a78d4d46435517b2271d6ac
mojombo/github-flavored-markdown@16c999e8c71134401a78d4d46435517b2271d6ac
</code></pre><h3 id="Issue-references-within-a-repository"><a href="#Issue-references-within-a-repository" class="headerlink" title="Issue references within a repository"></a>Issue references within a repository</h3><p>Any number that refers to an Issue or Pull Request will be automatically converted into a link.</p>
<pre><code>#1
mojombo#1
mojombo/github-flavored-markdown#1
</code></pre><h4 id="Username-mentions"><a href="#Username-mentions" class="headerlink" title="Username @mentions"></a>Username @mentions</h4><p>Typing an <code>@</code> symbol, followed by a username, will notify that person to come and view the comment. This is called an “@mention”, because you’re mentioning the individual. You can also @mention teams within an organization.</p>
<h3 id="Automatic-linking-for-URLs"><a href="#Automatic-linking-for-URLs" class="headerlink" title="Automatic linking for URLs"></a>Automatic linking for URLs</h3><p>Any URL (like <code>http://www.github.com/</code>) will be automatically converted into a clickable link.</p>
<h3 id="Strikethrough"><a href="#Strikethrough" class="headerlink" title="Strikethrough"></a>Strikethrough</h3><p>Any word wrapped with two tildes (like <code>~~this~~</code>) will appear crossed out.</p>
<h3 id="Emoji"><a href="#Emoji" class="headerlink" title="Emoji"></a>Emoji</h3><p>GitHub supports <a href="https://help.github.com/articles/basic-writing-and-formatting-syntax/#using-emoji" target="_blank" rel="noopener">emoji</a>! :sparkles: :camel: :boom:</p>
<p>To see a list of every image we support, check out the <a href="http://www.emoji-cheat-sheet.com/" target="_blank" rel="noopener">Emoji Cheat Sheet</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://channel960608.github.io/2017/05/26/Mastering-Markdown/" data-id="cjfv1oav00007rvzns8ej1u5s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Markdown/">Markdown</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/" class="logo">Coder Am I</a>
      &copy; 2018 Channel<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollLoading.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>